var v="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var M={};!function(v,I){M=I()}("undefined"!=typeof self&&self,(function(){return function(v){var M={};function s(I){if(M[I])return M[I].exports;var V=M[I]={i:I,l:!1,exports:{}};return v[I].call(V.exports,V,V.exports,s),V.l=!0,V.exports}return s.m=v,s.c=M,s.d=function(v,M,I){s.o(v,M)||Object.defineProperty(v,M,{enumerable:!0,get:I})},s.r=function(v){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(v,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(v,"__esModule",{value:!0})},s.t=function(v,M){if(1&M&&(v=s(v)),8&M)return v;if(4&M&&"object"==typeof v&&v&&v.__esModule)return v;var I=Object.create(null);if(s.r(I),Object.defineProperty(I,"default",{enumerable:!0,value:v}),2&M&&"string"!=typeof v)for(var V in v)s.d(I,V,function(M){return v[M]}.bind(null,V));return I},s.n=function(v){var M=v&&v.__esModule?function(){return v.default}:function(){return v};return s.d(M,"a",M),M},s.o=function(v,M){return Object.prototype.hasOwnProperty.call(v,M)},s.p="",s(s.s=9)}([function(M,I,V){!function(M,I,V,N){function i(v){return v&&"object"==typeof v&&"default"in v?v:{default:v}}var j=i(I),dt=i(V),vt=i(N),c=function(v,M,I){return{endTime:M,insertTime:I,type:"exponentialRampToValue",value:v}},h=function(v,M,I){return{endTime:M,insertTime:I,type:"linearRampToValue",value:v}},u=function(v,M){return{startTime:M,type:"setValue",value:v}},l=function(v,M,I){return{duration:I,startTime:M,type:"setValueCurve",values:v}},p=function(v,M,I){var V=I.startTime,N=I.target,j=I.timeConstant;return N+(M-N)*Math.exp((V-v)/j)},d=function(v){return"exponentialRampToValue"===v.type},f=function(v){return"linearRampToValue"===v.type},_=function(v){return d(v)||f(v)},m=function(v){return"setValue"===v.type},g=function(v){return"setValueCurve"===v.type},yt=function t(v,M,I,V){var N=v[M];return void 0===N?V:_(N)||m(N)?N.value:g(N)?N.values[N.values.length-1]:p(I,t(v,M-1,N.startTime,V),N)},y=function(v,M,I,V,N){return void 0===I?[V.insertTime,N]:_(I)?[I.endTime,I.value]:m(I)?[I.startTime,I.value]:g(I)?[I.startTime+I.duration,I.values[I.values.length-1]]:[I.startTime,yt(v,M-1,I.startTime,N)]},x=function(v){return"cancelAndHold"===v.type},w=function(v){return"cancelScheduledValues"===v.type},b=function(v){return x(v)||w(v)?v.cancelTime:d(v)||f(v)?v.endTime:v.startTime},T=function(v,M,I,V){var N=V.endTime,j=V.value;return I===j?j:0<I&&0<j||I<0&&j<0?I*Math.pow(j/I,(v-M)/(N-M)):0},S=function(v,M,I,V){return I+(v-M)/(V.endTime-M)*(V.value-I)},k=function(v,M){var I=M.duration,V=M.startTime,N=M.values;return function(v,M){var I=Math.floor(M),V=Math.ceil(M);return I===V?v[I]:(1-(M-I))*v[I]+(1-(V-M))*v[V]}(N,(v-V)/I*(N.length-1))},C=function(v){return"setTarget"===v.type},xt=function(){function t(M){dt.default(this||v,t),(this||v)._automationEvents=[],(this||v)._currenTime=0,(this||v)._defaultValue=M}return vt.default(t,[{key:Symbol.iterator,value:function(){return(this||v)._automationEvents[Symbol.iterator]()}},{key:"add",value:function(M){var I=b(M);if(x(M)||w(M)){var V=(this||v)._automationEvents.findIndex((function(v){return w(M)&&g(v)?v.startTime+v.duration>=I:b(v)>=I})),N=(this||v)._automationEvents[V];if(-1!==V&&((this||v)._automationEvents=(this||v)._automationEvents.slice(0,V)),x(M)){var j=(this||v)._automationEvents[(this||v)._automationEvents.length-1];if(void 0!==N&&_(N)){if(C(j))throw new Error("The internal list is malformed.");var dt=g(j)?j.startTime+j.duration:b(j),vt=g(j)?j.values[j.values.length-1]:j.value,yt=d(N)?T(I,dt,vt,N):S(I,dt,vt,N),xt=d(N)?c(yt,I,(this||v)._currenTime):h(yt,I,(this||v)._currenTime);(this||v)._automationEvents.push(xt)}void 0!==j&&C(j)&&(this||v)._automationEvents.push(u(this.getValue(I),I)),void 0!==j&&g(j)&&j.startTime+j.duration>I&&((this||v)._automationEvents[(this||v)._automationEvents.length-1]=l(new Float32Array([6,7]),j.startTime,I-j.startTime))}}else{var wt=(this||v)._automationEvents.findIndex((function(v){return b(v)>I})),bt=-1===wt?(this||v)._automationEvents[(this||v)._automationEvents.length-1]:(this||v)._automationEvents[wt-1];if(void 0!==bt&&g(bt)&&b(bt)+bt.duration>I)return!1;var Tt=d(M)?c(M.value,M.endTime,(this||v)._currenTime):f(M)?h(M.value,I,(this||v)._currenTime):M;if(-1===wt)(this||v)._automationEvents.push(Tt);else{if(g(M)&&I+M.duration>b((this||v)._automationEvents[wt]))return!1;(this||v)._automationEvents.splice(wt,0,Tt)}}return!0}},{key:"flush",value:function(M){var I=(this||v)._automationEvents.findIndex((function(v){return b(v)>M}));if(I>1){var V=(this||v)._automationEvents.slice(I-1),N=V[0];C(N)&&V.unshift(u(yt((this||v)._automationEvents,I-2,N.startTime,(this||v)._defaultValue),N.startTime)),(this||v)._automationEvents=V}}},{key:"getValue",value:function(M){if(0===(this||v)._automationEvents.length)return(this||v)._defaultValue;var I=(this||v)._automationEvents[(this||v)._automationEvents.length-1],V=(this||v)._automationEvents.findIndex((function(v){return b(v)>M})),N=(this||v)._automationEvents[V],dt=b(I)<=M?I:(this||v)._automationEvents[V-1];if(void 0!==dt&&C(dt)&&(void 0===N||!_(N)||N.insertTime>M))return p(M,yt((this||v)._automationEvents,V-2,dt.startTime,(this||v)._defaultValue),dt);if(void 0!==dt&&m(dt)&&(void 0===N||!_(N)))return dt.value;if(void 0!==dt&&g(dt)&&(void 0===N||!_(N)||dt.startTime+dt.duration>M))return M<dt.startTime+dt.duration?k(M,dt):dt.values[dt.values.length-1];if(void 0!==dt&&_(dt)&&(void 0===N||!_(N)))return dt.value;if(void 0!==N&&d(N)){var vt=y((this||v)._automationEvents,V-1,dt,N,(this||v)._defaultValue),xt=j.default(vt,2),wt=xt[0],bt=xt[1];return T(M,wt,bt,N)}if(void 0!==N&&f(N)){var Tt=y((this||v)._automationEvents,V-1,dt,N,(this||v)._defaultValue),kt=j.default(Tt,2),Ct=kt[0],Ot=kt[1];return S(M,Ct,Ot,N)}return(this||v)._defaultValue}}]),t}();M.AutomationEventList=xt,M.createCancelAndHoldAutomationEvent=function(v){return{cancelTime:v,type:"cancelAndHold"}},M.createCancelScheduledValuesAutomationEvent=function(v){return{cancelTime:v,type:"cancelScheduledValues"}},M.createExponentialRampToValueAutomationEvent=function(v,M){return{endTime:M,type:"exponentialRampToValue",value:v}},M.createLinearRampToValueAutomationEvent=function(v,M){return{endTime:M,type:"linearRampToValue",value:v}},M.createSetTargetAutomationEvent=function(v,M,I){return{startTime:M,target:v,timeConstant:I,type:"setTarget"}},M.createSetValueAutomationEvent=u,M.createSetValueCurveAutomationEvent=l,Object.defineProperty(M,"__esModule",{value:!0})}(I,V(1),V(7),V(8))},function(v,M,I){var V=I(2),N=I(3),j=I(4),dt=I(6);v.exports=function(v,M){return V(v)||N(v,M)||j(v,M)||dt()}},function(v,M){v.exports=function(v){if(Array.isArray(v))return v}},function(v,M){v.exports=function(v,M){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(v)){var I=[],V=!0,N=!1,j=void 0;try{for(var dt,vt=v[Symbol.iterator]();!(V=(dt=vt.next()).done)&&(I.push(dt.value),!M||I.length!==M);V=!0);}catch(v){N=!0,j=v}finally{try{V||null==vt.return||vt.return()}finally{if(N)throw j}}return I}}},function(v,M,I){var V=I(5);v.exports=function(v,M){if(v){if("string"==typeof v)return V(v,M);var I=Object.prototype.toString.call(v).slice(8,-1);return"Object"===I&&v.constructor&&(I=v.constructor.name),"Map"===I||"Set"===I?Array.from(v):"Arguments"===I||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(I)?V(v,M):void 0}}},function(v,M){v.exports=function(v,M){(null==M||M>v.length)&&(M=v.length);for(var I=0,V=new Array(M);I<M;I++)V[I]=v[I];return V}},function(v,M){v.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(v,M){v.exports=function(v,M){if(!(v instanceof M))throw new TypeError("Cannot call a class as a function")}},function(v,M){function s(v,M){for(var I=0;I<M.length;I++){var V=M[I];V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(v,V.key,V)}}v.exports=function(v,M,I){return M&&s(v.prototype,M),I&&s(v,I),v}},function(M,I,V){V.r(I),V.d(I,"getContext",(function(){return Ji})),V.d(I,"setContext",(function(){return Ki})),V.d(I,"Clock",(function(){return qo})),V.d(I,"Context",(function(){return Gi})),V.d(I,"BaseContext",(function(){return Wi})),V.d(I,"Delay",(function(){return Fo})),V.d(I,"Gain",(function(){return ko})),V.d(I,"Offline",(function(){return Io})),V.d(I,"OfflineContext",(function(){return Yi})),V.d(I,"Param",(function(){return xo})),V.d(I,"ToneAudioBuffer",(function(){return Xi})),V.d(I,"ToneAudioBuffers",(function(){return Vo})),V.d(I,"ToneAudioNode",(function(){return wo})),V.d(I,"connectSeries",(function(){return bo})),V.d(I,"connect",(function(){return To})),V.d(I,"disconnect",(function(){return So})),V.d(I,"FrequencyClass",(function(){return lo})),V.d(I,"Frequency",(function(){return _o})),V.d(I,"MidiClass",(function(){return No})),V.d(I,"Midi",(function(){return Po})),V.d(I,"TimeClass",(function(){return ho})),V.d(I,"Time",(function(){return uo})),V.d(I,"TicksClass",(function(){return jo})),V.d(I,"Ticks",(function(){return Lo})),V.d(I,"TransportTimeClass",(function(){return mo})),V.d(I,"TransportTime",(function(){return go})),V.d(I,"Emitter",(function(){return Bi})),V.d(I,"IntervalTimeline",(function(){return Bo})),V.d(I,"StateTimeline",(function(){return yo})),V.d(I,"Timeline",(function(){return Ni})),V.d(I,"isUndef",(function(){return ai})),V.d(I,"isDefined",(function(){return ci})),V.d(I,"isFunction",(function(){return hi})),V.d(I,"isNumber",(function(){return ui})),V.d(I,"isObject",(function(){return li})),V.d(I,"isBoolean",(function(){return pi})),V.d(I,"isArray",(function(){return di})),V.d(I,"isString",(function(){return fi})),V.d(I,"isNote",(function(){return _i})),V.d(I,"dbToGain",(function(){return eo})),V.d(I,"gainToDb",(function(){return so})),V.d(I,"intervalToFrequencyRatio",(function(){return no})),V.d(I,"ftom",(function(){return oo})),V.d(I,"mtof",(function(){return ao})),V.d(I,"optionsFromArguments",(function(){return Di})),V.d(I,"defaultArg",(function(){return Oi})),V.d(I,"Unit",(function(){return j})),V.d(I,"debug",(function(){return N})),V.d(I,"Noise",(function(){return Jo})),V.d(I,"UserMedia",(function(){return er})),V.d(I,"Oscillator",(function(){return ir})),V.d(I,"AMOscillator",(function(){return hr})),V.d(I,"FMOscillator",(function(){return ur})),V.d(I,"PulseOscillator",(function(){return lr})),V.d(I,"FatOscillator",(function(){return pr})),V.d(I,"PWMOscillator",(function(){return dr})),V.d(I,"OmniOscillator",(function(){return _r})),V.d(I,"ToneOscillatorNode",(function(){return nr})),V.d(I,"LFO",(function(){return yr})),V.d(I,"ToneBufferSource",(function(){return $o})),V.d(I,"Player",(function(){return br})),V.d(I,"Players",(function(){return Tr})),V.d(I,"GrainPlayer",(function(){return Sr})),V.d(I,"Add",(function(){return mr})),V.d(I,"Abs",(function(){return kr})),V.d(I,"AudioToGain",(function(){return ar})),V.d(I,"GainToAudio",(function(){return Cr})),V.d(I,"GreaterThan",(function(){return Mr})),V.d(I,"GreaterThanZero",(function(){return Or})),V.d(I,"Multiply",(function(){return cr})),V.d(I,"Negate",(function(){return Ar})),V.d(I,"Pow",(function(){return Er})),V.d(I,"Signal",(function(){return Do})),V.d(I,"connectSignal",(function(){return Oo})),V.d(I,"Scale",(function(){return gr})),V.d(I,"ScaleExp",(function(){return Rr})),V.d(I,"Subtract",(function(){return Dr})),V.d(I,"SyncedSignal",(function(){return qr})),V.d(I,"WaveShaper",(function(){return rr})),V.d(I,"Zero",(function(){return vr})),V.d(I,"AMSynth",(function(){return zr})),V.d(I,"DuoSynth",(function(){return Qr})),V.d(I,"FMSynth",(function(){return Zr})),V.d(I,"MetalSynth",(function(){return Yr})),V.d(I,"MembraneSynth",(function(){return Hr})),V.d(I,"MonoSynth",(function(){return Ur})),V.d(I,"NoiseSynth",(function(){return $r})),V.d(I,"PluckSynth",(function(){return oa})),V.d(I,"PolySynth",(function(){return ra})),V.d(I,"Sampler",(function(){return aa})),V.d(I,"Synth",(function(){return jr})),V.d(I,"Loop",(function(){return ha})),V.d(I,"Part",(function(){return ua})),V.d(I,"Pattern",(function(){return xa})),V.d(I,"Sequence",(function(){return wa})),V.d(I,"ToneEvent",(function(){return ca})),V.d(I,"AutoFilter",(function(){return ka})),V.d(I,"AutoPanner",(function(){return Aa})),V.d(I,"AutoWah",(function(){return Oa})),V.d(I,"BitCrusher",(function(){return Ma})),V.d(I,"Chebyshev",(function(){return Ra})),V.d(I,"Chorus",(function(){return Na})),V.d(I,"Distortion",(function(){return Pa})),V.d(I,"FeedbackDelay",(function(){return La})),V.d(I,"FrequencyShifter",(function(){return Ba})),V.d(I,"Freeverb",(function(){return Ua})),V.d(I,"JCReverb",(function(){return Ya})),V.d(I,"PingPongDelay",(function(){return $a})),V.d(I,"PitchShift",(function(){return Ja})),V.d(I,"Phaser",(function(){return Ka})),V.d(I,"Reverb",(function(){return tc})),V.d(I,"StereoWidener",(function(){return ic})),V.d(I,"Tremolo",(function(){return oc})),V.d(I,"Vibrato",(function(){return rc})),V.d(I,"Analyser",(function(){return ac})),V.d(I,"Meter",(function(){return hc})),V.d(I,"FFT",(function(){return uc})),V.d(I,"DCMeter",(function(){return lc})),V.d(I,"Waveform",(function(){return pc})),V.d(I,"Follower",(function(){return Da})),V.d(I,"Channel",(function(){return _c})),V.d(I,"CrossFade",(function(){return ba})),V.d(I,"Merge",(function(){return Fa})),V.d(I,"MidSideMerge",(function(){return sc})),V.d(I,"MidSideSplit",(function(){return ec})),V.d(I,"Mono",(function(){return mc})),V.d(I,"MultibandSplit",(function(){return gc})),V.d(I,"Panner",(function(){return Ca})),V.d(I,"Panner3D",(function(){return yc})),V.d(I,"PanVol",(function(){return fc})),V.d(I,"Recorder",(function(){return xc})),V.d(I,"Solo",(function(){return dc})),V.d(I,"Split",(function(){return qa})),V.d(I,"Volume",(function(){return Go})),V.d(I,"Compressor",(function(){return wc})),V.d(I,"Gate",(function(){return bc})),V.d(I,"Limiter",(function(){return Tc})),V.d(I,"MidSideCompressor",(function(){return Sc})),V.d(I,"MultibandCompressor",(function(){return kc})),V.d(I,"AmplitudeEnvelope",(function(){return Pr})),V.d(I,"Envelope",(function(){return Fr})),V.d(I,"FrequencyEnvelope",(function(){return Gr})),V.d(I,"EQ3",(function(){return Cc})),V.d(I,"Filter",(function(){return Wr})),V.d(I,"OnePoleFilter",(function(){return na})),V.d(I,"FeedbackCombFilter",(function(){return sa})),V.d(I,"LowpassCombFilter",(function(){return ia})),V.d(I,"Convolver",(function(){return Ac})),V.d(I,"BiquadFilter",(function(){return Br})),V.d(I,"version",(function(){return dt})),V.d(I,"start",(function(){return to})),V.d(I,"supported",(function(){return Kn})),V.d(I,"now",(function(){return Dc})),V.d(I,"immediate",(function(){return Oc})),V.d(I,"Transport",(function(){return Kc})),V.d(I,"getTransport",(function(){return Ec})),V.d(I,"Destination",(function(){return th})),V.d(I,"Master",(function(){return eh})),V.d(I,"getDestination",(function(){return Fc})),V.d(I,"Listener",(function(){return sh})),V.d(I,"getListener",(function(){return Vc})),V.d(I,"Draw",(function(){return nh})),V.d(I,"getDraw",(function(){return Pc})),V.d(I,"context",(function(){return ih})),V.d(I,"loaded",(function(){return Lc})),V.d(I,"Buffer",(function(){return oh})),V.d(I,"Buffers",(function(){return rh})),V.d(I,"BufferSource",(function(){return ah}));var N={};V.r(N),V.d(N,"assert",(function(){return ti})),V.d(N,"assertRange",(function(){return ei})),V.d(N,"assertContextRunning",(function(){return si})),V.d(N,"setLogger",(function(){return ii})),V.d(N,"log",(function(){return oi})),V.d(N,"warn",(function(){return ri}));var j={};V.r(j);const dt="14.7.77";var vt=V(0);const yt=new WeakSet,xt=new WeakMap,wt=new WeakMap,bt=new WeakMap,Tt=new WeakMap,kt=new WeakMap,Ct=new WeakMap,Ot=new WeakMap,Et=new WeakMap,qt=new WeakMap,$t={construct:()=>$t},Jt=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,y=(v,M)=>{const I=[];let V=v.replace(/^[\s]+/,""),N=V.match(Jt);for(;null!==N;){const v=N[1].slice(1,-1),j=N[0].replace(/([\s]+)?;?$/,"").replace(v,new URL(v,M).toString());I.push(j),V=V.slice(N[0].length).replace(/^[\s]+/,""),N=V.match(Jt)}return[I.join(";"),V]},x=v=>{if(void 0!==v&&!Array.isArray(v))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},w=v=>{if(!(v=>{try{new new Proxy(v,$t)}catch{return!1}return!0})(v))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===v.prototype||"object"!=typeof v.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},b=(v,M)=>{const I=v.get(M);if(void 0===I)throw new Error("A value with the given key could not be found.");return I},T=(v,M)=>{const I=Array.from(v).filter(M);if(I.length>1)throw Error("More than one element was found.");if(0===I.length)throw Error("No element was found.");const[V]=I;return v.delete(V),V},S=(v,M,I,V)=>{const N=b(v,M),j=T(N,(v=>v[0]===I&&v[1]===V));return 0===N.size&&v.delete(M),j},k=v=>b(Ct,v),C=v=>{if(yt.has(v))throw new Error("The AudioNode is already stored.");yt.add(v),k(v).forEach((v=>v(!0)))},A=v=>"port"in v,D=v=>{if(!yt.has(v))throw new Error("The AudioNode is not stored.");yt.delete(v),k(v).forEach((v=>v(!1)))},O=(v,M)=>{!A(v)&&M.every((v=>0===v.size))&&D(v)},Kt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},E=(v,M)=>v.context===M,R=v=>{try{v.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},q=()=>new DOMException("","IndexSizeError"),F=v=>{var M;v.getChannelData=(M=v.getChannelData,I=>{try{return M.call(v,I)}catch(v){if(12===v.code)throw q();throw v}})},te={numberOfChannels:1},ee=-34028234663852886e22,ne=-ee,P=v=>yt.has(v),fe={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},L=v=>b(xt,v),z=v=>b(bt,v),B=(v,M)=>{const{activeInputs:I}=L(v);I.forEach((I=>I.forEach((([I])=>{M.includes(v)||B(I,[...M,v])}))));const V=(v=>"playbackRate"in v)(v)?[v.playbackRate]:A(v)?Array.from(v.parameters.values()):(v=>"frequency"in v&&"gain"in v)(v)?[v.Q,v.detune,v.frequency,v.gain]:(v=>"offset"in v)(v)?[v.offset]:(v=>!("frequency"in v)&&"gain"in v)(v)?[v.gain]:(v=>"detune"in v&&"frequency"in v)(v)?[v.detune,v.frequency]:(v=>"pan"in v)(v)?[v.pan]:[];for(const v of V){const I=z(v);void 0!==I&&I.activeInputs.forEach((([v])=>B(v,M)))}P(v)&&D(v)},W=v=>{B(v.destination,[])},G=v=>void 0===v||"number"==typeof v||"string"==typeof v&&("balanced"===v||"interactive"===v||"playback"===v),U=v=>"context"in v,Q=v=>U(v[0]),Z=(v,M,I,V)=>{for(const M of v)if(I(M)){if(V)return!1;throw Error("The set contains at least one similar element.")}return v.add(M),!0},X=(v,M,[I,V],N)=>{Z(v,[M,I,V],(v=>v[0]===M&&v[1]===I),N)},Y=(v,[M,I,V],N)=>{const j=v.get(M);void 0===j?v.set(M,new Set([[I,V]])):Z(j,[I,V],(v=>v[0]===I),N)},H=v=>"inputs"in v,$=(v,M,I,V)=>{if(H(M)){const N=M.inputs[V];return v.connect(N,I,0),[N,I,0]}return v.connect(M,I,V),[M,I,V]},J=(v,M,I)=>{for(const V of v)if(V[0]===M&&V[1]===I)return v.delete(V),V;return null},K=(v,M)=>{if(!k(v).delete(M))throw new Error("Missing the expected event listener.")},tt=(v,M,I)=>{const V=b(v,M),N=T(V,(v=>v[0]===I));return 0===V.size&&v.delete(M),N},et=(v,M,I,V)=>{H(M)?v.disconnect(M.inputs[V],I,0):v.disconnect(M,I,V)},st=v=>b(wt,v),nt=v=>b(Tt,v),it=v=>Ot.has(v),ot=v=>!yt.has(v),rt=v=>new Promise((M=>{const I=v.createScriptProcessor(256,1,1),V=v.createGain(),N=v.createBuffer(1,2,44100),j=N.getChannelData(0);j[0]=1,j[1]=1;const dt=v.createBufferSource();dt.buffer=N,dt.loop=!0,dt.connect(I).connect(v.destination),dt.connect(V),dt.disconnect(V),I.onaudioprocess=V=>{const N=V.inputBuffer.getChannelData(0);Array.prototype.some.call(N,(v=>1===v))?M(!0):M(!1),dt.stop(),I.onaudioprocess=null,dt.disconnect(I),I.disconnect(v.destination)},dt.start()})),at=(v,M)=>{const I=new Map;for(const M of v)for(const v of M){const M=I.get(v);I.set(v,void 0===M?1:M+1)}I.forEach(((v,I)=>M(I,v)))},ct=v=>"context"in v,ht=(v,M,I,V)=>{const{activeInputs:N,passiveInputs:j}=z(M),{outputs:dt}=L(v),vt=k(v),c=dt=>{const vt=st(v),yt=nt(M);if(dt){const M=tt(j,v,I);X(N,v,M,!1),V||it(v)||vt.connect(yt,I)}else{const M=((v,M,I)=>T(v,(v=>v[0]===M&&v[1]===I)))(N,v,I);Y(j,M,!1),V||it(v)||vt.disconnect(yt,I)}};return!!Z(dt,[M,I],(v=>v[0]===M&&v[1]===I),!0)&&(vt.add(c),P(v)?X(N,v,[I,c],!0):Y(j,[v,I,c],!0),!0)},ut=(v,M,I,V,N)=>{const[j,dt]=((v,M,I,V)=>{const{activeInputs:N,passiveInputs:j}=L(M),dt=J(N[V],v,I);return null===dt?[S(j,v,I,V)[2],!1]:[dt[2],!0]})(v,I,V,N);if(null!==j&&(K(v,j),!dt||M||it(v)||et(st(v),st(I),V,N)),P(I)){const{activeInputs:v}=L(I);O(I,v)}},lt=(v,M,I,V)=>{const[N,j]=((v,M,I)=>{const{activeInputs:V,passiveInputs:N}=z(M),j=J(V,v,I);return null===j?[tt(N,v,I)[1],!1]:[j[2],!0]})(v,I,V);null!==N&&(K(v,N),!j||M||it(v)||st(v).disconnect(nt(I),V))};class pt{constructor(v){this._map=new Map(v)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(v,M=null){return this._map.forEach(((I,V)=>v.call(M,I,V,this)))}get(v){return this._map.get(v)}has(v){return this._map.has(v)}keys(){return this._map.keys()}values(){return this._map.values()}}const _e={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function ft(v,M,I,V,N){if("function"==typeof v.copyFromChannel)0===M[I].byteLength&&(M[I]=new Float32Array(128)),v.copyFromChannel(M[I],V,N);else{const j=v.getChannelData(V);if(0===M[I].byteLength)M[I]=j.slice(N,N+128);else{const v=new Float32Array(j.buffer,N*Float32Array.BYTES_PER_ELEMENT,128);M[I].set(v)}}}const _t=(v,M,I,V,N)=>{"function"==typeof v.copyToChannel?0!==M[I].byteLength&&v.copyToChannel(M[I],V,N):0!==M[I].byteLength&&v.getChannelData(V).set(M[I],N)},mt=(v,M)=>{const I=[];for(let V=0;V<v;V+=1){const v=[],N="number"==typeof M?M:M[V];for(let M=0;M<N;M+=1)v.push(new Float32Array(128));I.push(v)}return I},gt=async(v,M,I,V,N,j,dt)=>{const vt=null===M?128*Math.ceil(v.context.length/128):M.length,yt=V.channelCount*V.numberOfInputs,xt=N.reduce(((v,M)=>v+M),0),wt=0===xt?null:I.createBuffer(xt,vt,I.sampleRate);if(void 0===j)throw new Error("Missing the processor constructor.");const bt=L(v),Tt=await((v,M)=>{const I=b(qt,v),V=st(M);return b(I,V)})(I,v),kt=mt(V.numberOfInputs,V.channelCount),Ct=mt(V.numberOfOutputs,N),Ot=Array.from(v.parameters.keys()).reduce(((v,M)=>({...v,[M]:new Float32Array(128)})),{});for(let xt=0;xt<vt;xt+=128){if(V.numberOfInputs>0&&null!==M)for(let v=0;v<V.numberOfInputs;v+=1)for(let I=0;I<V.channelCount;I+=1)ft(M,kt[v],I,I,xt);void 0!==j.parameterDescriptors&&null!==M&&j.parameterDescriptors.forEach((({name:v},I)=>{ft(M,Ot,v,yt+I,xt)}));for(let v=0;v<V.numberOfInputs;v+=1)for(let M=0;M<N[v];M+=1)0===Ct[v][M].byteLength&&(Ct[v][M]=new Float32Array(128));try{const v=kt.map(((v,M)=>0===bt.activeInputs[M].size?[]:v)),M=dt(xt/I.sampleRate,I.sampleRate,(()=>Tt.process(v,Ct,Ot)));if(null!==wt)for(let v=0,M=0;v<V.numberOfOutputs;v+=1){for(let I=0;I<N[v];I+=1)_t(wt,Ct[v],I,M+I,xt);M+=N[v]}if(!M)break}catch(M){v.dispatchEvent(new ErrorEvent("processorerror",{colno:M.colno,filename:M.filename,lineno:M.lineno,message:M.message}));break}}return wt},me={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},ge={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},ve={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},ye={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},xe={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},we={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},St=(v,M,I)=>{const V=M[I];if(void 0===V)throw v();return V},be={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},Te={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},At=()=>new DOMException("","InvalidStateError"),Dt=()=>new DOMException("","InvalidAccessError"),De={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},Mt=(v,M,I,V,N,j,dt,vt,yt,xt,wt)=>{const bt=xt.length;let Tt=vt;for(let vt=0;vt<bt;vt+=1){let bt=I[0]*xt[vt];for(let M=1;M<N;M+=1){const V=Tt-M&yt-1;bt+=I[M]*j[V],bt-=v[M]*dt[V]}for(let v=N;v<V;v+=1)bt+=I[v]*j[Tt-v&yt-1];for(let I=N;I<M;I+=1)bt-=v[I]*dt[Tt-I&yt-1];j[Tt]=xt[vt],dt[Tt]=bt,Tt=Tt+1&yt-1,wt[vt]=bt}return Tt},Se={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},Rt=v=>{const M=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const I=v.decodeAudioData(M.buffer,(()=>{}));return void 0!==I&&(I.catch((()=>{})),!0)}catch{}return!1},Ft=(v,M,I)=>{const V=M[I];void 0!==V&&V!==v[I]&&(v[I]=V)},It=(v,M)=>{Ft(v,M,"channelCount"),Ft(v,M,"channelCountMode"),Ft(v,M,"channelInterpretation")},Vt=v=>"function"==typeof v.getFloatTimeDomainData,Nt=(v,M,I)=>{const V=M[I];void 0!==V&&V!==v[I].value&&(v[I].value=V)},Pt=v=>{var M;v.start=(M=v.start,(I=0,V=0,N)=>{if("number"==typeof N&&N<0||V<0||I<0)throw new RangeError("The parameters can't be negative.");M.call(v,I,V,N)})},jt=v=>{var M;v.stop=(M=v.stop,(I=0)=>{if(I<0)throw new RangeError("The parameter can't be negative.");M.call(v,I)})},Lt=(v,M)=>null===v?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(v*M))))),zt=async(v,M)=>new v(await(v=>new Promise(((M,I)=>{const{port1:V,port2:N}=new MessageChannel;V.onmessage=({data:v})=>{V.close(),N.close(),M(v)},V.onmessageerror=({data:v})=>{V.close(),N.close(),I(v)},N.postMessage(v)})))(M)),Bt=(v,M)=>{const I=v.createBiquadFilter();return It(I,M),Nt(I,M,"Q"),Nt(I,M,"detune"),Nt(I,M,"frequency"),Nt(I,M,"gain"),Ft(I,M,"type"),I},Wt=(v,M)=>{const I=v.createChannelSplitter(M.numberOfOutputs);return It(I,M),(v=>{const M=v.numberOfOutputs;Object.defineProperty(v,"channelCount",{get:()=>M,set:v=>{if(v!==M)throw At()}}),Object.defineProperty(v,"channelCountMode",{get:()=>"explicit",set:v=>{if("explicit"!==v)throw At()}}),Object.defineProperty(v,"channelInterpretation",{get:()=>"discrete",set:v=>{if("discrete"!==v)throw At()}})})(I),I},Gt=(v,M)=>(v.connect=M.connect.bind(M),v.disconnect=M.disconnect.bind(M),v),Ut=(v,M)=>{const I=v.createDelay(M.maxDelayTime);return It(I,M),Nt(I,M,"delayTime"),I},Qt=(v,M)=>{const I=v.createGain();return It(I,M),Nt(I,M,"gain"),I};function Zt(v,M){const I=M[0]*M[0]+M[1]*M[1];return[(v[0]*M[0]+v[1]*M[1])/I,(v[1]*M[0]-v[0]*M[1])/I]}function Xt(v,M){let I=[0,0];for(let j=v.length-1;j>=0;j-=1)N=M,I=[(V=I)[0]*N[0]-V[1]*N[1],V[0]*N[1]+V[1]*N[0]],I[0]+=v[j];var V,N;return I}const Yt=(v,M,I,V)=>v.createScriptProcessor(M,I,V),Ht=()=>new DOMException("","NotSupportedError"),ke={numberOfChannels:1},Ce={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},Ae={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},Oe={disableNormalization:!1},Me={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},se=()=>new DOMException("","UnknownError"),Ee={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},ie=v=>{if(null===v)return!1;const M=v.length;return M%2!=0?0!==v[Math.floor(M/2)]:v[M/2-1]+v[M/2]!==0},oe=(v,M,I,V)=>{let N=Object.getPrototypeOf(v);for(;!N.hasOwnProperty(M);)N=Object.getPrototypeOf(N);const{get:j,set:dt}=Object.getOwnPropertyDescriptor(N,M);Object.defineProperty(v,M,{get:I(j),set:V(dt)})},re=(v,M,I)=>{try{v.setValueAtTime(M,I)}catch(V){if(9!==V.code)throw V;re(v,M,I+1e-7)}},ae=v=>{const M=v.createOscillator();try{M.start(-1)}catch(v){return v instanceof RangeError}return!1},ce=v=>{const M=v.createBuffer(1,1,44100),I=v.createBufferSource();I.buffer=M,I.start(),I.stop();try{return I.stop(),!0}catch{return!1}},he=v=>{const M=v.createOscillator();try{M.stop(-1)}catch(v){return v instanceof RangeError}return!1},ue=()=>{try{new DOMException}catch{return!1}return!0},le=()=>new Promise((v=>{const M=new ArrayBuffer(0),{port1:I,port2:V}=new MessageChannel;I.onmessage=({data:M})=>v(null!==M),V.postMessage(M,[M])})),pe=(v,M)=>{const I=M.createGain();v.connect(I);const V=(N=v.disconnect,()=>{N.call(v,I),v.removeEventListener("ended",V)});var N;v.addEventListener("ended",V),Gt(v,I),v.stop=(M=>{let V=!1;return(N=0)=>{if(V)try{M.call(v,N)}catch{I.gain.setValueAtTime(0,N)}else M.call(v,N),V=!0}})(v.stop)},de=(v,M)=>I=>{const V={value:v};return Object.defineProperties(I,{currentTarget:V,target:V}),"function"==typeof M?M.call(v,I):M.handleEvent.call(v,I)},Re=(qe=Z,(v,M,[I,V,N],j)=>{qe(v[V],[M,I,N],(v=>v[0]===M&&v[1]===I),j)});var qe;const Fe=(v=>(M,I,[V,N,j],dt)=>{const vt=M.get(V);void 0===vt?M.set(V,new Set([[N,I,j]])):v(vt,[N,I,j],(v=>v[0]===N&&v[1]===I),dt)})(Z),Ie=(v=>(M,I,V,N)=>v(M[N],(v=>v[0]===I&&v[1]===V)))(T),Ve=new WeakMap,Ne=(v=>M=>{var I;return null!==(I=v.get(M))&&void 0!==I?I:0})(Ve),Pe=(je=new Map,Le=new WeakMap,(v,M)=>{const I=Le.get(v);if(void 0!==I)return I;const V=je.get(v);if(void 0!==V)return V;try{const I=M();return I instanceof Promise?(je.set(v,I),I.catch((()=>!1)).then((M=>(je.delete(v),Le.set(v,M),M)))):(Le.set(v,I),I)}catch{return Le.set(v,!1),!1}});var je,Le;const ze="undefined"==typeof window?null:window,Be=(We=Pe,Ue=q,(v,M)=>{const I=v.createAnalyser();if(It(I,M),!(M.maxDecibels>M.minDecibels))throw Ue();return Ft(I,M,"fftSize"),Ft(I,M,"maxDecibels"),Ft(I,M,"minDecibels"),Ft(I,M,"smoothingTimeConstant"),We(Vt,(()=>Vt(I)))||(v=>{v.getFloatTimeDomainData=M=>{const I=new Uint8Array(M.length);v.getByteTimeDomainData(I);const V=Math.max(I.length,v.fftSize);for(let v=0;v<V;v+=1)M[v]=.0078125*(I[v]-128);return M}})(I),I});var We,Ue;const Ge=(Xe=L,v=>{const M=Xe(v);if(null===M.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return M.renderer});var Xe;const Ye=((v,M,I)=>async(V,N,j,dt)=>{const vt=v(V),yt=[...dt,V];await Promise.all(vt.activeInputs.map(((v,dt)=>Array.from(v).filter((([v])=>!yt.includes(v))).map((async([v,vt])=>{const xt=M(v),wt=await xt.render(v,N,yt),bt=V.context.destination;I(v)||V===bt&&I(V)||wt.connect(j,vt,dt)})))).reduce(((v,M)=>[...v,...M]),[]))})(L,Ge,it),Qe=(Ze=Be,He=st,$e=Ye,()=>{const v=new WeakMap;return{render(M,I,V){const N=v.get(I);return void 0!==N?Promise.resolve(N):(async(M,I,V)=>{let N=He(M);if(!E(N,I)){const v={channelCount:N.channelCount,channelCountMode:N.channelCountMode,channelInterpretation:N.channelInterpretation,fftSize:N.fftSize,maxDecibels:N.maxDecibels,minDecibels:N.minDecibels,smoothingTimeConstant:N.smoothingTimeConstant};N=Ze(I,v)}return v.set(I,N),await $e(M,I,N,V),N})(M,I,V)}}});var Ze,He,$e;const Je=(Ke=kt,v=>{const M=Ke.get(v);if(void 0===M)throw At();return M});var Ke;const ts=(v=>null===v?null:v.hasOwnProperty("OfflineAudioContext")?v.OfflineAudioContext:v.hasOwnProperty("webkitOfflineAudioContext")?v.webkitOfflineAudioContext:null)(ze),es=(ss=ts,v=>null!==ss&&v instanceof ss);var ss;const ns=new WeakMap,is=(os=de,class{constructor(v){this._nativeEventTarget=v,this._listeners=new WeakMap}addEventListener(v,M,I){if(null!==M){let V=this._listeners.get(M);void 0===V&&(V=os(this,M),"function"==typeof M&&this._listeners.set(M,V)),this._nativeEventTarget.addEventListener(v,V,I)}}dispatchEvent(v){return this._nativeEventTarget.dispatchEvent(v)}removeEventListener(v,M,I){const V=null===M?void 0:this._listeners.get(M);this._nativeEventTarget.removeEventListener(v,void 0===V?null:V,I)}});var os;const rs=(v=>null===v?null:v.hasOwnProperty("AudioContext")?v.AudioContext:v.hasOwnProperty("webkitAudioContext")?v.webkitAudioContext:null)(ze),as=(cs=rs,v=>null!==cs&&v instanceof cs);var cs;const hs=(v=>M=>null!==v&&"function"==typeof v.AudioNode&&M instanceof v.AudioNode)(ze),us=(v=>M=>null!==v&&"function"==typeof v.AudioParam&&M instanceof v.AudioParam)(ze),ls=((v,M,I,V,N,j,dt,vt,yt,xt,bt,Tt,kt,Ot,Et)=>class extends xt{constructor(M,V,N,j){super(N),this._context=M,this._nativeAudioNode=N;const dt=bt(M);Tt(dt)&&!0!==I(rt,(()=>rt(dt)))&&(v=>{const M=new Map;var I,V;v.connect=(I=v.connect.bind(v),(v,V=0,N=0)=>{const j=ct(v)?I(v,V,N):I(v,V),dt=M.get(v);return void 0===dt?M.set(v,[{input:N,output:V}]):dt.every((v=>v.input!==N||v.output!==V))&&dt.push({input:N,output:V}),j}),v.disconnect=(V=v.disconnect,(I,N,j)=>{if(V.apply(v),void 0===I)M.clear();else if("number"==typeof I)for(const[v,V]of M){const N=V.filter((v=>v.output!==I));0===N.length?M.delete(v):M.set(v,N)}else if(M.has(I))if(void 0===N)M.delete(I);else{const v=M.get(I);if(void 0!==v){const V=v.filter((v=>v.output!==N&&(v.input!==j||void 0===j)));0===V.length?M.delete(I):M.set(I,V)}}for(const[I,V]of M)V.forEach((M=>{ct(I)?v.connect(I,M.output,M.input):v.connect(I,M.output)}))})})(N),wt.set(this,N),Ct.set(this,new Set),"closed"!==M.state&&V&&C(this),v(this,j,N)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(v){this._nativeAudioNode.channelCount=v}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(v){this._nativeAudioNode.channelCountMode=v}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(v){this._nativeAudioNode.channelInterpretation=v}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(v,I=0,vt=0){if(I<0||I>=this._nativeAudioNode.numberOfOutputs)throw N();const xt=bt(this._context),wt=Et(xt);if(kt(v)||Ot(v))throw j();if(U(v)){const N=st(v);try{const M=$(this._nativeAudioNode,N,I,vt),V=ot(this);(wt||V)&&this._nativeAudioNode.disconnect(...M),"closed"!==this.context.state&&!V&&ot(v)&&C(v)}catch(v){if(12===v.code)throw j();throw v}if(M(this,v,I,vt,wt)){const M=yt([this],v);at(M,V(wt))}return v}const Tt=nt(v);if("playbackRate"===Tt.name)throw dt();try{this._nativeAudioNode.connect(Tt,I),(wt||ot(this))&&this._nativeAudioNode.disconnect(Tt,I)}catch(v){if(12===v.code)throw j();throw v}if(ht(this,v,I,wt)){const M=yt([this],v);at(M,V(wt))}}disconnect(v,M,I){let V;const dt=bt(this._context),xt=Et(dt);if(void 0===v)V=((v,M)=>{const I=L(v),V=[];for(const N of I.outputs)Q(N)?ut(v,M,...N):lt(v,M,...N),V.push(N[0]);return I.outputs.clear(),V})(this,xt);else if("number"==typeof v){if(v<0||v>=this.numberOfOutputs)throw N();V=((v,M,I)=>{const V=L(v),N=[];for(const j of V.outputs)j[1]===I&&(Q(j)?ut(v,M,...j):lt(v,M,...j),N.push(j[0]),V.outputs.delete(j));return N})(this,xt,v)}else{if(void 0!==M&&(M<0||M>=this.numberOfOutputs))throw N();if(U(v)&&void 0!==I&&(I<0||I>=v.numberOfInputs))throw N();if(V=((v,M,I,V,N)=>{const j=L(v);return Array.from(j.outputs).filter((v=>!(v[0]!==I||void 0!==V&&v[1]!==V||void 0!==N&&v[2]!==N))).map((I=>(Q(I)?ut(v,M,...I):lt(v,M,...I),j.outputs.delete(I),I[0])))})(this,xt,v,M,I),0===V.length)throw j()}for(const v of V){const M=yt([this],v);at(M,vt)}}})((ds=xt,(v,M,I)=>{const V=[];for(let v=0;v<I.numberOfInputs;v+=1)V.push(new Set);ds.set(v,{activeInputs:V,outputs:new Set,passiveInputs:new WeakMap,renderer:M})}),((v,M,I,V,N,j,dt,vt,yt,xt,wt,bt,Tt)=>(kt,Ct,Ot,Et,qt)=>{const{activeInputs:$t,passiveInputs:Jt}=j(Ct),{outputs:Kt}=j(kt),te=vt(kt),b=j=>{const vt=yt(Ct),xt=yt(kt);if(j){const M=S(Jt,kt,Ot,Et);v($t,kt,M,!1),qt||bt(kt)||I(xt,vt,Ot,Et),Tt(Ct)&&C(Ct)}else{const v=V($t,kt,Ot,Et);M(Jt,Et,v,!1),qt||bt(kt)||N(xt,vt,Ot,Et);const I=dt(Ct);0===I?wt(Ct)&&O(Ct,$t):setTimeout((()=>{wt(Ct)&&O(Ct,$t)}),1e3*I)}};return!!xt(Kt,[Ct,Ot,Et],(v=>v[0]===Ct&&v[1]===Ot&&v[2]===Et),!0)&&(te.add(b),wt(kt)?v($t,kt,[Ot,Et,b],!0):M(Jt,Et,[kt,Ot,b],!0),!0)})(Re,Fe,$,Ie,et,L,Ne,k,st,Z,P,it,ot),Pe,((v,M,I,V,N,j)=>dt=>(vt,yt)=>{const xt=v.get(vt);if(void 0===xt){if(!dt&&j(vt)){const v=V(vt),{outputs:j}=I(vt);for(const I of j)if(Q(I)){const N=V(I[0]);M(v,N,I[1],I[2])}else{const M=N(I[0]);v.disconnect(M,I[1])}}v.set(vt,yt)}else v.set(vt,xt+yt)})(Ot,et,L,st,nt,P),q,Dt,Ht,((v,M,I,V,N,j,dt,vt)=>(yt,xt)=>{const wt=M.get(yt);if(void 0===wt)throw new Error("Missing the expected cycle count.");const bt=j(yt.context),Tt=vt(bt);if(wt===xt){if(M.delete(yt),!Tt&&dt(yt)){const M=V(yt),{outputs:j}=I(yt);for(const I of j)if(Q(I)){const N=V(I[0]);v(M,N,I[1],I[2])}else{const v=N(I[0]);M.connect(v,I[1])}}}else M.set(yt,wt-xt)})($,Ot,L,st,nt,Je,P,es),((v,M,I)=>function n(V,N){const j=U(N)?N:I(v,N);if((v=>"delayTime"in v)(j))return[];if(V[0]===j)return[V];if(V.includes(j))return[];const{outputs:dt}=M(j);return Array.from(dt).map((v=>n([...V,j],v[0]))).reduce(((v,M)=>v.concat(M)),[])})(ns,L,b),is,Je,as,hs,us,es);var ds;const ps=((v,M,I,V,N,j)=>class extends v{constructor(v,I){const dt=N(v),vt={...Kt,...I},yt=V(dt,vt);super(v,!1,yt,j(dt)?M():null),this._nativeAnalyserNode=yt}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(v){this._nativeAnalyserNode.fftSize=v}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(v){const M=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=v,!(v>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=M,I()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(v){const M=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=v,!(this._nativeAnalyserNode.maxDecibels>v))throw this._nativeAnalyserNode.minDecibels=M,I()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(v){this._nativeAnalyserNode.smoothingTimeConstant=v}getByteFrequencyData(v){this._nativeAnalyserNode.getByteFrequencyData(v)}getByteTimeDomainData(v){this._nativeAnalyserNode.getByteTimeDomainData(v)}getFloatFrequencyData(v){this._nativeAnalyserNode.getFloatFrequencyData(v)}getFloatTimeDomainData(v){this._nativeAnalyserNode.getFloatTimeDomainData(v)}})(ls,Qe,q,Be,Je,es),fs=new WeakSet,_s=(v=>null===v?null:v.hasOwnProperty("AudioBuffer")?v.AudioBuffer:null)(ze),ms=(gs=new Uint32Array(1),v=>(gs[0]=v,gs[0]));var gs;const vs=((v,M)=>I=>{I.copyFromChannel=(V,N,j=0)=>{const dt=v(j),vt=v(N);if(vt>=I.numberOfChannels)throw M();const yt=I.length,xt=I.getChannelData(vt),wt=V.length;for(let v=dt<0?-dt:0;v+dt<yt&&v<wt;v+=1)V[v]=xt[v+dt]},I.copyToChannel=(V,N,j=0)=>{const dt=v(j),vt=v(N);if(vt>=I.numberOfChannels)throw M();const yt=I.length,xt=I.getChannelData(vt),wt=V.length;for(let v=dt<0?-dt:0;v+dt<yt&&v<wt;v+=1)xt[v+dt]=V[v]}})(ms,q),ys=(v=>M=>{M.copyFromChannel=(I=>(V,N,j=0)=>{const dt=v(j),vt=v(N);if(dt<M.length)return I.call(M,V,vt,dt)})(M.copyFromChannel),M.copyToChannel=(I=>(V,N,j=0)=>{const dt=v(j),vt=v(N);if(dt<M.length)return I.call(M,V,vt,dt)})(M.copyToChannel)})(ms),xs=((v,M,I,V,N,j,dt,vt)=>{let yt=null;return class h{constructor(xt){if(null===N)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:wt,numberOfChannels:bt,sampleRate:Tt}={...te,...xt};null===yt&&(yt=new N(1,1,44100));const kt=null!==V&&M(j,j)?new V({length:wt,numberOfChannels:bt,sampleRate:Tt}):yt.createBuffer(bt,wt,Tt);if(0===kt.numberOfChannels)throw I();return"function"!=typeof kt.copyFromChannel?(dt(kt),F(kt)):M(R,(()=>R(kt)))||vt(kt),v.add(kt),kt}static[Symbol.hasInstance](M){return null!==M&&"object"==typeof M&&Object.getPrototypeOf(M)===h.prototype||v.has(M)}}})(fs,Pe,Ht,_s,ts,(ws=_s,()=>{if(null===ws)return!1;try{new ws({length:1,sampleRate:44100})}catch{return!1}return!0}),vs,ys);var ws;const bs=(Ts=Qt,(v,M)=>{const I=Ts(v,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});M.connect(I).connect(v.destination);const n=()=>{M.removeEventListener("ended",n),M.disconnect(I),I.disconnect()};M.addEventListener("ended",n)});var Ts;const Ds=((v,M,I)=>async(V,N,j,dt)=>{const vt=M(V);await Promise.all(Array.from(vt.activeInputs).map((async([M,V])=>{const vt=v(M),yt=await vt.render(M,N,dt);I(M)||yt.connect(j,V)})))})(Ge,z,it),Ss=(v=>(M,I,V,N)=>v(I,M,V,N))(Ds),ks=((v,M,I,V,N,j,dt,vt,yt,xt,wt)=>(bt,Tt)=>{const kt=bt.createBufferSource();return It(kt,Tt),Nt(kt,Tt,"playbackRate"),Ft(kt,Tt,"buffer"),Ft(kt,Tt,"loop"),Ft(kt,Tt,"loopEnd"),Ft(kt,Tt,"loopStart"),M(I,(()=>I(bt)))||(v=>{v.start=(M=>{let I=!1;return(V=0,N=0,j)=>{if(I)throw At();M.call(v,V,N,j),I=!0}})(v.start)})(kt),M(V,(()=>V(bt)))||yt(kt),M(N,(()=>N(bt)))||xt(kt,bt),M(j,(()=>j(bt)))||Pt(kt),M(dt,(()=>dt(bt)))||wt(kt,bt),M(vt,(()=>vt(bt)))||jt(kt),v(bt,kt),kt})(bs,Pe,(v=>{const M=v.createBufferSource();M.start();try{M.start()}catch{return!0}return!1}),(v=>{const M=v.createBufferSource(),I=v.createBuffer(1,1,44100);M.buffer=I;try{M.start(0,1)}catch{return!1}return!0}),(v=>{const M=v.createBufferSource();M.start();try{M.stop()}catch{return!1}return!0}),ae,ce,he,(v=>{var M;v.start=(M=v.start,(I=0,V=0,N)=>{const j=v.buffer,dt=null===j?V:Math.min(j.duration,V);null!==j&&dt>j.duration-.5/v.context.sampleRate?M.call(v,I,0,0):M.call(v,I,dt,N)})}),(Cs=oe,(v,M)=>{const I=M.createBuffer(1,1,44100);null===v.buffer&&(v.buffer=I),Cs(v,"buffer",(M=>()=>{const V=M.call(v);return V===I?null:V}),(M=>V=>M.call(v,null===V?I:V)))}),pe);var Cs;const As=((v,M)=>(I,V,N,j)=>(v(V).replay(N),M(V,I,N,j)))((v=>M=>{const I=v(M);if(null===I.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return I.renderer})(z),Ds),Os=((v,M,I,V,N)=>()=>{const j=new WeakMap;let dt=null,vt=null;return{set start(v){dt=v},set stop(v){vt=v},render(yt,xt,wt){const bt=j.get(xt);return void 0!==bt?Promise.resolve(bt):(async(yt,xt,wt)=>{let bt=I(yt);const Tt=E(bt,xt);if(!Tt){const v={buffer:bt.buffer,channelCount:bt.channelCount,channelCountMode:bt.channelCountMode,channelInterpretation:bt.channelInterpretation,loop:bt.loop,loopEnd:bt.loopEnd,loopStart:bt.loopStart,playbackRate:bt.playbackRate.value};bt=M(xt,v),null!==dt&&bt.start(...dt),null!==vt&&bt.stop(vt)}return j.set(xt,bt),Tt?await v(xt,yt.playbackRate,bt.playbackRate,wt):await V(xt,yt.playbackRate,bt.playbackRate,wt),await N(yt,xt,bt,wt),bt})(yt,xt,wt)}}})(Ss,ks,st,As,Ye),Ms=((v,M,I,V,N,j,dt,yt,xt,wt,bt,Tt,kt)=>(Ct,Ot,Et,qt=null,$t=null)=>{const Jt=new vt.AutomationEventList(Et.defaultValue),Kt=Ot?V(Jt):null,te={get defaultValue(){return Et.defaultValue},get maxValue(){return null===qt?Et.maxValue:qt},get minValue(){return null===$t?Et.minValue:$t},get value(){return Et.value},set value(v){Et.value=v,te.setValueAtTime(v,Ct.context.currentTime)},cancelAndHoldAtTime(v){if("function"==typeof Et.cancelAndHoldAtTime)null===Kt&&Jt.flush(Ct.context.currentTime),Jt.add(N(v)),Et.cancelAndHoldAtTime(v);else{const M=Array.from(Jt).pop();null===Kt&&Jt.flush(Ct.context.currentTime),Jt.add(N(v));const I=Array.from(Jt).pop();Et.cancelScheduledValues(v),M!==I&&void 0!==I&&("exponentialRampToValue"===I.type?Et.exponentialRampToValueAtTime(I.value,I.endTime):"linearRampToValue"===I.type?Et.linearRampToValueAtTime(I.value,I.endTime):"setValue"===I.type?Et.setValueAtTime(I.value,I.startTime):"setValueCurve"===I.type&&Et.setValueCurveAtTime(I.values,I.startTime,I.duration))}return te},cancelScheduledValues:v=>(null===Kt&&Jt.flush(Ct.context.currentTime),Jt.add(j(v)),Et.cancelScheduledValues(v),te),exponentialRampToValueAtTime(v,M){if(0===v)throw new RangeError;if(!Number.isFinite(M)||M<0)throw new RangeError;return null===Kt&&Jt.flush(Ct.context.currentTime),Jt.add(dt(v,M)),Et.exponentialRampToValueAtTime(v,M),te},linearRampToValueAtTime:(v,M)=>(null===Kt&&Jt.flush(Ct.context.currentTime),Jt.add(yt(v,M)),Et.linearRampToValueAtTime(v,M),te),setTargetAtTime:(v,M,I)=>(null===Kt&&Jt.flush(Ct.context.currentTime),Jt.add(xt(v,M,I)),Et.setTargetAtTime(v,M,I),te),setValueAtTime:(v,M)=>(null===Kt&&Jt.flush(Ct.context.currentTime),Jt.add(wt(v,M)),Et.setValueAtTime(v,M),te),setValueCurveAtTime(v,M,I){const V=v instanceof Float32Array?v:new Float32Array(v);if(null!==Tt&&"webkitAudioContext"===Tt.name){const v=M+I,N=Ct.context.sampleRate,j=Math.ceil(M*N),dt=Math.floor(v*N),vt=dt-j,yt=new Float32Array(vt);for(let v=0;v<vt;v+=1){const dt=(V.length-1)/I*((j+v)/N-M),vt=Math.floor(dt),xt=Math.ceil(dt);yt[v]=vt===xt?V[vt]:(1-(dt-vt))*V[vt]+(1-(xt-dt))*V[xt]}null===Kt&&Jt.flush(Ct.context.currentTime),Jt.add(bt(yt,M,I)),Et.setValueCurveAtTime(yt,M,I);const xt=dt/N;xt<v&&kt(te,yt[yt.length-1],xt),kt(te,V[V.length-1],v)}else null===Kt&&Jt.flush(Ct.context.currentTime),Jt.add(bt(V,M,I)),Et.setValueCurveAtTime(V,M,I);return te}};return I.set(te,Et),M.set(te,Ct),v(te,Kt),te})((Es=bt,(v,M)=>{Es.set(v,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:M})}),ns,Tt,(v=>({replay(M){for(const I of v)if("exponentialRampToValue"===I.type){const{endTime:v,value:V}=I;M.exponentialRampToValueAtTime(V,v)}else if("linearRampToValue"===I.type){const{endTime:v,value:V}=I;M.linearRampToValueAtTime(V,v)}else if("setTarget"===I.type){const{startTime:v,target:V,timeConstant:N}=I;M.setTargetAtTime(V,v,N)}else if("setValue"===I.type){const{startTime:v,value:V}=I;M.setValueAtTime(V,v)}else{if("setValueCurve"!==I.type)throw new Error("Can't apply an unknown automation.");{const{duration:v,startTime:V,values:N}=I;M.setValueCurveAtTime(N,V,v)}}}})),vt.createCancelAndHoldAutomationEvent,vt.createCancelScheduledValuesAutomationEvent,vt.createExponentialRampToValueAutomationEvent,vt.createLinearRampToValueAutomationEvent,vt.createSetTargetAutomationEvent,vt.createSetValueAutomationEvent,vt.createSetValueCurveAutomationEvent,rs,re);var Es;const Rs=((v,M,I,V,N,j,dt,vt)=>class extends v{constructor(v,V){const vt=j(v),yt={...fe,...V},xt=N(vt,yt),wt=dt(vt),bt=wt?M():null;super(v,!1,xt,bt),this._audioBufferSourceNodeRenderer=bt,this._isBufferNullified=!1,this._isBufferSet=null!==yt.buffer,this._nativeAudioBufferSourceNode=xt,this._onended=null,this._playbackRate=I(this,wt,xt.playbackRate,ne,ee)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(v){if(this._nativeAudioBufferSourceNode.buffer=v,null!==v){if(this._isBufferSet)throw V();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(v){this._nativeAudioBufferSourceNode.loop=v}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(v){this._nativeAudioBufferSourceNode.loopEnd=v}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(v){this._nativeAudioBufferSourceNode.loopStart=v}get onended(){return this._onended}set onended(v){const M="function"==typeof v?vt(this,v):null;this._nativeAudioBufferSourceNode.onended=M;const I=this._nativeAudioBufferSourceNode.onended;this._onended=null!==I&&I===M?v:I}get playbackRate(){return this._playbackRate}start(v=0,M=0,I){if(this._nativeAudioBufferSourceNode.start(v,M,I),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===I?[v,M]:[v,M,I]),"closed"!==this.context.state){C(this);const t=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",t),P(this)&&D(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",t)}}stop(v=0){this._nativeAudioBufferSourceNode.stop(v),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=v)}})(ls,Os,Ms,At,ks,Je,es,de),qs=((v,M,I,V,N,j,dt,vt)=>class extends v{constructor(v,I){const V=j(v),yt=dt(V),xt=N(V,I,yt);super(v,!1,xt,yt?M(vt):null),this._isNodeOfNativeOfflineAudioContext=yt,this._nativeAudioDestinationNode=xt}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(v){if(this._isNodeOfNativeOfflineAudioContext)throw V();if(v>this._nativeAudioDestinationNode.maxChannelCount)throw I();this._nativeAudioDestinationNode.channelCount=v}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(v){if(this._isNodeOfNativeOfflineAudioContext)throw V();this._nativeAudioDestinationNode.channelCountMode=v}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(ls,(v=>{let M=null;return{render:(I,V,N)=>(null===M&&(M=(async(M,I,V)=>{const N=I.destination;return await v(M,I,N,V),N})(I,V,N)),M)}}),q,At,((v,M)=>(I,V,N)=>{const j=I.destination;if(j.channelCount!==V)try{j.channelCount=V}catch{}N&&"explicit"!==j.channelCountMode&&(j.channelCountMode="explicit"),0===j.maxChannelCount&&Object.defineProperty(j,"maxChannelCount",{value:V});const dt=v(I,{channelCount:V,channelCountMode:j.channelCountMode,channelInterpretation:j.channelInterpretation,gain:1});return M(dt,"channelCount",(v=>()=>v.call(dt)),(v=>M=>{v.call(dt,M);try{j.channelCount=M}catch(v){if(M>j.maxChannelCount)throw v}})),M(dt,"channelCountMode",(v=>()=>v.call(dt)),(v=>M=>{v.call(dt,M),j.channelCountMode=M})),M(dt,"channelInterpretation",(v=>()=>v.call(dt)),(v=>M=>{v.call(dt,M),j.channelInterpretation=M})),Object.defineProperty(dt,"maxChannelCount",{get:()=>j.maxChannelCount}),dt.connect(j),dt})(Qt,oe),Je,es,Ye),Fs=((v,M,I,V,N)=>()=>{const j=new WeakMap;return{render(dt,vt,yt){const xt=j.get(vt);return void 0!==xt?Promise.resolve(xt):(async(dt,vt,yt)=>{let xt=I(dt);const wt=E(xt,vt);if(!wt){const v={Q:xt.Q.value,channelCount:xt.channelCount,channelCountMode:xt.channelCountMode,channelInterpretation:xt.channelInterpretation,detune:xt.detune.value,frequency:xt.frequency.value,gain:xt.gain.value,type:xt.type};xt=M(vt,v)}return j.set(vt,xt),wt?(await v(vt,dt.Q,xt.Q,yt),await v(vt,dt.detune,xt.detune,yt),await v(vt,dt.frequency,xt.frequency,yt),await v(vt,dt.gain,xt.gain,yt)):(await V(vt,dt.Q,xt.Q,yt),await V(vt,dt.detune,xt.detune,yt),await V(vt,dt.frequency,xt.frequency,yt),await V(vt,dt.gain,xt.gain,yt)),await N(dt,vt,xt,yt),xt})(dt,vt,yt)}}})(Ss,Bt,st,As,Ye),Is=(v=>(M,I)=>v.set(M,I))(Ve),Vs=(Ns=ls,Ps=Ms,js=Fs,Ls=Dt,zs=Bt,Bs=Je,Ws=es,Us=Is,class extends Ns{constructor(v,M){const I=Bs(v),V={...me,...M},N=zs(I,V),j=Ws(I);super(v,!1,N,j?js():null),this._Q=Ps(this,j,N.Q,ne,ee),this._detune=Ps(this,j,N.detune,1200*Math.log2(ne),-1200*Math.log2(ne)),this._frequency=Ps(this,j,N.frequency,v.sampleRate/2,0),this._gain=Ps(this,j,N.gain,40*Math.log10(ne),ee),this._nativeBiquadFilterNode=N,Us(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(v){this._nativeBiquadFilterNode.type=v}getFrequencyResponse(v,M,I){try{this._nativeBiquadFilterNode.getFrequencyResponse(v,M,I)}catch(v){if(11===v.code)throw Ls();throw v}if(v.length!==M.length||M.length!==I.length)throw Ls()}});var Ns,Ps,js,Ls,zs,Bs,Ws,Us;const Gs=((v,M)=>(I,V,N)=>{const j=new Set;var dt,vt;return I.connect=(dt=I.connect,(N,vt=0,yt=0)=>{const xt=0===j.size;if(M(N))return dt.call(I,N,vt,yt),v(j,[N,vt,yt],(v=>v[0]===N&&v[1]===vt&&v[2]===yt),!0),xt&&V(),N;dt.call(I,N,vt),v(j,[N,vt],(v=>v[0]===N&&v[1]===vt),!0),xt&&V()}),I.disconnect=(vt=I.disconnect,(v,V,dt)=>{const yt=j.size>0;if(void 0===v)vt.apply(I),j.clear();else if("number"==typeof v){vt.call(I,v);for(const M of j)M[1]===v&&j.delete(M)}else{M(v)?vt.call(I,v,V,dt):vt.call(I,v,V);for(const M of j)M[0]!==v||void 0!==V&&M[1]!==V||void 0!==dt&&M[2]!==dt||j.delete(M)}const xt=0===j.size;yt&&xt&&N()}),I})(Z,hs),Xs=(Ys=At,Qs=Gs,(v,M)=>{M.channelCount=1,M.channelCountMode="explicit",Object.defineProperty(M,"channelCount",{get:()=>1,set:()=>{throw Ys()}}),Object.defineProperty(M,"channelCountMode",{get:()=>"explicit",set:()=>{throw Ys()}});const I=v.createBufferSource();Qs(M,(()=>{const v=M.numberOfInputs;for(let V=0;V<v;V+=1)I.connect(M,0,V)}),(()=>I.disconnect(M)))});var Ys,Qs;const Zs=((v,M)=>(I,V)=>{const N=I.createChannelMerger(V.numberOfInputs);return null!==v&&"webkitAudioContext"===v.name&&M(I,N),It(N,V),N})(rs,Xs),Hs=((v,M,I,V,N)=>class extends v{constructor(v,j){const dt=V(v),vt={...ge,...j};super(v,!1,I(dt,vt),N(dt)?M():null)}})(ls,((v,M,I)=>()=>{const V=new WeakMap;return{render(N,j,dt){const vt=V.get(j);return void 0!==vt?Promise.resolve(vt):(async(N,j,dt)=>{let vt=M(N);if(!E(vt,j)){const M={channelCount:vt.channelCount,channelCountMode:vt.channelCountMode,channelInterpretation:vt.channelInterpretation,numberOfInputs:vt.numberOfInputs};vt=v(j,M)}return V.set(j,vt),await I(N,j,vt,dt),vt})(N,j,dt)}}})(Zs,st,Ye),Zs,Je,es),$s=((v,M,I,V,N,j)=>class extends v{constructor(v,dt){const vt=V(v),yt=j({...ve,...dt});super(v,!1,I(vt,yt),N(vt)?M():null)}})(ls,((v,M,I)=>()=>{const V=new WeakMap;return{render(N,j,dt){const vt=V.get(j);return void 0!==vt?Promise.resolve(vt):(async(N,j,dt)=>{let vt=M(N);if(!E(vt,j)){const M={channelCount:vt.channelCount,channelCountMode:vt.channelCountMode,channelInterpretation:vt.channelInterpretation,numberOfOutputs:vt.numberOfOutputs};vt=v(j,M)}return V.set(j,vt),await I(N,j,vt,dt),vt})(N,j,dt)}}})(Wt,st,Ye),Wt,Je,es,(v=>({...v,channelCount:v.numberOfOutputs}))),Js=((v,M,I,V)=>(N,{offset:j,...dt})=>{const vt=N.createBuffer(1,2,44100),yt=M(N,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),xt=I(N,{...dt,gain:j}),wt=vt.getChannelData(0);wt[0]=1,wt[1]=1,yt.buffer=vt,yt.loop=!0;const bt={get bufferSize(){},get channelCount(){return xt.channelCount},set channelCount(v){xt.channelCount=v},get channelCountMode(){return xt.channelCountMode},set channelCountMode(v){xt.channelCountMode=v},get channelInterpretation(){return xt.channelInterpretation},set channelInterpretation(v){xt.channelInterpretation=v},get context(){return xt.context},get inputs(){return[]},get numberOfInputs(){return yt.numberOfInputs},get numberOfOutputs(){return xt.numberOfOutputs},get offset(){return xt.gain},get onended(){return yt.onended},set onended(v){yt.onended=v},addEventListener:(...v)=>yt.addEventListener(v[0],v[1],v[2]),dispatchEvent:(...v)=>yt.dispatchEvent(v[0]),removeEventListener:(...v)=>yt.removeEventListener(v[0],v[1],v[2]),start(v=0){yt.start.call(yt,v)},stop(v=0){yt.stop.call(yt,v)}};return v(N,yt),V(Gt(bt,xt),(()=>yt.connect(xt)),(()=>yt.disconnect(xt)))})(bs,ks,Qt,Gs),Ks=((v,M,I,V,N)=>(j,dt)=>{if(void 0===j.createConstantSource)return I(j,dt);const vt=j.createConstantSource();return It(vt,dt),Nt(vt,dt,"offset"),M(V,(()=>V(j)))||Pt(vt),M(N,(()=>N(j)))||jt(vt),v(j,vt),vt})(bs,Pe,Js,ae,he),tn=((v,M,I,V,N,j,dt)=>class extends v{constructor(v,dt){const vt=N(v),yt={...ye,...dt},xt=V(vt,yt),wt=j(vt),bt=wt?I():null;super(v,!1,xt,bt),this._constantSourceNodeRenderer=bt,this._nativeConstantSourceNode=xt,this._offset=M(this,wt,xt.offset,ne,ee),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(v){const M="function"==typeof v?dt(this,v):null;this._nativeConstantSourceNode.onended=M;const I=this._nativeConstantSourceNode.onended;this._onended=null!==I&&I===M?v:I}start(v=0){if(this._nativeConstantSourceNode.start(v),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=v),"closed"!==this.context.state){C(this);const t=()=>{this._nativeConstantSourceNode.removeEventListener("ended",t),P(this)&&D(this)};this._nativeConstantSourceNode.addEventListener("ended",t)}}stop(v=0){this._nativeConstantSourceNode.stop(v),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=v)}})(ls,Ms,((v,M,I,V,N)=>()=>{const j=new WeakMap;let dt=null,vt=null;return{set start(v){dt=v},set stop(v){vt=v},render(yt,xt,wt){const bt=j.get(xt);return void 0!==bt?Promise.resolve(bt):(async(yt,xt,wt)=>{let bt=I(yt);const Tt=E(bt,xt);if(!Tt){const v={channelCount:bt.channelCount,channelCountMode:bt.channelCountMode,channelInterpretation:bt.channelInterpretation,offset:bt.offset.value};bt=M(xt,v),null!==dt&&bt.start(dt),null!==vt&&bt.stop(vt)}return j.set(xt,bt),Tt?await v(xt,yt.offset,bt.offset,wt):await V(xt,yt.offset,bt.offset,wt),await N(yt,xt,bt,wt),bt})(yt,xt,wt)}}})(Ss,Ks,st,As,Ye),Ks,Je,es,de),en=((v,M)=>(I,V)=>{const N=I.createConvolver();if(It(N,V),V.disableNormalization===N.normalize&&(N.normalize=!V.disableNormalization),Ft(N,V,"buffer"),V.channelCount>2)throw v();if(M(N,"channelCount",(v=>()=>v.call(N)),(M=>I=>{if(I>2)throw v();return M.call(N,I)})),"max"===V.channelCountMode)throw v();return M(N,"channelCountMode",(v=>()=>v.call(N)),(M=>I=>{if("max"===I)throw v();return M.call(N,I)})),N})(Ht,oe),sn=((v,M,I,V,N,j)=>class extends v{constructor(v,dt){const vt=V(v),yt={...xe,...dt},xt=I(vt,yt);super(v,!1,xt,N(vt)?M():null),this._isBufferNullified=!1,this._nativeConvolverNode=xt,null!==yt.buffer&&j(this,yt.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(v){if(this._nativeConvolverNode.buffer=v,null===v&&null!==this._nativeConvolverNode.buffer){const v=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=v.createBuffer(1,1,44100),this._isBufferNullified=!0,j(this,0)}else this._isBufferNullified=!1,j(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(v){this._nativeConvolverNode.normalize=v}})(ls,((v,M,I)=>()=>{const V=new WeakMap;return{render(N,j,dt){const vt=V.get(j);return void 0!==vt?Promise.resolve(vt):(async(N,j,dt)=>{let vt=M(N);if(!E(vt,j)){const M={buffer:vt.buffer,channelCount:vt.channelCount,channelCountMode:vt.channelCountMode,channelInterpretation:vt.channelInterpretation,disableNormalization:!vt.normalize};vt=v(j,M)}return V.set(j,vt),H(vt)?await I(N,j,vt.inputs[0],dt):await I(N,j,vt,dt),vt})(N,j,dt)}}})(en,st,Ye),en,Je,es,Is),nn=((v,M,I,V,N,j,dt)=>class extends v{constructor(v,vt){const yt=N(v),xt={...we,...vt},wt=V(yt,xt),bt=j(yt);super(v,!1,wt,bt?I(xt.maxDelayTime):null),this._delayTime=M(this,bt,wt.delayTime),dt(this,xt.maxDelayTime)}get delayTime(){return this._delayTime}})(ls,Ms,((v,M,I,V,N)=>j=>{const dt=new WeakMap;return{render(vt,yt,xt){const wt=dt.get(yt);return void 0!==wt?Promise.resolve(wt):(async(vt,yt,xt)=>{let wt=I(vt);const bt=E(wt,yt);if(!bt){const v={channelCount:wt.channelCount,channelCountMode:wt.channelCountMode,channelInterpretation:wt.channelInterpretation,delayTime:wt.delayTime.value,maxDelayTime:j};wt=M(yt,v)}return dt.set(yt,wt),bt?await v(yt,vt.delayTime,wt.delayTime,xt):await V(yt,vt.delayTime,wt.delayTime,xt),await N(vt,yt,wt,xt),wt})(vt,yt,xt)}}})(Ss,Ut,st,As,Ye),Ut,Je,es,Is),on=(rn=Ht,(v,M)=>{const I=v.createDynamicsCompressor();if(It(I,M),M.channelCount>2)throw rn();if("max"===M.channelCountMode)throw rn();return Nt(I,M,"attack"),Nt(I,M,"knee"),Nt(I,M,"ratio"),Nt(I,M,"release"),Nt(I,M,"threshold"),I});var rn;const an=((v,M,I,V,N,j,dt,vt)=>class extends v{constructor(v,N){const yt=j(v),xt={...be,...N},wt=V(yt,xt),bt=dt(yt);super(v,!1,wt,bt?I():null),this._attack=M(this,bt,wt.attack),this._knee=M(this,bt,wt.knee),this._nativeDynamicsCompressorNode=wt,this._ratio=M(this,bt,wt.ratio),this._release=M(this,bt,wt.release),this._threshold=M(this,bt,wt.threshold),vt(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(v){const M=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=v,v>2)throw this._nativeDynamicsCompressorNode.channelCount=M,N()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(v){const M=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=v,"max"===v)throw this._nativeDynamicsCompressorNode.channelCountMode=M,N()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(ls,Ms,((v,M,I,V,N)=>()=>{const j=new WeakMap;return{render(dt,vt,yt){const xt=j.get(vt);return void 0!==xt?Promise.resolve(xt):(async(dt,vt,yt)=>{let xt=I(dt);const wt=E(xt,vt);if(!wt){const v={attack:xt.attack.value,channelCount:xt.channelCount,channelCountMode:xt.channelCountMode,channelInterpretation:xt.channelInterpretation,knee:xt.knee.value,ratio:xt.ratio.value,release:xt.release.value,threshold:xt.threshold.value};xt=M(vt,v)}return j.set(vt,xt),wt?(await v(vt,dt.attack,xt.attack,yt),await v(vt,dt.knee,xt.knee,yt),await v(vt,dt.ratio,xt.ratio,yt),await v(vt,dt.release,xt.release,yt),await v(vt,dt.threshold,xt.threshold,yt)):(await V(vt,dt.attack,xt.attack,yt),await V(vt,dt.knee,xt.knee,yt),await V(vt,dt.ratio,xt.ratio,yt),await V(vt,dt.release,xt.release,yt),await V(vt,dt.threshold,xt.threshold,yt)),await N(dt,vt,xt,yt),xt})(dt,vt,yt)}}})(Ss,on,st,As,Ye),on,Ht,Je,es,Is),cn=((v,M,I,V,N,j)=>class extends v{constructor(v,dt){const vt=N(v),yt={...Te,...dt},xt=V(vt,yt),wt=j(vt);super(v,!1,xt,wt?I():null),this._gain=M(this,wt,xt.gain,ne,ee)}get gain(){return this._gain}})(ls,Ms,((v,M,I,V,N)=>()=>{const j=new WeakMap;return{render(dt,vt,yt){const xt=j.get(vt);return void 0!==xt?Promise.resolve(xt):(async(dt,vt,yt)=>{let xt=I(dt);const wt=E(xt,vt);if(!wt){const v={channelCount:xt.channelCount,channelCountMode:xt.channelCountMode,channelInterpretation:xt.channelInterpretation,gain:xt.gain.value};xt=M(vt,v)}return j.set(vt,xt),wt?await v(vt,dt.gain,xt.gain,yt):await V(vt,dt.gain,xt.gain,yt),await N(dt,vt,xt,yt),xt})(dt,vt,yt)}}})(Ss,Qt,st,As,Ye),Qt,Je,es),hn=((v,M,I,V)=>(N,j,{channelCount:dt,channelCountMode:vt,channelInterpretation:yt,feedback:xt,feedforward:wt})=>{const bt=Lt(j,N.sampleRate),Tt=xt instanceof Float64Array?xt:new Float64Array(xt),kt=wt instanceof Float64Array?wt:new Float64Array(wt),Ct=Tt.length,Ot=kt.length,Et=Math.min(Ct,Ot);if(0===Ct||Ct>20)throw V();if(0===Tt[0])throw M();if(0===Ot||Ot>20)throw V();if(0===kt[0])throw M();if(1!==Tt[0]){for(let v=0;v<Ot;v+=1)kt[v]/=Tt[0];for(let v=1;v<Ct;v+=1)Tt[v]/=Tt[0]}const qt=I(N,bt,dt,dt);qt.channelCount=dt,qt.channelCountMode=vt,qt.channelInterpretation=yt;const $t=[],Jt=[],Kt=[];for(let v=0;v<dt;v+=1){$t.push(0);const v=new Float32Array(32),M=new Float32Array(32);v.fill(0),M.fill(0),Jt.push(v),Kt.push(M)}qt.onaudioprocess=v=>{const M=v.inputBuffer,I=v.outputBuffer,V=M.numberOfChannels;for(let v=0;v<V;v+=1){const V=M.getChannelData(v),N=I.getChannelData(v);$t[v]=Mt(Tt,Ct,kt,Ot,Et,Jt[v],Kt[v],$t[v],32,V,N)}};const te=N.sampleRate/2;return Gt({get bufferSize(){return bt},get channelCount(){return qt.channelCount},set channelCount(v){qt.channelCount=v},get channelCountMode(){return qt.channelCountMode},set channelCountMode(v){qt.channelCountMode=v},get channelInterpretation(){return qt.channelInterpretation},set channelInterpretation(v){qt.channelInterpretation=v},get context(){return qt.context},get inputs(){return[qt]},get numberOfInputs(){return qt.numberOfInputs},get numberOfOutputs(){return qt.numberOfOutputs},addEventListener:(...v)=>qt.addEventListener(v[0],v[1],v[2]),dispatchEvent:(...v)=>qt.dispatchEvent(v[0]),getFrequencyResponse(M,I,V){if(M.length!==I.length||I.length!==V.length)throw v();const N=M.length;for(let v=0;v<N;v+=1){const N=-Math.PI*(M[v]/te),j=[Math.cos(N),Math.sin(N)],dt=Zt(Xt(kt,j),Xt(Tt,j));I[v]=Math.sqrt(dt[0]*dt[0]+dt[1]*dt[1]),V[v]=Math.atan2(dt[1],dt[0])}},removeEventListener:(...v)=>qt.removeEventListener(v[0],v[1],v[2])},qt)})(Dt,At,Yt,Ht),un=((v,M,I,V)=>N=>v(Rt,(()=>Rt(N)))?Promise.resolve(v(V,V)).then((v=>{if(!v){const v=I(N,512,0,1);N.oncomplete=()=>{v.onaudioprocess=null,v.disconnect()},v.onaudioprocess=()=>N.currentTime,v.connect(N.destination)}return N.startRendering()})):new Promise((v=>{const I=M(N,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});N.oncomplete=M=>{I.disconnect(),v(M.renderedBuffer)},I.connect(N.destination),N.startRendering()})))(Pe,Qt,Yt,((v,M)=>()=>{if(null===M)return Promise.resolve(!1);const I=new M(1,1,44100),V=v(I,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise((v=>{I.oncomplete=()=>{V.disconnect(),v(0!==I.currentTime)},I.startRendering()}))})(Qt,ts)),ln=((v,M,I,V,N)=>(j,dt)=>{const vt=new WeakMap;let yt=null;const h=async(xt,wt,bt)=>{let Tt=null,kt=M(xt);const Ct=E(kt,wt);if(void 0===wt.createIIRFilter?Tt=v(wt,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):Ct||(kt=wt.createIIRFilter(dt,j)),vt.set(wt,null===Tt?kt:Tt),null!==Tt){if(null===yt){if(null===I)throw new Error("Missing the native OfflineAudioContext constructor.");const v=new I(xt.context.destination.channelCount,xt.context.length,wt.sampleRate);yt=(async()=>{await V(xt,v,v.destination,bt);return((v,M,I,V)=>{const N=I instanceof Float64Array?I:new Float64Array(I),j=V instanceof Float64Array?V:new Float64Array(V),dt=N.length,vt=j.length,yt=Math.min(dt,vt);if(1!==N[0]){for(let v=0;v<dt;v+=1)j[v]/=N[0];for(let v=1;v<vt;v+=1)N[v]/=N[0]}const xt=new Float32Array(32),wt=new Float32Array(32),bt=M.createBuffer(v.numberOfChannels,v.length,v.sampleRate),Tt=v.numberOfChannels;for(let M=0;M<Tt;M+=1){const I=v.getChannelData(M),V=bt.getChannelData(M);xt.fill(0),wt.fill(0),Mt(N,dt,j,vt,yt,xt,wt,0,32,I,V)}return bt})(await N(v),wt,j,dt)})()}const v=await yt;return Tt.buffer=v,Tt.start(0),Tt}return await V(xt,wt,kt,bt),kt};return{render(v,M,I){const V=vt.get(M);return void 0!==V?Promise.resolve(V):h(v,M,I)}}})(ks,st,ts,Ye,un);var dn;const pn=((v,M,I,V,N,j)=>class extends v{constructor(v,dt){const vt=V(v),yt=N(vt),xt={...De,...dt},wt=M(vt,yt?null:v.baseLatency,xt);super(v,!1,wt,yt?I(xt.feedback,xt.feedforward):null),(v=>{var M;v.getFrequencyResponse=(M=v.getFrequencyResponse,(I,V,N)=>{if(I.length!==V.length||V.length!==N.length)throw Dt();return M.call(v,I,V,N)})})(wt),this._nativeIIRFilterNode=wt,j(this,1)}getFrequencyResponse(v,M,I){return this._nativeIIRFilterNode.getFrequencyResponse(v,M,I)}})(ls,(dn=hn,(v,M,I)=>{if(void 0===v.createIIRFilter)return dn(v,M,I);const V=v.createIIRFilter(I.feedforward,I.feedback);return It(V,I),V}),ln,Je,es,Is),fn=((v,M,I,V,N)=>(j,dt)=>{const vt=dt.listener,{forwardX:yt,forwardY:xt,forwardZ:wt,positionX:bt,positionY:Tt,positionZ:kt,upX:Ct,upY:Ot,upZ:Et}=void 0===vt.forwardX?(()=>{const yt=M(dt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),xt=N(dt),wt=V(dt,256,9,0),l=(M,V)=>{const N=I(dt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:V});return N.connect(yt,0,M),N.start(),Object.defineProperty(N.offset,"defaultValue",{get:()=>V}),v({context:j},xt,N.offset,ne,ee)};let bt=[0,0,-1,0,1,0],Tt=[0,0,0];return wt.onaudioprocess=({inputBuffer:v})=>{const M=[v.getChannelData(0)[0],v.getChannelData(1)[0],v.getChannelData(2)[0],v.getChannelData(3)[0],v.getChannelData(4)[0],v.getChannelData(5)[0]];M.some(((v,M)=>v!==bt[M]))&&(vt.setOrientation(...M),bt=M);const I=[v.getChannelData(6)[0],v.getChannelData(7)[0],v.getChannelData(8)[0]];I.some(((v,M)=>v!==Tt[M]))&&(vt.setPosition(...I),Tt=I)},yt.connect(wt),{forwardX:l(0,0),forwardY:l(1,0),forwardZ:l(2,-1),positionX:l(6,0),positionY:l(7,0),positionZ:l(8,0),upX:l(3,0),upY:l(4,1),upZ:l(5,0)}})():vt;return{get forwardX(){return yt},get forwardY(){return xt},get forwardZ(){return wt},get positionX(){return bt},get positionY(){return Tt},get positionZ(){return kt},get upX(){return Ct},get upY(){return Ot},get upZ(){return Et}}})(Ms,Zs,Ks,Yt,es),_n=new WeakMap,mn=((v,M,I,V,N,j)=>class extends I{constructor(I,j){super(I),this._nativeContext=I,kt.set(this,I),V(I)&&N.set(I,new Set),this._destination=new v(this,j),this._listener=M(this,I),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(v){const M="function"==typeof v?j(this,v):null;this._nativeContext.onstatechange=M;const I=this._nativeContext.onstatechange;this._onstatechange=null!==I&&I===M?v:I}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(qs,fn,is,es,_n,de),gn=((v,M,I,V,N,j)=>(dt,vt)=>{const yt=dt.createOscillator();return It(yt,vt),Nt(yt,vt,"detune"),Nt(yt,vt,"frequency"),void 0!==vt.periodicWave?yt.setPeriodicWave(vt.periodicWave):Ft(yt,vt,"type"),M(I,(()=>I(dt)))||Pt(yt),M(V,(()=>V(dt)))||j(yt,dt),M(N,(()=>N(dt)))||jt(yt),v(dt,yt),yt})(bs,Pe,ae,ce,he,pe),vn=((v,M,I,V,N,j,dt)=>class extends v{constructor(v,dt){const vt=N(v),yt={...Ce,...dt},xt=I(vt,yt),wt=j(vt),bt=wt?V():null,Tt=v.sampleRate/2;super(v,!1,xt,bt),this._detune=M(this,wt,xt.detune,153600,-153600),this._frequency=M(this,wt,xt.frequency,Tt,-Tt),this._nativeOscillatorNode=xt,this._onended=null,this._oscillatorNodeRenderer=bt,null!==this._oscillatorNodeRenderer&&void 0!==yt.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=yt.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(v){const M="function"==typeof v?dt(this,v):null;this._nativeOscillatorNode.onended=M;const I=this._nativeOscillatorNode.onended;this._onended=null!==I&&I===M?v:I}get type(){return this._nativeOscillatorNode.type}set type(v){this._nativeOscillatorNode.type=v,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(v){this._nativeOscillatorNode.setPeriodicWave(v),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=v)}start(v=0){if(this._nativeOscillatorNode.start(v),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=v),"closed"!==this.context.state){C(this);const t=()=>{this._nativeOscillatorNode.removeEventListener("ended",t),P(this)&&D(this)};this._nativeOscillatorNode.addEventListener("ended",t)}}stop(v=0){this._nativeOscillatorNode.stop(v),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=v)}})(ls,Ms,gn,((v,M,I,V,N)=>()=>{const j=new WeakMap;let dt=null,vt=null,yt=null;return{set periodicWave(v){dt=v},set start(v){vt=v},set stop(v){yt=v},render(xt,wt,bt){const Tt=j.get(wt);return void 0!==Tt?Promise.resolve(Tt):(async(xt,wt,bt)=>{let Tt=I(xt);const kt=E(Tt,wt);if(!kt){const v={channelCount:Tt.channelCount,channelCountMode:Tt.channelCountMode,channelInterpretation:Tt.channelInterpretation,detune:Tt.detune.value,frequency:Tt.frequency.value,periodicWave:null===dt?void 0:dt,type:Tt.type};Tt=M(wt,v),null!==vt&&Tt.start(vt),null!==yt&&Tt.stop(yt)}return j.set(wt,Tt),kt?(await v(wt,xt.detune,Tt.detune,bt),await v(wt,xt.frequency,Tt.frequency,bt)):(await V(wt,xt.detune,Tt.detune,bt),await V(wt,xt.frequency,Tt.frequency,bt)),await N(xt,wt,Tt,bt),Tt})(xt,wt,bt)}}})(Ss,gn,st,As,Ye),Je,es,de),yn=(xn=ks,(v,M)=>{const I=xn(v,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),V=v.createBuffer(1,2,44100);return I.buffer=V,I.loop=!0,I.connect(M),I.start(),()=>{I.stop(),I.disconnect(M)}});var xn;const wn=((v,M,I,V,N)=>(j,{curve:dt,oversample:vt,...yt})=>{const xt=j.createWaveShaper(),wt=j.createWaveShaper();It(xt,yt),It(wt,yt);const bt=I(j,{...yt,gain:1}),Tt=I(j,{...yt,gain:-1}),kt=I(j,{...yt,gain:1}),Ct=I(j,{...yt,gain:-1});let Ot=null,Et=!1,qt=null;const $t={get bufferSize(){},get channelCount(){return xt.channelCount},set channelCount(v){bt.channelCount=v,Tt.channelCount=v,xt.channelCount=v,kt.channelCount=v,wt.channelCount=v,Ct.channelCount=v},get channelCountMode(){return xt.channelCountMode},set channelCountMode(v){bt.channelCountMode=v,Tt.channelCountMode=v,xt.channelCountMode=v,kt.channelCountMode=v,wt.channelCountMode=v,Ct.channelCountMode=v},get channelInterpretation(){return xt.channelInterpretation},set channelInterpretation(v){bt.channelInterpretation=v,Tt.channelInterpretation=v,xt.channelInterpretation=v,kt.channelInterpretation=v,wt.channelInterpretation=v,Ct.channelInterpretation=v},get context(){return xt.context},get curve(){return qt},set curve(I){if(null!==I&&I.length<2)throw M();if(null===I)xt.curve=I,wt.curve=I;else{const v=I.length,M=new Float32Array(v+2-v%2),V=new Float32Array(v+2-v%2);M[0]=I[0],V[0]=-I[v-1];const N=Math.ceil((v+1)/2),j=(v+1)/2-1;for(let dt=1;dt<N;dt+=1){const vt=dt/N*j,yt=Math.floor(vt),xt=Math.ceil(vt);M[dt]=yt===xt?I[yt]:(1-(vt-yt))*I[yt]+(1-(xt-vt))*I[xt],V[dt]=yt===xt?-I[v-1-yt]:-(1-(vt-yt))*I[v-1-yt]-(1-(xt-vt))*I[v-1-xt]}M[N]=v%2==1?I[N-1]:(I[N-2]+I[N-1])/2,xt.curve=M,wt.curve=V}qt=I,Et&&(V(qt)&&null===Ot?Ot=v(j,bt):null!==Ot&&(Ot(),Ot=null))},get inputs(){return[bt]},get numberOfInputs(){return xt.numberOfInputs},get numberOfOutputs(){return xt.numberOfOutputs},get oversample(){return xt.oversample},set oversample(v){xt.oversample=v,wt.oversample=v},addEventListener:(...v)=>bt.addEventListener(v[0],v[1],v[2]),dispatchEvent:(...v)=>bt.dispatchEvent(v[0]),removeEventListener:(...v)=>bt.removeEventListener(v[0],v[1],v[2])};null!==dt&&($t.curve=dt instanceof Float32Array?dt:new Float32Array(dt)),vt!==$t.oversample&&($t.oversample=vt);return N(Gt($t,kt),(()=>{bt.connect(xt).connect(kt),bt.connect(Tt).connect(wt).connect(Ct).connect(kt),Et=!0,V(qt)&&(Ot=v(j,bt))}),(()=>{bt.disconnect(xt),xt.disconnect(kt),bt.disconnect(Tt),Tt.disconnect(wt),wt.disconnect(Ct),Ct.disconnect(kt),Et=!1,null!==Ot&&(Ot(),Ot=null)}))})(yn,At,Qt,ie,Gs),bn=((v,M,I,V,N,j,dt)=>(vt,yt)=>{const xt=vt.createWaveShaper();if(null!==j&&"webkitAudioContext"===j.name&&void 0===vt.createGain().gain.automationRate)return I(vt,yt);It(xt,yt);const wt=null===yt.curve||yt.curve instanceof Float32Array?yt.curve:new Float32Array(yt.curve);if(null!==wt&&wt.length<2)throw M();Ft(xt,{curve:wt},"curve"),Ft(xt,yt,"oversample");let bt=null,Tt=!1;dt(xt,"curve",(v=>()=>v.call(xt)),(M=>I=>(M.call(xt,I),Tt&&(V(I)&&null===bt?bt=v(vt,xt):V(I)||null===bt||(bt(),bt=null)),I)));return N(xt,(()=>{Tt=!0,V(xt.curve)&&(bt=v(vt,xt))}),(()=>{Tt=!1,null!==bt&&(bt(),bt=null)}))})(yn,At,wn,ie,Gs,rs,oe),Tn=((v,M,I,V,N,j,dt,vt,yt)=>(xt,{coneInnerAngle:wt,coneOuterAngle:bt,coneOuterGain:Tt,distanceModel:kt,maxDistance:Ct,orientationX:Ot,orientationY:Et,orientationZ:qt,panningModel:$t,positionX:Jt,positionY:Kt,positionZ:te,refDistance:ee,rolloffFactor:ne,...fe})=>{const _e=xt.createPanner();if(fe.channelCount>2)throw dt();if("max"===fe.channelCountMode)throw dt();It(_e,fe);const me={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},ge=I(xt,{...me,channelInterpretation:"speakers",numberOfInputs:6}),ve=V(xt,{...fe,gain:1}),ye=V(xt,{...me,gain:1}),xe=V(xt,{...me,gain:0}),we=V(xt,{...me,gain:0}),be=V(xt,{...me,gain:0}),Te=V(xt,{...me,gain:0}),De=V(xt,{...me,gain:0}),Se=N(xt,256,6,1),ke=j(xt,{...me,curve:new Float32Array([1,1]),oversample:"none"});let Ce=[Ot,Et,qt],Ae=[Jt,Kt,te];Se.onaudioprocess=({inputBuffer:v})=>{const M=[v.getChannelData(0)[0],v.getChannelData(1)[0],v.getChannelData(2)[0]];M.some(((v,M)=>v!==Ce[M]))&&(_e.setOrientation(...M),Ce=M);const I=[v.getChannelData(3)[0],v.getChannelData(4)[0],v.getChannelData(5)[0]];I.some(((v,M)=>v!==Ae[M]))&&(_e.setPosition(...I),Ae=I)},Object.defineProperty(xe.gain,"defaultValue",{get:()=>0}),Object.defineProperty(we.gain,"defaultValue",{get:()=>0}),Object.defineProperty(be.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Te.gain,"defaultValue",{get:()=>0}),Object.defineProperty(De.gain,"defaultValue",{get:()=>0});const Oe={get bufferSize(){},get channelCount(){return _e.channelCount},set channelCount(v){if(v>2)throw dt();ve.channelCount=v,_e.channelCount=v},get channelCountMode(){return _e.channelCountMode},set channelCountMode(v){if("max"===v)throw dt();ve.channelCountMode=v,_e.channelCountMode=v},get channelInterpretation(){return _e.channelInterpretation},set channelInterpretation(v){ve.channelInterpretation=v,_e.channelInterpretation=v},get coneInnerAngle(){return _e.coneInnerAngle},set coneInnerAngle(v){_e.coneInnerAngle=v},get coneOuterAngle(){return _e.coneOuterAngle},set coneOuterAngle(v){_e.coneOuterAngle=v},get coneOuterGain(){return _e.coneOuterGain},set coneOuterGain(v){if(v<0||v>1)throw M();_e.coneOuterGain=v},get context(){return _e.context},get distanceModel(){return _e.distanceModel},set distanceModel(v){_e.distanceModel=v},get inputs(){return[ve]},get maxDistance(){return _e.maxDistance},set maxDistance(v){if(v<0)throw new RangeError;_e.maxDistance=v},get numberOfInputs(){return _e.numberOfInputs},get numberOfOutputs(){return _e.numberOfOutputs},get orientationX(){return ye.gain},get orientationY(){return xe.gain},get orientationZ(){return we.gain},get panningModel(){return _e.panningModel},set panningModel(v){_e.panningModel=v},get positionX(){return be.gain},get positionY(){return Te.gain},get positionZ(){return De.gain},get refDistance(){return _e.refDistance},set refDistance(v){if(v<0)throw new RangeError;_e.refDistance=v},get rolloffFactor(){return _e.rolloffFactor},set rolloffFactor(v){if(v<0)throw new RangeError;_e.rolloffFactor=v},addEventListener:(...v)=>ve.addEventListener(v[0],v[1],v[2]),dispatchEvent:(...v)=>ve.dispatchEvent(v[0]),removeEventListener:(...v)=>ve.removeEventListener(v[0],v[1],v[2])};wt!==Oe.coneInnerAngle&&(Oe.coneInnerAngle=wt),bt!==Oe.coneOuterAngle&&(Oe.coneOuterAngle=bt),Tt!==Oe.coneOuterGain&&(Oe.coneOuterGain=Tt),kt!==Oe.distanceModel&&(Oe.distanceModel=kt),Ct!==Oe.maxDistance&&(Oe.maxDistance=Ct),Ot!==Oe.orientationX.value&&(Oe.orientationX.value=Ot),Et!==Oe.orientationY.value&&(Oe.orientationY.value=Et),qt!==Oe.orientationZ.value&&(Oe.orientationZ.value=qt),$t!==Oe.panningModel&&(Oe.panningModel=$t),Jt!==Oe.positionX.value&&(Oe.positionX.value=Jt),Kt!==Oe.positionY.value&&(Oe.positionY.value=Kt),te!==Oe.positionZ.value&&(Oe.positionZ.value=te),ee!==Oe.refDistance&&(Oe.refDistance=ee),ne!==Oe.rolloffFactor&&(Oe.rolloffFactor=ne),1===Ce[0]&&0===Ce[1]&&0===Ce[2]||_e.setOrientation(...Ce),0===Ae[0]&&0===Ae[1]&&0===Ae[2]||_e.setPosition(...Ae);return yt(Gt(Oe,_e),(()=>{ve.connect(_e),v(ve,ke,0,0),ke.connect(ye).connect(ge,0,0),ke.connect(xe).connect(ge,0,1),ke.connect(we).connect(ge,0,2),ke.connect(be).connect(ge,0,3),ke.connect(Te).connect(ge,0,4),ke.connect(De).connect(ge,0,5),ge.connect(Se).connect(xt.destination)}),(()=>{ve.disconnect(_e),vt(ve,ke,0,0),ke.disconnect(ye),ye.disconnect(ge),ke.disconnect(xe),xe.disconnect(ge),ke.disconnect(we),we.disconnect(ge),ke.disconnect(be),be.disconnect(ge),ke.disconnect(Te),Te.disconnect(ge),ke.disconnect(De),De.disconnect(ge),ge.disconnect(Se),Se.disconnect(xt.destination)}))})($,At,Zs,Qt,Yt,bn,Ht,et,Gs),Dn=(Sn=Tn,(v,M)=>{const I=v.createPanner();return void 0===I.orientationX?Sn(v,M):(It(I,M),Nt(I,M,"orientationX"),Nt(I,M,"orientationY"),Nt(I,M,"orientationZ"),Nt(I,M,"positionX"),Nt(I,M,"positionY"),Nt(I,M,"positionZ"),Ft(I,M,"coneInnerAngle"),Ft(I,M,"coneOuterAngle"),Ft(I,M,"coneOuterGain"),Ft(I,M,"distanceModel"),Ft(I,M,"maxDistance"),Ft(I,M,"panningModel"),Ft(I,M,"refDistance"),Ft(I,M,"rolloffFactor"),I)});var Sn;const kn=((v,M,I,V,N,j,dt)=>class extends v{constructor(v,vt){const yt=N(v),xt={...Ae,...vt},wt=I(yt,xt),bt=j(yt);super(v,!1,wt,bt?V():null),this._nativePannerNode=wt,this._orientationX=M(this,bt,wt.orientationX,ne,ee),this._orientationY=M(this,bt,wt.orientationY,ne,ee),this._orientationZ=M(this,bt,wt.orientationZ,ne,ee),this._positionX=M(this,bt,wt.positionX,ne,ee),this._positionY=M(this,bt,wt.positionY,ne,ee),this._positionZ=M(this,bt,wt.positionZ,ne,ee),dt(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(v){this._nativePannerNode.coneInnerAngle=v}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(v){this._nativePannerNode.coneOuterAngle=v}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(v){this._nativePannerNode.coneOuterGain=v}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(v){this._nativePannerNode.distanceModel=v}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(v){this._nativePannerNode.maxDistance=v}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(v){this._nativePannerNode.panningModel=v}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(v){this._nativePannerNode.refDistance=v}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(v){this._nativePannerNode.rolloffFactor=v}})(ls,Ms,Dn,((v,M,I,V,N,j,dt,vt,yt,xt)=>()=>{const wt=new WeakMap;let bt=null;return{render(Tt,kt,Ct){const Ot=wt.get(kt);return void 0!==Ot?Promise.resolve(Ot):(async(Tt,kt,Ct)=>{let Ot=null,Et=j(Tt);const qt={channelCount:Et.channelCount,channelCountMode:Et.channelCountMode,channelInterpretation:Et.channelInterpretation},$t={...qt,coneInnerAngle:Et.coneInnerAngle,coneOuterAngle:Et.coneOuterAngle,coneOuterGain:Et.coneOuterGain,distanceModel:Et.distanceModel,maxDistance:Et.maxDistance,panningModel:Et.panningModel,refDistance:Et.refDistance,rolloffFactor:Et.rolloffFactor},Jt=E(Et,kt);if("bufferSize"in Et)Ot=V(kt,{...qt,gain:1});else if(!Jt){const v={...$t,orientationX:Et.orientationX.value,orientationY:Et.orientationY.value,orientationZ:Et.orientationZ.value,positionX:Et.positionX.value,positionY:Et.positionY.value,positionZ:Et.positionZ.value};Et=N(kt,v)}if(wt.set(kt,null===Ot?Et:Ot),null!==Ot){if(null===bt){if(null===dt)throw new Error("Missing the native OfflineAudioContext constructor.");const v=new dt(6,Tt.context.length,kt.sampleRate),V=M(v,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});V.connect(v.destination),bt=(async()=>{const M=await Promise.all([Tt.orientationX,Tt.orientationY,Tt.orientationZ,Tt.positionX,Tt.positionY,Tt.positionZ].map((async(M,V)=>{const N=I(v,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===V?1:0});return await vt(v,M,N.offset,Ct),N})));for(let v=0;v<6;v+=1)M[v].connect(V,0,v),M[v].start(0);return xt(v)})()}const v=await bt,j=V(kt,{...qt,gain:1});await yt(Tt,kt,j,Ct);const wt=[];for(let M=0;M<v.numberOfChannels;M+=1)wt.push(v.getChannelData(M));let Et=[wt[0][0],wt[1][0],wt[2][0]],Jt=[wt[3][0],wt[4][0],wt[5][0]],Kt=V(kt,{...qt,gain:1}),te=N(kt,{...$t,orientationX:Et[0],orientationY:Et[1],orientationZ:Et[2],positionX:Jt[0],positionY:Jt[1],positionZ:Jt[2]});j.connect(Kt).connect(te.inputs[0]),te.connect(Ot);for(let M=128;M<v.length;M+=128){const v=[wt[0][M],wt[1][M],wt[2][M]],I=[wt[3][M],wt[4][M],wt[5][M]];if(v.some(((v,M)=>v!==Et[M]))||I.some(((v,M)=>v!==Jt[M]))){Et=v,Jt=I;const dt=M/kt.sampleRate;Kt.gain.setValueAtTime(0,dt),Kt=V(kt,{...qt,gain:0}),te=N(kt,{...$t,orientationX:Et[0],orientationY:Et[1],orientationZ:Et[2],positionX:Jt[0],positionY:Jt[1],positionZ:Jt[2]}),Kt.gain.setValueAtTime(1,dt),j.connect(Kt).connect(te.inputs[0]),te.connect(Ot)}}return Ot}return Jt?(await v(kt,Tt.orientationX,Et.orientationX,Ct),await v(kt,Tt.orientationY,Et.orientationY,Ct),await v(kt,Tt.orientationZ,Et.orientationZ,Ct),await v(kt,Tt.positionX,Et.positionX,Ct),await v(kt,Tt.positionY,Et.positionY,Ct),await v(kt,Tt.positionZ,Et.positionZ,Ct)):(await vt(kt,Tt.orientationX,Et.orientationX,Ct),await vt(kt,Tt.orientationY,Et.orientationY,Ct),await vt(kt,Tt.orientationZ,Et.orientationZ,Ct),await vt(kt,Tt.positionX,Et.positionX,Ct),await vt(kt,Tt.positionY,Et.positionY,Ct),await vt(kt,Tt.positionZ,Et.positionZ,Ct)),H(Et)?await yt(Tt,kt,Et.inputs[0],Ct):await yt(Tt,kt,Et,Ct),Et})(Tt,kt,Ct)}}})(Ss,Zs,Ks,Qt,Dn,st,ts,As,Ye,un),Je,es,Is),Cn=((v,M,I,V)=>class i{constructor(N,j){const dt=M(N),vt=V({...Oe,...j}),yt=v(dt,vt);return I.add(yt),yt}static[Symbol.hasInstance](v){return null!==v&&"object"==typeof v&&Object.getPrototypeOf(v)===i.prototype||I.has(v)}})((v=>(M,{disableNormalization:I,imag:V,real:N})=>{const j=V instanceof Float32Array?V:new Float32Array(V),dt=N instanceof Float32Array?N:new Float32Array(N),vt=M.createPeriodicWave(dt,j,{disableNormalization:I});if(Array.from(V).length<2)throw v();return vt})(q),Je,new WeakSet,(v=>{const{imag:M,real:I}=v;return void 0===M?void 0===I?{...v,imag:[0,0],real:[0,0]}:{...v,imag:Array.from(I,(()=>0)),real:I}:void 0===I?{...v,imag:M,real:Array.from(M,(()=>0))}:{...v,imag:M,real:I}})),An=((v,M)=>(I,V)=>{const N=V.channelCountMode;if("clamped-max"===N)throw M();if(void 0===I.createStereoPanner)return v(I,V);const j=I.createStereoPanner();return It(j,V),Nt(j,V,"pan"),Object.defineProperty(j,"channelCountMode",{get:()=>N,set:v=>{if(v!==N)throw M()}}),j})(((v,M,I,V,N,j)=>{const dt=new Float32Array([1,1]),vt=Math.PI/2,yt={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},xt={...yt,oversample:"none"},u=(v,j,wt,bt,Tt)=>{if(1===j)return((v,M,N,j)=>{const wt=new Float32Array(16385),bt=new Float32Array(16385);for(let v=0;v<16385;v+=1){const M=v/16384*vt;wt[v]=Math.cos(M),bt[v]=Math.sin(M)}const Tt=I(v,{...yt,gain:0}),kt=V(v,{...xt,curve:wt}),Ct=V(v,{...xt,curve:dt}),Ot=I(v,{...yt,gain:0}),Et=V(v,{...xt,curve:bt});return{connectGraph(){M.connect(Tt),M.connect(void 0===Ct.inputs?Ct:Ct.inputs[0]),M.connect(Ot),Ct.connect(N),N.connect(void 0===kt.inputs?kt:kt.inputs[0]),N.connect(void 0===Et.inputs?Et:Et.inputs[0]),kt.connect(Tt.gain),Et.connect(Ot.gain),Tt.connect(j,0,0),Ot.connect(j,0,1)},disconnectGraph(){M.disconnect(Tt),M.disconnect(void 0===Ct.inputs?Ct:Ct.inputs[0]),M.disconnect(Ot),Ct.disconnect(N),N.disconnect(void 0===kt.inputs?kt:kt.inputs[0]),N.disconnect(void 0===Et.inputs?Et:Et.inputs[0]),kt.disconnect(Tt.gain),Et.disconnect(Ot.gain),Tt.disconnect(j,0,0),Ot.disconnect(j,0,1)}}})(v,wt,bt,Tt);if(2===j)return((v,N,j,wt)=>{const bt=new Float32Array(16385),Tt=new Float32Array(16385),kt=new Float32Array(16385),Ct=new Float32Array(16385),Ot=Math.floor(8192.5);for(let v=0;v<16385;v+=1)if(v>Ot){const M=(v-Ot)/(16384-Ot)*vt;bt[v]=Math.cos(M),Tt[v]=Math.sin(M),kt[v]=0,Ct[v]=1}else{const M=v/(16384-Ot)*vt;bt[v]=1,Tt[v]=0,kt[v]=Math.cos(M),Ct[v]=Math.sin(M)}const Et=M(v,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),qt=I(v,{...yt,gain:0}),$t=V(v,{...xt,curve:bt}),Jt=I(v,{...yt,gain:0}),Kt=V(v,{...xt,curve:Tt}),te=V(v,{...xt,curve:dt}),ee=I(v,{...yt,gain:0}),ne=V(v,{...xt,curve:kt}),fe=I(v,{...yt,gain:0}),_e=V(v,{...xt,curve:Ct});return{connectGraph(){N.connect(Et),N.connect(void 0===te.inputs?te:te.inputs[0]),Et.connect(qt,0),Et.connect(Jt,0),Et.connect(ee,1),Et.connect(fe,1),te.connect(j),j.connect(void 0===$t.inputs?$t:$t.inputs[0]),j.connect(void 0===Kt.inputs?Kt:Kt.inputs[0]),j.connect(void 0===ne.inputs?ne:ne.inputs[0]),j.connect(void 0===_e.inputs?_e:_e.inputs[0]),$t.connect(qt.gain),Kt.connect(Jt.gain),ne.connect(ee.gain),_e.connect(fe.gain),qt.connect(wt,0,0),ee.connect(wt,0,0),Jt.connect(wt,0,1),fe.connect(wt,0,1)},disconnectGraph(){N.disconnect(Et),N.disconnect(void 0===te.inputs?te:te.inputs[0]),Et.disconnect(qt,0),Et.disconnect(Jt,0),Et.disconnect(ee,1),Et.disconnect(fe,1),te.disconnect(j),j.disconnect(void 0===$t.inputs?$t:$t.inputs[0]),j.disconnect(void 0===Kt.inputs?Kt:Kt.inputs[0]),j.disconnect(void 0===ne.inputs?ne:ne.inputs[0]),j.disconnect(void 0===_e.inputs?_e:_e.inputs[0]),$t.disconnect(qt.gain),Kt.disconnect(Jt.gain),ne.disconnect(ee.gain),_e.disconnect(fe.gain),qt.disconnect(wt,0,0),ee.disconnect(wt,0,0),Jt.disconnect(wt,0,1),fe.disconnect(wt,0,1)}}})(v,wt,bt,Tt);throw N()};return(M,{channelCount:V,channelCountMode:dt,pan:vt,...yt})=>{if("max"===dt)throw N();const xt=v(M,{...yt,channelCount:1,channelCountMode:dt,numberOfInputs:2}),wt=I(M,{...yt,channelCount:V,channelCountMode:dt,gain:1}),bt=I(M,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:vt});let{connectGraph:Tt,disconnectGraph:kt}=u(M,V,wt,bt,xt);Object.defineProperty(bt.gain,"defaultValue",{get:()=>0}),Object.defineProperty(bt.gain,"maxValue",{get:()=>1}),Object.defineProperty(bt.gain,"minValue",{get:()=>-1});const Ct={get bufferSize(){},get channelCount(){return wt.channelCount},set channelCount(v){wt.channelCount!==v&&(Ot&&kt(),({connectGraph:Tt,disconnectGraph:kt}=u(M,v,wt,bt,xt)),Ot&&Tt()),wt.channelCount=v},get channelCountMode(){return wt.channelCountMode},set channelCountMode(v){if("clamped-max"===v||"max"===v)throw N();wt.channelCountMode=v},get channelInterpretation(){return wt.channelInterpretation},set channelInterpretation(v){wt.channelInterpretation=v},get context(){return wt.context},get inputs(){return[wt]},get numberOfInputs(){return wt.numberOfInputs},get numberOfOutputs(){return wt.numberOfOutputs},get pan(){return bt.gain},addEventListener:(...v)=>wt.addEventListener(v[0],v[1],v[2]),dispatchEvent:(...v)=>wt.dispatchEvent(v[0]),removeEventListener:(...v)=>wt.removeEventListener(v[0],v[1],v[2])};let Ot=!1;return j(Gt(Ct,xt),(()=>{Tt(),Ot=!0}),(()=>{kt(),Ot=!1}))}})(Zs,Wt,Qt,bn,Ht,Gs),Ht),On=((v,M,I,V,N,j)=>class extends v{constructor(v,dt){const vt=N(v),yt={...Me,...dt},xt=I(vt,yt),wt=j(vt);super(v,!1,xt,wt?V():null),this._pan=M(this,wt,xt.pan)}get pan(){return this._pan}})(ls,Ms,An,((v,M,I,V,N)=>()=>{const j=new WeakMap;return{render(dt,vt,yt){const xt=j.get(vt);return void 0!==xt?Promise.resolve(xt):(async(dt,vt,yt)=>{let xt=I(dt);const wt=E(xt,vt);if(!wt){const v={channelCount:xt.channelCount,channelCountMode:xt.channelCountMode,channelInterpretation:xt.channelInterpretation,pan:xt.pan.value};xt=M(vt,v)}return j.set(vt,xt),wt?await v(vt,dt.pan,xt.pan,yt):await V(vt,dt.pan,xt.pan,yt),H(xt)?await N(dt,vt,xt.inputs[0],yt):await N(dt,vt,xt,yt),xt})(dt,vt,yt)}}})(Ss,An,st,As,Ye),Je,es),Mn=((v,M,I)=>()=>{const V=new WeakMap;return{render(N,j,dt){const vt=V.get(j);return void 0!==vt?Promise.resolve(vt):(async(N,j,dt)=>{let vt=M(N);if(!E(vt,j)){const M={channelCount:vt.channelCount,channelCountMode:vt.channelCountMode,channelInterpretation:vt.channelInterpretation,curve:vt.curve,oversample:vt.oversample};vt=v(j,M)}return V.set(j,vt),H(vt)?await I(N,j,vt.inputs[0],dt):await I(N,j,vt,dt),vt})(N,j,dt)}}})(bn,st,Ye),En=((v,M,I,V,N,j,dt)=>class extends v{constructor(v,M){const vt=N(v),yt={...Ee,...M},xt=I(vt,yt);super(v,!0,xt,j(vt)?V():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=xt,dt(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(v){if(null===v)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(v.length<2)throw M();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=v}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(v){this._nativeWaveShaperNode.oversample=v}})(ls,At,bn,Mn,Je,es,Is),Rn=(v=>null!==v&&v.isSecureContext)(ze),qn=(v=>(M,I,V)=>{Object.defineProperties(v,{currentFrame:{configurable:!0,get:()=>Math.round(M*I)},currentTime:{configurable:!0,get:()=>M}});try{return V()}finally{null!==v&&(delete v.currentFrame,delete v.currentTime)}})(ze),Fn=new WeakMap,In=((v,M)=>I=>{let V=v.get(I);if(void 0!==V)return V;if(null===M)throw new Error("Missing the native OfflineAudioContext constructor.");return V=new M(1,1,8e3),v.set(I,V),V})(Fn,ts),Vn=(v=>null===v?null:v.hasOwnProperty("AudioWorkletNode")?v.AudioWorkletNode:null)(ze),Nn=Rn?((v,M,I,V,N,j,dt,vt,yt,xt,wt,bt)=>(Tt,kt,Ct={credentials:"omit"})=>{const Ot=j(Tt);if(void 0!==Ot.audioWorklet)return Promise.all([N(kt),Promise.resolve(v(wt,wt))]).then((([[v,M],I])=>{const[V,N]=y(v,M),j=I?N:N.replace(/\s+extends\s+AudioWorkletProcessor\s*{/," extends (class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}){"),yt=new Blob([`${V};(registerProcessor=>{${j}\n})((n,p)=>registerProcessor(n,class extends p{${I?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${I?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}))`],{type:"application/javascript; charset=utf-8"}),xt=URL.createObjectURL(yt);return Ot.audioWorklet.addModule(xt,Ct).then((()=>{if(!vt(Ot))return dt(Ot).audioWorklet.addModule(xt,Ct)})).finally((()=>URL.revokeObjectURL(xt)))}));const qt=xt.get(Tt);if(void 0!==qt&&qt.has(kt))return Promise.resolve();const $t=yt.get(Tt);if(void 0!==$t){const v=$t.get(kt);if(void 0!==v)return v}const Jt=N(kt).then((([v,M])=>{const[V,N]=y(v,M);return I(`${V};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${N}\n})})(window,'_AWGS')`)})).then((()=>{const v=bt._AWGS.pop();if(void 0===v)throw new SyntaxError;V(Ot.currentTime,Ot.sampleRate,(()=>v(class{},void 0,((v,I)=>{if(""===v.trim())throw M();const V=Et.get(Ot);if(void 0!==V){if(V.has(v))throw M();w(I),x(I.parameterDescriptors),V.set(v,I)}else w(I),x(I.parameterDescriptors),Et.set(Ot,new Map([[v,I]]))}),Ot.sampleRate,void 0,void 0)))}));return void 0===$t?yt.set(Tt,new Map([[kt,Jt]])):$t.set(kt,Jt),Jt.then((()=>{const v=xt.get(Tt);void 0===v?xt.set(Tt,new Set([kt])):v.add(kt)})).finally((()=>{const v=yt.get(Tt);void 0!==v&&v.delete(kt)})),Jt})(Pe,Ht,(v=>M=>new Promise(((I,V)=>{if(null===v)return void V(new SyntaxError);const N=v.document.head;if(null===N)V(new SyntaxError);else{const j=v.document.createElement("script"),dt=new Blob([M],{type:"application/javascript"}),vt=URL.createObjectURL(dt),yt=v.onerror,h=()=>{v.onerror=yt,URL.revokeObjectURL(vt)};v.onerror=(M,I,N,j,dt)=>I===vt||I===v.location.href&&1===N&&1===j?(h(),V(dt),!1):null!==yt?yt(M,I,N,j,dt):void 0,j.onerror=()=>{h(),V(new SyntaxError)},j.onload=()=>{h(),I()},j.src=vt,j.type="module",N.appendChild(j)}})))(ze),qn,(v=>async M=>{try{const v=await fetch(M);if(v.ok)return[await v.text(),v.url]}catch{}throw v()})((()=>new DOMException("","AbortError"))),Je,In,es,new WeakMap,new WeakMap,((v,M)=>async()=>{if(null===v)return!0;if(null===M)return!1;const I=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),V=new M(1,128,8e3),N=URL.createObjectURL(I);let j=!1,dt=!1;try{await V.audioWorklet.addModule(N);const M=new v(V,"a",{numberOfOutputs:0}),I=V.createOscillator();M.port.onmessage=()=>j=!0,M.onprocessorerror=()=>dt=!0,I.connect(M),await V.startRendering()}catch{}finally{URL.revokeObjectURL(N)}return j&&!dt})(Vn,ts),ze):void 0,Pn=((v,M)=>I=>v(I)||M(I))(as,es),jn=((v,M,I,V,N,j,dt,vt,yt,xt,wt,bt,Tt,kt,Ct,Ot,Et,qt,$t,Jt)=>class extends Ct{constructor(M,I){super(M,I),this._nativeContext=M,this._audioWorklet=void 0===v?void 0:{addModule:(M,I)=>v(this,M,I)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new M(this)}createBiquadFilter(){return new N(this)}createBuffer(v,M,V){return new I({length:M,numberOfChannels:v,sampleRate:V})}createBufferSource(){return new V(this)}createChannelMerger(v=6){return new j(this,{numberOfInputs:v})}createChannelSplitter(v=6){return new dt(this,{numberOfOutputs:v})}createConstantSource(){return new vt(this)}createConvolver(){return new yt(this)}createDelay(v=1){return new wt(this,{maxDelayTime:v})}createDynamicsCompressor(){return new bt(this)}createGain(){return new Tt(this)}createIIRFilter(v,M){return new kt(this,{feedback:M,feedforward:v})}createOscillator(){return new Ot(this)}createPanner(){return new Et(this)}createPeriodicWave(v,M,I={disableNormalization:!1}){return new qt(this,{...I,imag:M,real:v})}createStereoPanner(){return new $t(this)}createWaveShaper(){return new Jt(this)}decodeAudioData(v,M,I){return xt(this._nativeContext,v).then((v=>("function"==typeof M&&M(v),v))).catch((v=>{throw"function"==typeof I&&I(v),v}))}})(Nn,ps,xs,Rs,Vs,Hs,$s,tn,sn,((v,M,I,V,N,j,dt,vt,yt,xt,wt)=>(bt,Tt)=>{const kt=dt(bt)?bt:j(bt);if(N.has(Tt)){const v=I();return Promise.reject(v)}try{N.add(Tt)}catch{}return M(yt,(()=>yt(kt)))?kt.decodeAudioData(Tt).then((I=>(M(vt,(()=>vt(I)))||wt(I),v.add(I),I))):new Promise(((M,I)=>{const i=()=>{try{(v=>{const{port1:M}=new MessageChannel;M.postMessage(v,[v])})(Tt)}catch{}},o=v=>{I(v),i()};try{kt.decodeAudioData(Tt,(I=>{"function"!=typeof I.copyFromChannel&&(xt(I),F(I)),v.add(I),i(),M(I)}),(v=>{o(null===v?V():v)}))}catch(v){o(v)}}))})(fs,Pe,(()=>new DOMException("","DataCloneError")),(()=>new DOMException("","EncodingError")),new WeakSet,Je,Pn,R,Rt,vs,ys),nn,an,cn,pn,mn,vn,kn,Cn,On,En),Ln=((v,M,I,V)=>class extends v{constructor(v,N){const j=I(v),dt=M(j,N);if(V(j))throw TypeError();super(v,!0,dt,null),this._nativeMediaElementAudioSourceNode=dt}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(ls,((v,M)=>v.createMediaElementSource(M.mediaElement)),Je,es),zn=((v,M,I,V)=>class extends v{constructor(v,N){const j=I(v);if(V(j))throw new TypeError;const dt={...Se,...N},vt=M(j,dt);super(v,!1,vt,null),this._nativeMediaStreamAudioDestinationNode=vt}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(ls,((v,M)=>{const I=v.createMediaStreamDestination();return It(I,M),1===I.numberOfOutputs&&Object.defineProperty(I,"numberOfOutputs",{get:()=>0}),I}),Je,es),Bn=((v,M,I,V)=>class extends v{constructor(v,N){const j=I(v),dt=M(j,N);if(V(j))throw new TypeError;super(v,!0,dt,null),this._nativeMediaStreamAudioSourceNode=dt}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(ls,((v,{mediaStream:M})=>{const I=M.getAudioTracks();I.sort(((v,M)=>v.id<M.id?-1:v.id>M.id?1:0));const V=I.slice(0,1),N=v.createMediaStreamSource(new MediaStream(V));return Object.defineProperty(N,"mediaStream",{value:M}),N}),Je,es),Wn=((v,M,I)=>class extends v{constructor(v,V){const N=I(v);super(v,!0,M(N,V),null)}})(ls,((v,M)=>(I,{mediaStreamTrack:V})=>{if("function"==typeof I.createMediaStreamTrackSource)return I.createMediaStreamTrackSource(V);const N=new MediaStream([V]),j=I.createMediaStreamSource(N);if("audio"!==V.kind)throw v();if(M(I))throw new TypeError;return j})(At,es),Je),Un=((v,M,I,V,N,j,dt,vt,yt)=>class extends v{constructor(v={}){if(null===yt)throw new Error("Missing the native AudioContext constructor.");const M=new yt(v);if(null===M)throw V();if(!G(v.latencyHint))throw new TypeError(`The provided value '${v.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==v.sampleRate&&M.sampleRate!==v.sampleRate)throw I();super(M,2);const{latencyHint:N}=v,{sampleRate:j}=M;if(this._baseLatency="number"==typeof M.baseLatency?M.baseLatency:"balanced"===N?512/j:"interactive"===N||void 0===N?256/j:"playback"===N?1024/j:128*Math.max(2,Math.min(128,Math.round(N*j/128)))/j,this._nativeAudioContext=M,"webkitAudioContext"===yt.name?(this._nativeGainNode=M.createGain(),this._nativeOscillatorNode=M.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(M.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===M.state){this._state="suspended";const t=()=>{"suspended"===this._state&&(this._state=null),M.removeEventListener("statechange",t)};M.addEventListener("statechange",t)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then((()=>{throw M()})):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then((()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),W(this)})))}createMediaElementSource(v){return new N(this,{mediaElement:v})}createMediaStreamDestination(){return new j(this)}createMediaStreamSource(v){return new dt(this,{mediaStream:v})}createMediaStreamTrackSource(v){return new vt(this,{mediaStreamTrack:v})}resume(){return"suspended"===this._state?new Promise(((v,M)=>{const s=()=>{this._nativeAudioContext.removeEventListener("statechange",s),"running"===this._nativeAudioContext.state?v():this.resume().then(v,M)};this._nativeAudioContext.addEventListener("statechange",s)})):this._nativeAudioContext.resume().catch((v=>{if(void 0===v||15===v.code)throw M();throw v}))}suspend(){return this._nativeAudioContext.suspend().catch((v=>{if(void 0===v)throw M();throw v}))}})(jn,At,Ht,se,Ln,zn,Bn,Wn,rs),Gn=(Xn=_n,v=>{const M=Xn.get(v);if(void 0===M)throw new Error("The context has no set of AudioWorkletNodes.");return M});var Xn;const Yn=(Qn=Gn,(v,M)=>{Qn(v).add(M)});var Qn;const Zn=(v=>(M,I,V=0,N=0)=>{const j=M[V];if(void 0===j)throw v();return ct(I)?j.connect(I,0,N):j.connect(I,0)})(q),Hn=(v=>(M,I)=>{v(M).delete(I)})(Gn),$n=(v=>(M,I,V,N=0)=>void 0===I?M.forEach((v=>v.disconnect())):"number"==typeof I?St(v,M,I).disconnect():ct(I)?void 0===V?M.forEach((v=>v.disconnect(I))):void 0===N?St(v,M,V).disconnect(I,0):St(v,M,V).disconnect(I,0,N):void 0===V?M.forEach((v=>v.disconnect(I))):St(v,M,V).disconnect(I,0))(q),Jn=new WeakMap,ni=((v,M)=>I=>M(v,I))(Jn,b),mi=((v,M,I,V,N,j,dt,vt,yt,xt,wt,bt,Tt)=>(kt,Ct,Ot,Et)=>{if(0===Et.numberOfInputs&&0===Et.numberOfOutputs)throw yt();const $t=Array.isArray(Et.outputChannelCount)?Et.outputChannelCount:Array.from(Et.outputChannelCount);if($t.some((v=>v<1)))throw yt();if($t.length!==Et.numberOfOutputs)throw M();if("explicit"!==Et.channelCountMode)throw yt();const Jt=Et.channelCount*Et.numberOfInputs,Kt=$t.reduce(((v,M)=>v+M),0),te=void 0===Ot.parameterDescriptors?0:Ot.parameterDescriptors.length;if(Jt+te>6||Kt>6)throw yt();const fe=new MessageChannel,_e=[],me=[];for(let v=0;v<Et.numberOfInputs;v+=1)_e.push(dt(kt,{channelCount:Et.channelCount,channelCountMode:Et.channelCountMode,channelInterpretation:Et.channelInterpretation,gain:1})),me.push(N(kt,{channelCount:Et.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Et.channelCount}));const ge=[];if(void 0!==Ot.parameterDescriptors)for(const{defaultValue:v,maxValue:M,minValue:I,name:V}of Ot.parameterDescriptors){const N=j(kt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==Et.parameterData[V]?Et.parameterData[V]:void 0===v?0:v});Object.defineProperties(N.offset,{defaultValue:{get:()=>void 0===v?0:v},maxValue:{get:()=>void 0===M?ne:M},minValue:{get:()=>void 0===I?ee:I}}),ge.push(N)}const ve=V(kt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,Jt+te)}),ye=Lt(Ct,kt.sampleRate),xe=vt(kt,ye,Jt+te,Math.max(1,Kt)),we=N(kt,{channelCount:Math.max(1,Kt),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,Kt)}),be=[];for(let v=0;v<Et.numberOfOutputs;v+=1)be.push(V(kt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:$t[v]}));for(let v=0;v<Et.numberOfInputs;v+=1){_e[v].connect(me[v]);for(let M=0;M<Et.channelCount;M+=1)me[v].connect(ve,M,v*Et.channelCount+M)}const Te=new pt(void 0===Ot.parameterDescriptors?[]:Ot.parameterDescriptors.map((({name:v},M)=>{const I=ge[M];return I.connect(ve,0,Jt+M),I.start(0),[v,I.offset]})));ve.connect(xe);let De=Et.channelInterpretation,Se=null;const ke=0===Et.numberOfOutputs?[xe]:be,Ce={get bufferSize(){return ye},get channelCount(){return Et.channelCount},set channelCount(v){throw I()},get channelCountMode(){return Et.channelCountMode},set channelCountMode(v){throw I()},get channelInterpretation(){return De},set channelInterpretation(v){for(const M of _e)M.channelInterpretation=v;De=v},get context(){return xe.context},get inputs(){return _e},get numberOfInputs(){return Et.numberOfInputs},get numberOfOutputs(){return Et.numberOfOutputs},get onprocessorerror(){return Se},set onprocessorerror(v){"function"==typeof Se&&Ce.removeEventListener("processorerror",Se),Se="function"==typeof v?v:null,"function"==typeof Se&&Ce.addEventListener("processorerror",Se)},get parameters(){return Te},get port(){return fe.port2},addEventListener:(...v)=>xe.addEventListener(v[0],v[1],v[2]),connect:v.bind(null,ke),disconnect:xt.bind(null,ke),dispatchEvent:(...v)=>xe.dispatchEvent(v[0]),removeEventListener:(...v)=>xe.removeEventListener(v[0],v[1],v[2])},Ae=new Map;var Oe,Me;fe.port1.addEventListener=(Oe=fe.port1.addEventListener,(...v)=>{if("message"===v[0]){const M="function"==typeof v[1]?v[1]:"object"==typeof v[1]&&null!==v[1]&&"function"==typeof v[1].handleEvent?v[1].handleEvent:null;if(null!==M){const I=Ae.get(v[1]);void 0!==I?v[1]=I:(v[1]=v=>{wt(kt.currentTime,kt.sampleRate,(()=>M(v)))},Ae.set(M,v[1]))}}return Oe.call(fe.port1,v[0],v[1],v[2])}),fe.port1.removeEventListener=(Me=fe.port1.removeEventListener,(...v)=>{if("message"===v[0]){const M=Ae.get(v[1]);void 0!==M&&(Ae.delete(v[1]),v[1]=M)}return Me.call(fe.port1,v[0],v[1],v[2])});let Ee=null;Object.defineProperty(fe.port1,"onmessage",{get:()=>Ee,set:v=>{"function"==typeof Ee&&fe.port1.removeEventListener("message",Ee),Ee="function"==typeof v?v:null,"function"==typeof Ee&&(fe.port1.addEventListener("message",Ee),fe.port1.start())}}),Ot.prototype.port=fe.port1;let Re=null;((v,M,I,V)=>{let N=qt.get(v);void 0===N&&(N=new WeakMap,qt.set(v,N));const j=zt(I,V);return N.set(M,j),j})(kt,Ce,Ot,Et).then((v=>Re=v));const qe=mt(Et.numberOfInputs,Et.channelCount),Fe=mt(Et.numberOfOutputs,$t),Ie=void 0===Ot.parameterDescriptors?[]:Ot.parameterDescriptors.reduce(((v,{name:M})=>({...v,[M]:new Float32Array(128)})),{});let Ve=!0;const Z=()=>{Et.numberOfOutputs>0&&xe.disconnect(we);for(let v=0,M=0;v<Et.numberOfOutputs;v+=1){const I=be[v];for(let V=0;V<$t[v];V+=1)we.disconnect(I,M+V,V);M+=$t[v]}},Ne=new Map;xe.onaudioprocess=({inputBuffer:v,outputBuffer:M})=>{if(null!==Re){const I=bt(Ce);for(let V=0;V<ye;V+=128){for(let M=0;M<Et.numberOfInputs;M+=1)for(let I=0;I<Et.channelCount;I+=1)ft(v,qe[M],I,I,V);void 0!==Ot.parameterDescriptors&&Ot.parameterDescriptors.forEach((({name:M},I)=>{ft(v,Ie,M,Jt+I,V)}));for(let v=0;v<Et.numberOfInputs;v+=1)for(let M=0;M<$t[v];M+=1)0===Fe[v][M].byteLength&&(Fe[v][M]=new Float32Array(128));try{const v=qe.map(((v,M)=>{if(I[M].size>0)return Ne.set(M,ye/128),v;const V=Ne.get(M);return void 0===V?[]:(v.every((v=>v.every((v=>0===v))))&&(1===V?Ne.delete(M):Ne.set(M,V-1)),v)})),N=wt(kt.currentTime+V/kt.sampleRate,kt.sampleRate,(()=>Re.process(v,Fe,Ie)));Ve=N;for(let v=0,I=0;v<Et.numberOfOutputs;v+=1){for(let N=0;N<$t[v];N+=1)_t(M,Fe[v],N,I+N,V);I+=$t[v]}}catch(v){Ve=!1,Ce.dispatchEvent(new ErrorEvent("processorerror",{colno:v.colno,filename:v.filename,lineno:v.lineno,message:v.message}))}if(!Ve){for(let v=0;v<Et.numberOfInputs;v+=1){_e[v].disconnect(me[v]);for(let M=0;M<Et.channelCount;M+=1)me[V].disconnect(ve,M,v*Et.channelCount+M)}if(void 0!==Ot.parameterDescriptors){const v=Ot.parameterDescriptors.length;for(let M=0;M<v;M+=1){const v=ge[M];v.disconnect(ve,0,Jt+M),v.stop()}}ve.disconnect(xe),xe.onaudioprocess=null,Pe?Z():J();break}}}};let Pe=!1;const je=dt(kt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),$=()=>xe.connect(je).connect(kt.destination),J=()=>{xe.disconnect(je),je.disconnect()};return $(),Tt(Ce,(()=>{if(Ve){J(),Et.numberOfOutputs>0&&xe.connect(we);for(let v=0,M=0;v<Et.numberOfOutputs;v+=1){const I=be[v];for(let V=0;V<$t[v];V+=1)we.connect(I,M+V,V);M+=$t[v]}}Pe=!0}),(()=>{Ve&&($(),Z()),Pe=!1}))})(Zn,q,At,Zs,Wt,Ks,Qt,Yt,Ht,$n,qn,ni,Gs),gi=((v,M,I,V,N)=>(j,dt,vt,yt,xt,wt)=>{if(null!==vt)try{const M=new vt(j,yt,wt),V=new Map;let dt=null;if(Object.defineProperties(M,{channelCount:{get:()=>wt.channelCount,set:()=>{throw v()}},channelCountMode:{get:()=>"explicit",set:()=>{throw v()}},onprocessorerror:{get:()=>dt,set:v=>{"function"==typeof dt&&M.removeEventListener("processorerror",dt),dt="function"==typeof v?v:null,"function"==typeof dt&&M.addEventListener("processorerror",dt)}}}),M.addEventListener=(Tt=M.addEventListener,(...v)=>{if("processorerror"===v[0]){const M="function"==typeof v[1]?v[1]:"object"==typeof v[1]&&null!==v[1]&&"function"==typeof v[1].handleEvent?v[1].handleEvent:null;if(null!==M){const I=V.get(v[1]);void 0!==I?v[1]=I:(v[1]=I=>{"error"===I.type?(Object.defineProperties(I,{type:{value:"processorerror"}}),M(I)):M(new ErrorEvent(v[0],{...I}))},V.set(M,v[1]))}}return Tt.call(M,"error",v[1],v[2]),Tt.call(M,...v)}),M.removeEventListener=(bt=M.removeEventListener,(...v)=>{if("processorerror"===v[0]){const M=V.get(v[1]);void 0!==M&&(V.delete(v[1]),v[1]=M)}return bt.call(M,"error",v[1],v[2]),bt.call(M,v[0],v[1],v[2])}),0!==wt.numberOfOutputs){const v=I(j,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});M.connect(v).connect(j.destination);return N(M,(()=>v.disconnect()),(()=>v.connect(j.destination)))}return M}catch(v){if(11===v.code)throw V();throw v}var bt,Tt;if(void 0===xt)throw V();return(v=>{const{port1:M}=new MessageChannel;try{M.postMessage(v)}finally{M.close()}})(wt),M(j,dt,xt,wt)})(At,mi,Qt,Ht,Gs),Pi=((v,M,I,V,N,j,dt,vt,yt,xt,wt,bt,Tt,kt,Ct,Ot)=>(Et,qt,$t)=>{const Jt=new WeakMap;let Kt=null;return{render(te,ee,ne){vt(ee,te);const fe=Jt.get(ee);return void 0!==fe?Promise.resolve(fe):(async(vt,te,ee)=>{let ne=wt(vt),fe=null;const _e=E(ne,te),me=Array.isArray(qt.outputChannelCount)?qt.outputChannelCount:Array.from(qt.outputChannelCount);if(null===bt){const v=me.reduce(((v,M)=>v+M),0),I=N(te,{channelCount:Math.max(1,v),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,v)}),j=[];for(let v=0;v<vt.numberOfOutputs;v+=1)j.push(V(te,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:me[v]}));const xt=dt(te,{channelCount:qt.channelCount,channelCountMode:qt.channelCountMode,channelInterpretation:qt.channelInterpretation,gain:1});xt.connect=M.bind(null,j),xt.disconnect=yt.bind(null,j),fe=[I,j,xt]}else _e||(ne=new bt(te,Et));if(Jt.set(te,null===fe?ne:fe[2]),null!==fe){if(null===Kt){if(void 0===$t)throw new Error("Missing the processor constructor.");if(null===Tt)throw new Error("Missing the native OfflineAudioContext constructor.");const v=vt.channelCount*vt.numberOfInputs,M=void 0===$t.parameterDescriptors?0:$t.parameterDescriptors.length,I=v+M,c=async()=>{const yt=new Tt(I,128*Math.ceil(vt.context.length/128),te.sampleRate),xt=[],wt=[];for(let v=0;v<qt.numberOfInputs;v+=1)xt.push(dt(yt,{channelCount:qt.channelCount,channelCountMode:qt.channelCountMode,channelInterpretation:qt.channelInterpretation,gain:1})),wt.push(N(yt,{channelCount:qt.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:qt.channelCount}));const bt=await Promise.all(Array.from(vt.parameters.values()).map((async v=>{const M=j(yt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:v.value});return await kt(yt,v,M.offset,ee),M}))),Et=V(yt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,v+M)});for(let v=0;v<qt.numberOfInputs;v+=1){xt[v].connect(wt[v]);for(let M=0;M<qt.channelCount;M+=1)wt[v].connect(Et,M,v*qt.channelCount+M)}for(const[M,I]of bt.entries())I.connect(Et,0,v+M),I.start(0);return Et.connect(yt.destination),await Promise.all(xt.map((v=>Ct(vt,yt,v,ee)))),Ot(yt)};Kt=gt(vt,0===I?null:await c(),te,qt,me,$t,xt)}const v=await Kt,M=I(te,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[yt,wt,bt]=fe;null!==v&&(M.buffer=v,M.start(0)),M.connect(yt);for(let v=0,M=0;v<vt.numberOfOutputs;v+=1){const I=wt[v];for(let V=0;V<me[v];V+=1)yt.connect(I,M+V,V);M+=me[v]}return bt}if(_e)for(const[M,I]of vt.parameters.entries())await v(te,I,ne.parameters.get(M),ee);else for(const[v,M]of vt.parameters.entries())await kt(te,M,ne.parameters.get(v),ee);return await Ct(vt,te,ne,ee),ne})(te,ee,ne)}}})(Ss,Zn,ks,Zs,Wt,Ks,Qt,Hn,$n,qn,st,Vn,ts,As,Ye,un),Li=(v=>M=>v.get(M))(Fn),Hi=(v=>(M,I)=>{v.set(M,I)})(Jn),$i=Rn?((v,M,I,V,N,j,dt,vt,yt,xt,wt,bt,Tt)=>class extends M{constructor(M,Tt,kt){var Ct;const Ot=vt(M),qt=yt(Ot),$t=wt({..._e,...kt}),Jt=Et.get(Ot),Kt=null==Jt?void 0:Jt.get(Tt),te=qt||"closed"!==Ot.state?Ot:null!==(Ct=dt(Ot))&&void 0!==Ct?Ct:Ot,ee=N(te,qt?null:M.baseLatency,xt,Tt,Kt,$t);super(M,!0,ee,qt?V(Tt,$t,Kt):null);const ne=[];ee.parameters.forEach(((v,M)=>{const V=I(this,qt,v);ne.push([M,V])})),this._nativeAudioWorkletNode=ee,this._onprocessorerror=null,this._parameters=new pt(ne),qt&&v(Ot,this);const{activeInputs:fe}=j(this);bt(ee,fe)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(v){const M="function"==typeof v?Tt(this,v):null;this._nativeAudioWorkletNode.onprocessorerror=M;const I=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==I&&I===M?v:I}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})(Yn,ls,Ms,Pi,gi,L,Li,Je,es,Vn,(v=>({...v,outputChannelCount:void 0!==v.outputChannelCount?v.outputChannelCount:1===v.numberOfInputs&&1===v.numberOfOutputs?[v.channelCount]:Array.from({length:v.numberOfOutputs},(()=>1))})),Hi,de):void 0,io=(((v,M,I,V,N)=>{})(),((v,M)=>(I,V,N)=>{if(null===M)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new M(I,V,N)}catch(M){if("SyntaxError"===M.name)throw v();throw M}})(Ht,ts)),po=((v,M,I,V,N,j,dt,vt)=>{const yt=[];return(xt,wt)=>I(xt).render(xt,wt,yt).then((()=>Promise.all(Array.from(V(wt)).map((v=>I(v).render(v,wt,yt)))))).then((()=>N(wt))).then((I=>("function"!=typeof I.copyFromChannel?(dt(I),F(I)):M(j,(()=>j(I)))||vt(I),v.add(I),I)))})(fs,Pe,Ge,Gn,un,R,vs,ys),fo=(((v,M,I,V,N)=>{})(),((v,M,I,V,N)=>class extends v{constructor(v,I,N){let j;if("number"==typeof v&&void 0!==I&&void 0!==N)j={length:I,numberOfChannels:v,sampleRate:N};else{if("object"!=typeof v)throw new Error("The given parameters are not valid.");j=v}const{length:dt,numberOfChannels:vt,sampleRate:yt}={...ke,...j},xt=V(vt,dt,yt);M(Rt,(()=>Rt(xt)))||xt.addEventListener("statechange",(()=>{let v=0;const e=M=>{"running"===this._state&&(v>0?(xt.removeEventListener("statechange",e),M.stopImmediatePropagation(),this._waitForThePromiseToSettle(M)):v+=1)};return e})()),super(xt,vt),this._length=dt,this._nativeOfflineAudioContext=xt,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(I()):(this._state="running",N(this.destination,this._nativeOfflineAudioContext).finally((()=>{this._state=null,W(this)})))}_waitForThePromiseToSettle(v){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(v):setTimeout((()=>this._waitForThePromiseToSettle(v)))}})(jn,Pe,At,io,po)),Ko=((v,M)=>I=>{const V=v.get(I);return M(V)||M(I)})(kt,as),tr=(fr=wt,Ir=hs,v=>fr.has(v)||Ir(v));var fr,Ir;const Xr=(Jr=Tt,Wa=us,v=>Jr.has(v)||Wa(v));var Jr,Wa;const Ga=((v,M)=>I=>{const V=v.get(I);return M(V)||M(I)})(kt,es),Kn=()=>(async(v,M,I,V,N,j,dt,vt,yt,xt,wt,bt,Tt,kt,Ct,Ot)=>!!(v(M,M)&&v(I,I)&&v(N,N)&&v(j,j)&&v(vt,vt)&&v(yt,yt)&&v(xt,xt)&&v(wt,wt)&&v(bt,bt)&&v(Tt,Tt)&&v(kt,kt))&&(await Promise.all([v(V,V),v(dt,dt),v(Ct,Ct),v(Ot,Ot)])).every((v=>v)))(Pe,(v=>()=>{if(null===v)return!1;const M=new v(1,1,44100).createBuffer(1,1,44100);if(void 0===M.copyToChannel)return!0;const I=new Float32Array(2);try{M.copyFromChannel(I,0,0)}catch{return!1}return!0})(ts),(v=>()=>{if(null===v)return!1;if(void 0!==v.prototype&&void 0!==v.prototype.close)return!0;const M=new v,I=void 0!==M.close;try{M.close()}catch{}return I})(rs),(v=>()=>{if(null===v)return Promise.resolve(!1);const M=new v(1,1,44100);return new Promise((v=>{let I=!0;const n=V=>{I&&(I=!1,M.startRendering(),v(V instanceof TypeError))};let V;try{V=M.decodeAudioData(null,(()=>{}),n)}catch(v){n(v)}void 0!==V&&V.catch(n)}))})(ts),(v=>()=>{if(null===v)return!1;let M;try{M=new v({latencyHint:"balanced"})}catch{return!1}return M.close(),!0})(rs),(v=>()=>{if(null===v)return!1;const M=new v(1,1,44100).createGain(),I=M.connect(M)===M;return M.disconnect(M),I})(ts),((v,M)=>async()=>{if(null===v)return!0;if(null===M)return!1;const I=new Blob(['class A extends AudioWorkletProcessor{process(){this.port.postMessage(0)}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),V=new M(1,128,8e3),N=URL.createObjectURL(I);let j=!1;try{await V.audioWorklet.addModule(N);const M=new v(V,"a",{numberOfOutputs:0}),I=V.createOscillator();M.port.onmessage=()=>j=!0,I.connect(M),I.start(0),await V.startRendering(),j||await new Promise((v=>setTimeout(v,5)))}catch{}finally{URL.revokeObjectURL(N)}return j})(Vn,ts),(v=>()=>{if(null===v)return!1;const M=new v(1,1,44100).createChannelMerger();if("max"===M.channelCountMode)return!0;try{M.channelCount=2}catch{return!0}return!1})(ts),(v=>()=>{if(null===v)return!1;const M=new v(1,1,44100);return void 0===M.createConstantSource||M.createConstantSource().offset.maxValue!==Number.POSITIVE_INFINITY})(ts),(v=>()=>{if(null===v)return!1;const M=new v(1,1,44100),I=M.createConvolver();I.buffer=M.createBuffer(1,1,M.sampleRate);try{I.buffer=M.createBuffer(1,1,M.sampleRate)}catch{return!1}return!0})(ts),(v=>()=>{if(null===v)return!1;const M=new v(1,1,44100).createConvolver();try{M.channelCount=1}catch{return!1}return!0})(ts),ue,(v=>()=>null!==v&&v.hasOwnProperty("isSecureContext"))(ze),(v=>()=>{if(null===v)return!1;const M=new v;try{return M.createMediaStreamSource(new MediaStream),!1}catch(v){return!0}})(rs),(v=>()=>{if(null===v)return Promise.resolve(!1);const M=new v(1,1,44100);if(void 0===M.createStereoPanner)return Promise.resolve(!0);if(void 0===M.createConstantSource)return Promise.resolve(!0);const I=M.createConstantSource(),V=M.createStereoPanner();return I.channelCount=1,I.offset.value=1,V.channelCount=1,I.start(),I.connect(V).connect(M.destination),M.startRendering().then((v=>1!==v.getChannelData(0)[0]))})(ts),le);function ti(v,M){if(!v)throw new Error(M)}function ei(v,M,I=1/0){if(!(M<=v&&v<=I))throw new RangeError(`Value must be within [${M}, ${I}], got: ${v}`)}function si(v){v.isOffline||"running"===v.state||ri('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Xa=console;function ii(v){Xa=v}function oi(...v){Xa.log(...v)}function ri(...v){Xa.warn(...v)}function ai(v){return void 0===v}function ci(v){return!ai(v)}function hi(v){return"function"==typeof v}function ui(v){return"number"==typeof v}function li(v){return"[object Object]"===Object.prototype.toString.call(v)&&v.constructor===Object}function pi(v){return"boolean"==typeof v}function di(v){return Array.isArray(v)}function fi(v){return"string"==typeof v}function _i(v){return fi(v)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(v)}const Qa="object"==typeof self?self:null,Za=Qa&&(Qa.hasOwnProperty("AudioContext")||Qa.hasOwnProperty("webkitAudioContext"));function vi(v,M,I,V){var N,j=arguments.length,dt=j<3?M:null===V?V=Object.getOwnPropertyDescriptor(M,I):V;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)dt=Reflect.decorate(v,M,I,V);else for(var vt=v.length-1;vt>=0;vt--)(N=v[vt])&&(dt=(j<3?N(dt):j>3?N(M,I,dt):N(M,I))||dt);return j>3&&dt&&Object.defineProperty(M,I,dt),dt}function yi(v,M,I,V){return new(I||(I=Promise))((function(N,j){function r(v){try{c(V.next(v))}catch(v){j(v)}}function a(v){try{c(V.throw(v))}catch(v){j(v)}}function c(v){var M;v.done?N(v.value):(M=v.value,M instanceof I?M:new I((function(v){v(M)}))).then(r,a)}c((V=V.apply(v,M||[])).next())}))}Object.create;Object.create;class xi{constructor(v,M,I){this._callback=v,this._type=M,this._updateInterval=I,this._createClock()}_createWorker(){const v=new Blob([`\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t`],{type:"text/javascript"}),M=URL.createObjectURL(v),I=new Worker(M);I.onmessage=this._callback.bind(this),this._worker=I}_createTimeout(){this._timeout=setTimeout((()=>{this._createTimeout(),this._callback()}),1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(v){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(v){this._updateInterval=Math.max(v,128/44100),"worker"===this._type&&this._worker.postMessage(Math.max(1e3*v,1))}get type(){return this._type}set type(v){this._disposeClock(),this._type=v,this._createClock()}dispose(){this._disposeClock()}}function wi(v){return Xr(v)}function bi(v){return tr(v)}function Ti(v){return Ga(v)}function Si(v){return Ko(v)}function ki(v){return v instanceof AudioBuffer}function Ci(v,M){return"value"===v||wi(M)||bi(M)||ki(M)}function Ai(v,...M){if(!M.length)return v;const I=M.shift();if(li(v)&&li(I))for(const M in I)Ci(M,I[M])?v[M]=I[M]:li(I[M])?(v[M]||Object.assign(v,{[M]:{}}),Ai(v[M],I[M])):Object.assign(v,{[M]:I[M]});return Ai(v,...M)}function Di(v,M,I=[],V){const N={},j=Array.from(M);li(j[0])&&V&&!Reflect.has(j[0],V)&&(Object.keys(j[0]).some((M=>Reflect.has(v,M)))||(Ai(N,{[V]:j[0]}),I.splice(I.indexOf(V),1),j.shift()));if(1===j.length&&li(j[0]))Ai(N,j[0]);else for(let v=0;v<I.length;v++)ci(j[v])&&(N[I[v]]=j[v]);return Ai(v,N)}function Oi(v,M){return ai(v)?M:v}function Mi(v,M){return M.forEach((M=>{Reflect.has(v,M)&&delete v[M]})),v
/**
     * Tone.js
     * @author Yotam Mann
     * @license http://opensource.org/licenses/MIT MIT License
     * @copyright 2014-2019 Yotam Mann
     */}class Ei{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...v){(this.debug||Qa&&this.toString()===Qa.TONE_DEBUG_CLASS)&&oi(this,...v)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}Ei.version=dt;function Ri(v,M){return v>M+1e-6}function qi(v,M){return Ri(v,M)||Ii(v,M)}function Fi(v,M){return v+1e-6<M}function Ii(v,M){return Math.abs(v-M)<1e-6}function Vi(v,M,I){return Math.max(Math.min(v,I),M)}class Ni extends Ei{constructor(){super(),this.name="Timeline",this._timeline=[];const v=Di(Ni.getDefaults(),arguments,["memory"]);this.memory=v.memory,this.increasing=v.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(v){if(ti(Reflect.has(v,"time"),"Timeline: events must have a time attribute"),v.time=v.time.valueOf(),this.increasing&&this.length){const M=this._timeline[this.length-1];ti(qi(v.time,M.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(v)}else{const M=this._search(v.time);this._timeline.splice(M+1,0,v)}if(this.length>this.memory){const v=this.length-this.memory;this._timeline.splice(0,v)}return this}remove(v){const M=this._timeline.indexOf(v);return-1!==M&&this._timeline.splice(M,1),this}get(v,M="time"){const I=this._search(v,M);return-1!==I?this._timeline[I]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(v,M="time"){const I=this._search(v,M);return I+1<this._timeline.length?this._timeline[I+1]:null}getBefore(v){const M=this._timeline.length;if(M>0&&this._timeline[M-1].time<v)return this._timeline[M-1];const I=this._search(v);return I-1>=0?this._timeline[I-1]:null}cancel(v){if(this._timeline.length>1){let M=this._search(v);if(M>=0)if(Ii(this._timeline[M].time,v)){for(let I=M;I>=0&&Ii(this._timeline[I].time,v);I--)M=I;this._timeline=this._timeline.slice(0,M)}else this._timeline=this._timeline.slice(0,M+1);else this._timeline=[]}else 1===this._timeline.length&&qi(this._timeline[0].time,v)&&(this._timeline=[]);return this}cancelBefore(v){const M=this._search(v);return M>=0&&(this._timeline=this._timeline.slice(M+1)),this}previousEvent(v){const M=this._timeline.indexOf(v);return M>0?this._timeline[M-1]:null}_search(v,M="time"){if(0===this._timeline.length)return-1;let I=0;const V=this._timeline.length;let N=V;if(V>0&&this._timeline[V-1][M]<=v)return V-1;for(;I<N;){let V=Math.floor(I+(N-I)/2);const j=this._timeline[V],dt=this._timeline[V+1];if(Ii(j[M],v)){for(let I=V;I<this._timeline.length;I++){if(!Ii(this._timeline[I][M],v))break;V=I}return V}if(Fi(j[M],v)&&Ri(dt[M],v))return V;Ri(j[M],v)?N=V:I=V+1}return-1}_iterate(v,M=0,I=this._timeline.length-1){this._timeline.slice(M,I+1).forEach(v)}forEach(v){return this._iterate(v),this}forEachBefore(v,M){const I=this._search(v);return-1!==I&&this._iterate(M,0,I),this}forEachAfter(v,M){const I=this._search(v);return this._iterate(M,I+1),this}forEachBetween(v,M,I){let V=this._search(v),N=this._search(M);return-1!==V&&-1!==N?(this._timeline[V].time!==v&&(V+=1),this._timeline[N].time===M&&(N-=1),this._iterate(I,V,N)):-1===V&&this._iterate(I,0,N),this}forEachFrom(v,M){let I=this._search(v);for(;I>=0&&this._timeline[I].time>=v;)I--;return this._iterate(M,I+1),this}forEachAtTime(v,M){const I=this._search(v);if(-1!==I&&Ii(this._timeline[I].time,v)){let V=I;for(let M=I;M>=0&&Ii(this._timeline[M].time,v);M--)V=M;this._iterate((v=>{M(v)}),V,I)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const Mc=[];function ji(v){Mc.push(v)}const Rc=[];function zi(v){Rc.push(v)}class Bi extends Ei{constructor(){super(...arguments),this.name="Emitter"}on(v,M){return v.split(/\W+/).forEach((v=>{ai(this._events)&&(this._events={}),this._events.hasOwnProperty(v)||(this._events[v]=[]),this._events[v].push(M)})),this}once(v,M){const s=(...I)=>{M(...I),this.off(v,s)};return this.on(v,s),this}off(v,M){return v.split(/\W+/).forEach((I=>{if(ai(this._events)&&(this._events={}),this._events.hasOwnProperty(v))if(ai(M))this._events[v]=[];else{const I=this._events[v];for(let v=I.length-1;v>=0;v--)I[v]===M&&I.splice(v,1)}})),this}emit(v,...M){if(this._events&&this._events.hasOwnProperty(v)){const I=this._events[v].slice(0);for(let v=0,V=I.length;v<V;v++)I[v].apply(this,M)}return this}static mixin(v){["on","once","off","emit"].forEach((M=>{const I=Object.getOwnPropertyDescriptor(Bi.prototype,M);Object.defineProperty(v.prototype,M,I)}))}dispose(){return super.dispose(),this._events=void 0,this}}class Wi extends Bi{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class Gi extends Wi{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new Ni,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const v=Di(Gi.getDefaults(),arguments,["context"]);v.context?this._context=v.context:this._context=function(v){return new Un(v)}({latencyHint:v.latencyHint}),this._ticker=new xi(this.emit.bind(this,"tick"),v.clockSource,v.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(v.latencyHint),this.lookAhead=v.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var v;return this._initialized||(v=this,Mc.forEach((M=>M(v))),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(v,M,I){return this._context.createBuffer(v,M,I)}createChannelMerger(v){return this._context.createChannelMerger(v)}createChannelSplitter(v){return this._context.createChannelSplitter(v)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(v){return this._context.createDelay(v)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(v,M){return this._context.createIIRFilter(v,M)}createPanner(){return this._context.createPanner()}createPeriodicWave(v,M,I){return this._context.createPeriodicWave(v,M,I)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(v){ti(Si(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamSource(v)}createMediaElementSource(v){ti(Si(this._context),"Not available if OfflineAudioContext");return this._context.createMediaElementSource(v)}createMediaStreamDestination(){ti(Si(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamDestination()}decodeAudioData(v){return this._context.decodeAudioData(v)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(v){ti(!this._initialized,"The listener cannot be set after initialization."),this._listener=v}get transport(){return this.initialize(),this._transport}set transport(v){ti(!this._initialized,"The transport cannot be set after initialization."),this._transport=v}get draw(){return this.initialize(),this._draw}set draw(v){ti(!this._initialized,"Draw cannot be set after initialization."),this._draw=v}get destination(){return this.initialize(),this._destination}set destination(v){ti(!this._initialized,"The destination cannot be set after initialization."),this._destination=v}createAudioWorkletNode(v,M){return function(v,M,I){return ti(ci($i),"This node only works in a secure context (https or localhost)"),new $i(v,M,I)}(this.rawContext,v,M)}addAudioWorkletModule(v,M){return yi(this,void 0,void 0,(function*(){ti(ci(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(M)||this._workletModules.set(M,this.rawContext.audioWorklet.addModule(v)),yield this._workletModules.get(M)}))}workletsAreReady(){return yi(this,void 0,void 0,(function*(){const v=[];this._workletModules.forEach((M=>v.push(M))),yield Promise.all(v)}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(v){this._ticker.updateInterval=v}get clockSource(){return this._ticker.type}set clockSource(v){this._ticker.type=v}get latencyHint(){return this._latencyHint}_setLatencyHint(v){let M=0;if(this._latencyHint=v,fi(v))switch(v){case"interactive":M=.1;break;case"playback":M=.5;break;case"balanced":M=.25}this.lookAhead=M,this.updateInterval=M/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return Si(this._context)?this._context.resume():Promise.resolve()}close(){return yi(this,void 0,void 0,(function*(){var v;Si(this._context)&&(yield this._context.close()),this._initialized&&(v=this,Rc.forEach((M=>M(v))))}))}getConstant(v){if(this._constants.has(v))return this._constants.get(v);{const M=this._context.createBuffer(1,128,this._context.sampleRate),I=M.getChannelData(0);for(let M=0;M<I.length;M++)I[M]=v;const V=this._context.createBufferSource();return V.channelCount=1,V.channelCountMode="explicit",V.buffer=M,V.loop=!0,V.start(0),this._constants.set(v,V),V}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map((v=>this._constants[v].disconnect())),this}_timeoutLoop(){const v=this.now();let M=this._timeouts.peek();for(;this._timeouts.length&&M&&M.time<=v;)M.callback(),this._timeouts.shift(),M=this._timeouts.peek()}setTimeout(v,M){this._timeoutIds++;const I=this.now();return this._timeouts.add({callback:v,id:this._timeoutIds,time:I+M}),this._timeoutIds}clearTimeout(v){return this._timeouts.forEach((M=>{M.id===v&&this._timeouts.remove(M)})),this}clearInterval(v){return this.clearTimeout(v)}setInterval(v,M){const I=++this._timeoutIds,n=()=>{const V=this.now();this._timeouts.add({callback:()=>{v(),n()},id:I,time:V+M})};return n(),I}}function Ui(v,M){di(M)?M.forEach((M=>Ui(v,M))):Object.defineProperty(v,M,{enumerable:!0,writable:!1})}function Qi(v,M){di(M)?M.forEach((M=>Qi(v,M))):Object.defineProperty(v,M,{writable:!0})}const Zi=()=>{};class Xi extends Ei{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Zi;const v=Di(Xi.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=v.reverse,this.onload=v.onload,v.url&&ki(v.url)||v.url instanceof Xi?this.set(v.url):fi(v.url)&&this.load(v.url).catch(v.onerror)}static getDefaults(){return{onerror:Zi,onload:Zi,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Ji().sampleRate}set(v){return v instanceof Xi?v.loaded?this._buffer=v.get():v.onload=()=>{this.set(v),this.onload(this)}:this._buffer=v,this._reversed&&this._reverse(),this}get(){return this._buffer}load(v){return yi(this,void 0,void 0,(function*(){const M=Xi.load(v).then((v=>{this.set(v),this.onload(this)}));Xi.downloads.push(M);try{yield M}finally{const v=Xi.downloads.indexOf(M);Xi.downloads.splice(v,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(v){const M=di(v)&&v[0].length>0,I=M?v.length:1,V=M?v[0].length:v.length,N=Ji(),j=N.createBuffer(I,V,N.sampleRate),dt=M||1!==I?v:[v];for(let v=0;v<I;v++)j.copyToChannel(dt[v],v);return this._buffer=j,this}toMono(v){if(ui(v))this.fromArray(this.toArray(v));else{let v=new Float32Array(this.length);const M=this.numberOfChannels;for(let I=0;I<M;I++){const M=this.toArray(I);for(let I=0;I<M.length;I++)v[I]+=M[I]}v=v.map((v=>v/M)),this.fromArray(v)}return this}toArray(v){if(ui(v))return this.getChannelData(v);if(1===this.numberOfChannels)return this.toArray(0);{const v=[];for(let M=0;M<this.numberOfChannels;M++)v[M]=this.getChannelData(M);return v}}getChannelData(v){return this._buffer?this._buffer.getChannelData(v):new Float32Array(0)}slice(v,M=this.duration){const I=Math.floor(v*this.sampleRate),V=Math.floor(M*this.sampleRate);ti(I<V,"The start time must be less than the end time");const N=V-I,j=Ji().createBuffer(this.numberOfChannels,N,this.sampleRate);for(let v=0;v<this.numberOfChannels;v++)j.copyToChannel(this.getChannelData(v).subarray(I,V),v);return new Xi(j)}_reverse(){if(this.loaded)for(let v=0;v<this.numberOfChannels;v++)this.getChannelData(v).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(v){this._reversed!==v&&(this._reversed=v,this._reverse())}static fromArray(v){return(new Xi).fromArray(v)}static fromUrl(v){return yi(this,void 0,void 0,(function*(){const M=new Xi;return yield M.load(v)}))}static load(v){return yi(this,void 0,void 0,(function*(){const M=v.match(/\[([^\]\[]+\|.+)\]$/);if(M){const I=M[1].split("|");let V=I[0];for(const v of I)if(Xi.supportsType(v)){V=v;break}v=v.replace(M[0],V)}const I=""===Xi.baseUrl||Xi.baseUrl.endsWith("/")?Xi.baseUrl:Xi.baseUrl+"/",V=yield fetch(I+v);if(!V.ok)throw new Error("could not load url: "+v);const N=yield V.arrayBuffer();return yield Ji().decodeAudioData(N)}))}static supportsType(v){const M=v.split("."),I=M[M.length-1];return""!==document.createElement("audio").canPlayType("audio/"+I)}static loaded(){return yi(this,void 0,void 0,(function*(){for(yield Promise.resolve();Xi.downloads.length;)yield Xi.downloads[0]}))}}Xi.baseUrl="",Xi.downloads=[];class Yi extends Gi{constructor(){var v,M,I;super({clockSource:"offline",context:Ti(arguments[0])?arguments[0]:(v=arguments[0],M=arguments[1]*arguments[2],I=arguments[2],new fo(v,M,I)),lookAhead:0,updateInterval:Ti(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=Ti(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(v){return yi(this,void 0,void 0,(function*(){let M=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,M++;const I=Math.floor(this.sampleRate/128);v&&M%I==0&&(yield new Promise((v=>setTimeout(v,1))))}}))}render(v=!0){return yi(this,void 0,void 0,(function*(){yield this.workletsAreReady(),yield this._renderClock(v);const M=yield this._context.startRendering();return new Xi(M)}))}close(){return Promise.resolve()}}const qc=new class extends Wi{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(v,M,I){return{}}createChannelMerger(v){return{}}createChannelSplitter(v){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(v){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(v,M){return{}}createPanner(){return{}}createPeriodicWave(v,M,I){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(v){return{}}createMediaElementSource(v){return{}}createMediaStreamDestination(){return{}}decodeAudioData(v){return Promise.resolve({})}createAudioWorkletNode(v,M){return{}}get rawContext(){return{}}addAudioWorkletModule(v,M){return yi(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(v,M){return 0}clearTimeout(v){return this}setInterval(v,M){return 0}clearInterval(v){return this}getConstant(v){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(v){}get destination(){return{}}set destination(v){}now(){return 0}immediate(){return 0}};let Ic=qc;function Ji(){return Ic===qc&&Za&&Ki(new Gi),Ic}function Ki(v){Ic=Si(v)?new Gi(v):Ti(v)?new Yi(v):v}function to(){return Ic.resume()}if(Qa&&!Qa.TONE_SILENCE_LOGGING){let v="v";"dev"===dt&&(v="");const M=` * Tone.js ${v}${dt} * `;console.log("%c"+M,"background: #000; color: #fff")}function eo(v){return Math.pow(10,v/20)}function so(v){return Math.log(v)/Math.LN10*20}function no(v){return Math.pow(2,v/12)}let Nc=440;function oo(v){return Math.round(ro(v))}function ro(v){return 69+12*Math.log2(v/Nc)}function ao(v){return Nc*Math.pow(2,(v-69)/12)}class co extends Ei{constructor(v,M,I){super(),this.defaultUnits="s",this._val=M,this._units=I,this.context=v,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:v=>this._frequencyToUnits(parseFloat(v)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:v=>this._ticksToUnits(parseInt(v,10)),regexp:/^(\d+)i$/i},m:{method:v=>this._beatsToUnits(parseInt(v,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(v,M)=>{const I=parseInt(v,10),V="."===M?1.5:1;return 1===I?this._beatsToUnits(this._getTimeSignature())*V:this._beatsToUnits(4/I)*V},regexp:/^(\d+)n(\.?)$/i},number:{method:v=>this._expressions[this.defaultUnits].method.call(this,v),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:v=>this._secondsToUnits(parseFloat(v)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:v=>parseInt(v,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:v=>{const M=parseInt(v,10);return this._beatsToUnits(8/(3*Math.floor(M)))},regexp:/^(\d+)t$/i},tr:{method:(v,M,I)=>{let V=0;return v&&"0"!==v&&(V+=this._beatsToUnits(this._getTimeSignature()*parseFloat(v))),M&&"0"!==M&&(V+=this._beatsToUnits(parseFloat(M))),I&&"0"!==I&&(V+=this._beatsToUnits(parseFloat(I)/4)),V},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof co&&this.fromType(this._val),ai(this._val))return this._noArg();if(fi(this._val)&&ai(this._units)){for(const v in this._expressions)if(this._expressions[v].regexp.test(this._val.trim())){this._units=v;break}}else if(li(this._val)){let v=0;for(const M in this._val)if(ci(this._val[M])){const I=this._val[M];v+=new this.constructor(this.context,M).valueOf()*I}return v}if(ci(this._units)){const v=this._expressions[this._units],M=this._val.toString().trim().match(v.regexp);return M?v.method.apply(this,M.slice(1)):v.method.call(this,this._val)}return fi(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(v){return 1/v}_beatsToUnits(v){return 60/this._getBpm()*v}_secondsToUnits(v){return v}_ticksToUnits(v){return v*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(v){switch(this._units=void 0,this.defaultUnits){case"s":this._val=v.toSeconds();break;case"i":this._val=v.toTicks();break;case"hz":this._val=v.toFrequency();break;case"midi":this._val=v.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class ho extends co{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:v=>this._now()+new this.constructor(this.context,v).valueOf(),regexp:/^\+(.+)/},quantize:{method:v=>{const M=new ho(this.context,v).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(M))},regexp:/^@(.+)/}})}quantize(v,M=1){const I=new this.constructor(this.context,v).valueOf(),V=this.valueOf();return V+(Math.round(V/I)*I-V)*M}toNotation(){const v=this.toSeconds(),M=["1m"];for(let v=1;v<9;v++){const I=Math.pow(2,v);M.push(I+"n."),M.push(I+"n"),M.push(I+"t")}M.push("0");let I=M[0],V=new ho(this.context,M[0]).toSeconds();return M.forEach((M=>{const N=new ho(this.context,M).toSeconds();Math.abs(N-v)<Math.abs(V-v)&&(I=M,V=N)})),I}toBarsBeatsSixteenths(){const v=this._beatsToUnits(1);let M=this.valueOf()/v;M=parseFloat(M.toFixed(4));const I=Math.floor(M/this._getTimeSignature());let V=M%1*4;M=Math.floor(M)%this._getTimeSignature();const N=V.toString();N.length>3&&(V=parseFloat(parseFloat(N).toFixed(3)));return[I,M,V].join(":")}toTicks(){const v=this._beatsToUnits(1),M=this.valueOf()/v;return Math.round(M*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return oo(this.toFrequency())}_now(){return this.context.now()}}function uo(v,M){return new ho(Ji(),v,M)}class lo extends ho{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return Nc}static set A4(v){!function(v){Nc=v}(v)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(v){return"midi"===this.defaultUnits?v:lo.mtof(v)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(v,M){const I=jc[v.toLowerCase()]+12*(parseInt(M,10)+1);return"midi"===this.defaultUnits?I:lo.mtof(I)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(v,M,I){let V=1;return v&&"0"!==v&&(V*=this._beatsToUnits(this._getTimeSignature()*parseFloat(v))),M&&"0"!==M&&(V*=this._beatsToUnits(parseFloat(M))),I&&"0"!==I&&(V*=this._beatsToUnits(parseFloat(I)/4)),V}}})}transpose(v){return new lo(this.context,this.valueOf()*no(v))}harmonize(v){return v.map((v=>this.transpose(v)))}toMidi(){return oo(this.valueOf())}toNote(){const v=this.toFrequency(),M=Math.log2(v/lo.A4);let I=Math.round(12*M)+57;const V=Math.floor(I/12);V<0&&(I+=-12*V);return zc[I%12]+V.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const v=this._beatsToUnits(1),M=this.valueOf()/v;return Math.floor(M*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(v){return v}_ticksToUnits(v){return 1/(60*v/(this._getBpm()*this._getPPQ()))}_beatsToUnits(v){return 1/super._beatsToUnits(v)}_secondsToUnits(v){return 1/v}static mtof(v){return ao(v)}static ftom(v){return oo(v)}}const jc={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},zc=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function _o(v,M){return new lo(Ji(),v,M)}class mo extends ho{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}function go(v,M){return new mo(Ji(),v,M)}class vo extends Ei{constructor(){super();const v=Di(vo.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=v.context}static getDefaults(){return{context:Ji()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(v){return new ho(this.context,v).toSeconds()}toFrequency(v){return new lo(this.context,v).toFrequency()}toTicks(v){return new mo(this.context,v).toTicks()}_getPartialProperties(v){const M=this.get();return Object.keys(M).forEach((I=>{ai(v[I])&&delete M[I]})),M}get(){const v=this.constructor.getDefaults();return Object.keys(v).forEach((M=>{if(Reflect.has(this,M)){const I=this[M];ci(I)&&ci(I.value)&&ci(I.setValueAtTime)?v[M]=I.value:I instanceof vo?v[M]=I._getPartialProperties(v[M]):di(I)||ui(I)||fi(I)||pi(I)?v[M]=I:delete v[M]}})),v}set(v){return Object.keys(v).forEach((M=>{Reflect.has(this,M)&&ci(this[M])&&(this[M]&&ci(this[M].value)&&ci(this[M].setValueAtTime)?this[M].value!==v[M]&&(this[M].value=v[M]):this[M]instanceof vo?this[M].set(v[M]):this[M]=v[M])})),this}}class yo extends Ni{constructor(v="stopped"){super(),this.name="StateTimeline",this._initial=v,this.setStateAtTime(this._initial,0)}getValueAtTime(v){const M=this.get(v);return null!==M?M.state:this._initial}setStateAtTime(v,M,I){return ei(M,0),this.add(Object.assign({},I,{state:v,time:M})),this}getLastState(v,M){for(let I=this._search(M);I>=0;I--){const M=this._timeline[I];if(M.state===v)return M}}getNextState(v,M){const I=this._search(M);if(-1!==I)for(let M=I;M<this._timeline.length;M++){const I=this._timeline[M];if(I.state===v)return I}}}class xo extends vo{constructor(){super(Di(xo.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const v=Di(xo.getDefaults(),arguments,["param","units","convert"]);for(ti(ci(v.param)&&(wi(v.param)||v.param instanceof xo),"param must be an AudioParam");!wi(v.param);)v.param=v.param._param;this._swappable=!!ci(v.swappable)&&v.swappable,this._swappable?(this.input=this.context.createGain(),this._param=v.param,this.input.connect(this._param)):this._param=this.input=v.param,this._events=new Ni(1e3),this._initialValue=this._param.defaultValue,this.units=v.units,this.convert=v.convert,this._minValue=v.minValue,this._maxValue=v.maxValue,ci(v.value)&&v.value!==this._toType(this._initialValue)&&this.setValueAtTime(v.value,0)}static getDefaults(){return Object.assign(vo.getDefaults(),{convert:!0,units:"number"})}get value(){const v=this.now();return this.getValueAtTime(v)}set value(v){this.cancelScheduledValues(this.now()),this.setValueAtTime(v,this.now())}get minValue(){return ci(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return ci(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(v,M){return this.units===M}_assertRange(v){return ci(this.maxValue)&&ci(this.minValue)&&ei(v,this._fromType(this.minValue),this._fromType(this.maxValue)),v}_fromType(v){return this.convert&&!this.overridden?this._is(v,"time")?this.toSeconds(v):this._is(v,"decibels")?eo(v):this._is(v,"frequency")?this.toFrequency(v):v:this.overridden?0:v}_toType(v){return this.convert&&"decibels"===this.units?so(v):v}setValueAtTime(v,M){const I=this.toSeconds(M),V=this._fromType(v);return ti(isFinite(V)&&isFinite(I),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(v)}, ${JSON.stringify(M)}`),this._assertRange(V),this.log(this.units,"setValueAtTime",v,I),this._events.add({time:I,type:"setValueAtTime",value:V}),this._param.setValueAtTime(V,I),this}getValueAtTime(v){const M=Math.max(this.toSeconds(v),0),I=this._events.getAfter(M),V=this._events.get(M);let N=this._initialValue;if(null===V)N=this._initialValue;else if("setTargetAtTime"!==V.type||null!==I&&"setValueAtTime"!==I.type)if(null===I)N=V.value;else if("linearRampToValueAtTime"===I.type||"exponentialRampToValueAtTime"===I.type){let v=V.value;if("setTargetAtTime"===V.type){const M=this._events.getBefore(V.time);v=null===M?this._initialValue:M.value}N="linearRampToValueAtTime"===I.type?this._linearInterpolate(V.time,v,I.time,I.value,M):this._exponentialInterpolate(V.time,v,I.time,I.value,M)}else N=V.value;else{const v=this._events.getBefore(V.time);let I;I=null===v?this._initialValue:v.value,"setTargetAtTime"===V.type&&(N=this._exponentialApproach(V.time,I,V.value,V.constant,M))}return this._toType(N)}setRampPoint(v){v=this.toSeconds(v);let M=this.getValueAtTime(v);return this.cancelAndHoldAtTime(v),0===this._fromType(M)&&(M=this._toType(this._minOutput)),this.setValueAtTime(M,v),this}linearRampToValueAtTime(v,M){const I=this._fromType(v),V=this.toSeconds(M);return ti(isFinite(I)&&isFinite(V),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(v)}, ${JSON.stringify(M)}`),this._assertRange(I),this._events.add({time:V,type:"linearRampToValueAtTime",value:I}),this.log(this.units,"linearRampToValueAtTime",v,V),this._param.linearRampToValueAtTime(I,V),this}exponentialRampToValueAtTime(v,M){let I=this._fromType(v);I=Ii(I,0)?this._minOutput:I,this._assertRange(I);const V=this.toSeconds(M);return ti(isFinite(I)&&isFinite(V),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(v)}, ${JSON.stringify(M)}`),this._events.add({time:V,type:"exponentialRampToValueAtTime",value:I}),this.log(this.units,"exponentialRampToValueAtTime",v,V),this._param.exponentialRampToValueAtTime(I,V),this}exponentialRampTo(v,M,I){return I=this.toSeconds(I),this.setRampPoint(I),this.exponentialRampToValueAtTime(v,I+this.toSeconds(M)),this}linearRampTo(v,M,I){return I=this.toSeconds(I),this.setRampPoint(I),this.linearRampToValueAtTime(v,I+this.toSeconds(M)),this}targetRampTo(v,M,I){return I=this.toSeconds(I),this.setRampPoint(I),this.exponentialApproachValueAtTime(v,I,M),this}exponentialApproachValueAtTime(v,M,I){M=this.toSeconds(M),I=this.toSeconds(I);const V=Math.log(I+1)/Math.log(200);return this.setTargetAtTime(v,M,V),this.cancelAndHoldAtTime(M+.9*I),this.linearRampToValueAtTime(v,M+I),this}setTargetAtTime(v,M,I){const V=this._fromType(v);ti(isFinite(I)&&I>0,"timeConstant must be a number greater than 0");const N=this.toSeconds(M);return this._assertRange(V),ti(isFinite(V)&&isFinite(N),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(v)}, ${JSON.stringify(M)}`),this._events.add({constant:I,time:N,type:"setTargetAtTime",value:V}),this.log(this.units,"setTargetAtTime",v,N,I),this._param.setTargetAtTime(V,N,I),this}setValueCurveAtTime(v,M,I,V=1){I=this.toSeconds(I),M=this.toSeconds(M);const N=this._fromType(v[0])*V;this.setValueAtTime(this._toType(N),M);const j=I/(v.length-1);for(let I=1;I<v.length;I++){const N=this._fromType(v[I])*V;this.linearRampToValueAtTime(this._toType(N),M+I*j)}return this}cancelScheduledValues(v){const M=this.toSeconds(v);return ti(isFinite(M),"Invalid argument to cancelScheduledValues: "+JSON.stringify(v)),this._events.cancel(M),this._param.cancelScheduledValues(M),this.log(this.units,"cancelScheduledValues",M),this}cancelAndHoldAtTime(v){const M=this.toSeconds(v),I=this._fromType(this.getValueAtTime(M));ti(isFinite(M),"Invalid argument to cancelAndHoldAtTime: "+JSON.stringify(v)),this.log(this.units,"cancelAndHoldAtTime",M,"value="+I);const V=this._events.get(M),N=this._events.getAfter(M);return V&&Ii(V.time,M)?N?(this._param.cancelScheduledValues(N.time),this._events.cancel(N.time)):(this._param.cancelAndHoldAtTime(M),this._events.cancel(M+this.sampleTime)):N&&(this._param.cancelScheduledValues(N.time),this._events.cancel(N.time),"linearRampToValueAtTime"===N.type?this.linearRampToValueAtTime(this._toType(I),M):"exponentialRampToValueAtTime"===N.type&&this.exponentialRampToValueAtTime(this._toType(I),M)),this._events.add({time:M,type:"setValueAtTime",value:I}),this._param.setValueAtTime(I,M),this}rampTo(v,M=.1,I){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(v,M,I):this.linearRampTo(v,M,I),this}apply(v){const M=this.context.currentTime;v.setValueAtTime(this.getValueAtTime(M),M);const I=this._events.get(M);if(I&&"setTargetAtTime"===I.type){const V=this._events.getAfter(I.time),N=V?V.time:M+2,j=(N-M)/10;for(let I=M;I<N;I+=j)v.linearRampToValueAtTime(this.getValueAtTime(I),I)}return this._events.forEachAfter(this.context.currentTime,(M=>{"cancelScheduledValues"===M.type?v.cancelScheduledValues(M.time):"setTargetAtTime"===M.type?v.setTargetAtTime(M.value,M.time,M.constant):v[M.type](M.value,M.time)})),this}setParam(v){ti(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const M=this.input;return M.disconnect(this._param),this.apply(v),this._param=v,M.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(v,M,I,V,N){return I+(M-I)*Math.exp(-(N-v)/V)}_linearInterpolate(v,M,I,V,N){return M+(N-v)/(I-v)*(V-M)}_exponentialInterpolate(v,M,I,V,N){return M*Math.pow(V/M,(N-v)/(I-v))}}class wo extends vo{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return ci(this.input)?wi(this.input)||this.input instanceof xo?1:this.input.numberOfInputs:0}get numberOfOutputs(){return ci(this.output)?this.output.numberOfOutputs:0}_isAudioNode(v){return ci(v)&&(v instanceof wo||bi(v))}_getInternalNodes(){const v=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&v.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&v.push(this.output),v}_setChannelProperties(v){this._getInternalNodes().forEach((M=>{M.channelCount=v.channelCount,M.channelCountMode=v.channelCountMode,M.channelInterpretation=v.channelInterpretation}))}_getChannelProperties(){const v=this._getInternalNodes();ti(v.length>0,"ToneAudioNode does not have any internal nodes");const M=v[0];return{channelCount:M.channelCount,channelCountMode:M.channelCountMode,channelInterpretation:M.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(v){const M=this._getChannelProperties();this._setChannelProperties(Object.assign(M,{channelCount:v}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(v){const M=this._getChannelProperties();this._setChannelProperties(Object.assign(M,{channelCountMode:v}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(v){const M=this._getChannelProperties();this._setChannelProperties(Object.assign(M,{channelInterpretation:v}))}connect(v,M=0,I=0){return To(this,v,M,I),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return ri("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(v,M=0,I=0){return So(this,v,M,I),this}chain(...v){return bo(this,...v),this}fan(...v){return v.forEach((v=>this.connect(v))),this}dispose(){return super.dispose(),ci(this.input)&&(this.input instanceof wo?this.input.dispose():bi(this.input)&&this.input.disconnect()),ci(this.output)&&(this.output instanceof wo?this.output.dispose():bi(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function bo(...v){const M=v.shift();v.reduce(((v,M)=>(v instanceof wo?v.connect(M):bi(v)&&To(v,M),M)),M)}function To(v,M,I=0,V=0){for(ti(ci(v),"Cannot connect from undefined node"),ti(ci(M),"Cannot connect to undefined node"),(M instanceof wo||bi(M))&&ti(M.numberOfInputs>0,"Cannot connect to node with no inputs"),ti(v.numberOfOutputs>0,"Cannot connect from node with no outputs");M instanceof wo||M instanceof xo;)ci(M.input)&&(M=M.input);for(;v instanceof wo;)ci(v.output)&&(v=v.output);wi(M)?v.connect(M,I):v.connect(M,I,V)}function So(v,M,I=0,V=0){if(ci(M))for(;M instanceof wo;)M=M.input;for(;!bi(v);)ci(v.output)&&(v=v.output);wi(M)?v.disconnect(M,I):bi(M)?v.disconnect(M,I,V):v.disconnect()}class ko extends wo{constructor(){super(Di(ko.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const v=Di(ko.getDefaults(),arguments,["gain","units"]);this.gain=new xo({context:this.context,convert:v.convert,param:this._gainNode.gain,units:v.units,value:v.gain,minValue:v.minValue,maxValue:v.maxValue}),Ui(this,"gain")}static getDefaults(){return Object.assign(wo.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Co extends wo{constructor(v){super(v),this.onended=Zi,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new ko({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(v){const M=this.toSeconds(v);return-1!==this._startTime&&M>=this._startTime&&(-1===this._stopTime||M<=this._stopTime)?"started":"stopped"},this._fadeIn=v.fadeIn,this._fadeOut=v.fadeOut,this._curve=v.curve,this.onended=v.onended}static getDefaults(){return Object.assign(wo.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Zi})}_startGain(v,M=1){ti(-1===this._startTime,"Source cannot be started more than once");const I=this.toSeconds(this._fadeIn);return this._startTime=v+I,this._startTime=Math.max(this._startTime,this.context.currentTime),I>0?(this._gainNode.gain.setValueAtTime(0,v),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(M,v+I):this._gainNode.gain.exponentialApproachValueAtTime(M,v,I)):this._gainNode.gain.setValueAtTime(M,v),this}stop(v){return this.log("stop",v),this._stopGain(this.toSeconds(v)),this}_stopGain(v){ti(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const M=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(v)+M,this._stopTime=Math.max(this._stopTime,this.context.currentTime),M>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,M,v):this._gainNode.gain.targetRampTo(0,M,v):(this._gainNode.gain.cancelAndHoldAtTime(v),this._gainNode.gain.setValueAtTime(0,v)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((()=>{const v="exponential"===this._curve?2*M:0;this._stopSource(this.now()+v),this._onended()}),this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Zi&&(this.onended(this),this.onended=Zi,!this.context.isOffline)){const t=()=>this.dispose();void 0!==window.requestIdleCallback?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),ti(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class Ao extends Co{constructor(){super(Di(Ao.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const v=Di(Ao.getDefaults(),arguments,["offset"]);To(this._source,this._gainNode),this.offset=new xo({context:this.context,convert:v.convert,param:this._source.offset,units:v.units,value:v.offset,minValue:v.minValue,maxValue:v.maxValue})}static getDefaults(){return Object.assign(Co.getDefaults(),{convert:!0,offset:1,units:"number"})}start(v){const M=this.toSeconds(v);return this.log("start",M),this._startGain(M),this._source.start(M),this}_stopSource(v){this._source.stop(v)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Do extends wo{constructor(){super(Di(Do.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const v=Di(Do.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new Ao({context:this.context,convert:v.convert,offset:v.value,units:v.units,minValue:v.minValue,maxValue:v.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(wo.getDefaults(),{convert:!0,units:"number",value:0})}connect(v,M=0,I=0){return Oo(this,v,M,I),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(v,M){return this._param.setValueAtTime(v,M),this}getValueAtTime(v){return this._param.getValueAtTime(v)}setRampPoint(v){return this._param.setRampPoint(v),this}linearRampToValueAtTime(v,M){return this._param.linearRampToValueAtTime(v,M),this}exponentialRampToValueAtTime(v,M){return this._param.exponentialRampToValueAtTime(v,M),this}exponentialRampTo(v,M,I){return this._param.exponentialRampTo(v,M,I),this}linearRampTo(v,M,I){return this._param.linearRampTo(v,M,I),this}targetRampTo(v,M,I){return this._param.targetRampTo(v,M,I),this}exponentialApproachValueAtTime(v,M,I){return this._param.exponentialApproachValueAtTime(v,M,I),this}setTargetAtTime(v,M,I){return this._param.setTargetAtTime(v,M,I),this}setValueCurveAtTime(v,M,I,V){return this._param.setValueCurveAtTime(v,M,I,V),this}cancelScheduledValues(v){return this._param.cancelScheduledValues(v),this}cancelAndHoldAtTime(v){return this._param.cancelAndHoldAtTime(v),this}rampTo(v,M,I){return this._param.rampTo(v,M,I),this}get value(){return this._param.value}set value(v){this._param.value=v}get convert(){return this._param.convert}set convert(v){this._param.convert=v}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(v){this._param.overridden=v}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(v){return this._param.apply(v),this}}function Oo(v,M,I,V){(M instanceof xo||wi(M)||M instanceof Do&&M.override)&&(M.cancelScheduledValues(0),M.setValueAtTime(0,0),M instanceof Do&&(M.overridden=!0)),To(v,M,I,V)}class Mo extends xo{constructor(){super(Di(Mo.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new Ni(1/0),this._multiplier=1;const v=Di(Mo.getDefaults(),arguments,["value"]);this._multiplier=v.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(v.value)}),this.setValueAtTime(v.value,0)}static getDefaults(){return Object.assign(xo.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(v,M,I){M=this.toSeconds(M),this.setRampPoint(M);const V=this._fromType(v),N=this._events.get(M),j=Math.round(Math.max(1/I,1));for(let v=0;v<=j;v++){const j=I*v+M,dt=this._exponentialApproach(N.time,N.value,V,I,j);this.linearRampToValueAtTime(this._toType(dt),j)}return this}setValueAtTime(v,M){const I=this.toSeconds(M);super.setValueAtTime(v,M);const V=this._events.get(I),N=this._events.previousEvent(V),j=this._getTicksUntilEvent(N,I);return V.ticks=Math.max(j,0),this}linearRampToValueAtTime(v,M){const I=this.toSeconds(M);super.linearRampToValueAtTime(v,M);const V=this._events.get(I),N=this._events.previousEvent(V),j=this._getTicksUntilEvent(N,I);return V.ticks=Math.max(j,0),this}exponentialRampToValueAtTime(v,M){M=this.toSeconds(M);const I=this._fromType(v),V=this._events.get(M),N=Math.round(Math.max(10*(M-V.time),1)),j=(M-V.time)/N;for(let v=0;v<=N;v++){const N=j*v+V.time,dt=this._exponentialInterpolate(V.time,V.value,M,I,N);this.linearRampToValueAtTime(this._toType(dt),N)}return this}_getTicksUntilEvent(v,M){if(null===v)v={ticks:0,time:0,type:"setValueAtTime",value:0};else if(ai(v.ticks)){const M=this._events.previousEvent(v);v.ticks=this._getTicksUntilEvent(M,v.time)}const I=this._fromType(this.getValueAtTime(v.time));let V=this._fromType(this.getValueAtTime(M));const N=this._events.get(M);return N&&N.time===M&&"setValueAtTime"===N.type&&(V=this._fromType(this.getValueAtTime(M-this.sampleTime))),.5*(M-v.time)*(I+V)+v.ticks}getTicksAtTime(v){const M=this.toSeconds(v),I=this._events.get(M);return Math.max(this._getTicksUntilEvent(I,M),0)}getDurationOfTicks(v,M){const I=this.toSeconds(M),V=this.getTicksAtTime(M);return this.getTimeOfTick(V+v)-I}getTimeOfTick(v){const M=this._events.get(v,"ticks"),I=this._events.getAfter(v,"ticks");if(M&&M.ticks===v)return M.time;if(M&&I&&"linearRampToValueAtTime"===I.type&&M.value!==I.value){const V=this._fromType(this.getValueAtTime(M.time)),N=(this._fromType(this.getValueAtTime(I.time))-V)/(I.time-M.time),j=Math.sqrt(Math.pow(V,2)-2*N*(M.ticks-v)),dt=(-V+j)/N,vt=(-V-j)/N;return(dt>0?dt:vt)+M.time}return M?0===M.value?1/0:M.time+(v-M.ticks)/M.value:v/this._initialValue}ticksToTime(v,M){return this.getDurationOfTicks(v,M)}timeToTicks(v,M){const I=this.toSeconds(M),V=this.toSeconds(v),N=this.getTicksAtTime(I);return this.getTicksAtTime(I+V)-N}_fromType(v){return"bpm"===this.units&&this.multiplier?1/(60/v/this.multiplier):super._fromType(v)}_toType(v){return"bpm"===this.units&&this.multiplier?v/this.multiplier*60:super._toType(v)}get multiplier(){return this._multiplier}set multiplier(v){const M=this.value;this._multiplier=v,this.cancelScheduledValues(0),this.setValueAtTime(M,0)}}class Eo extends Do{constructor(){super(Di(Eo.getDefaults(),arguments,["value"])),this.name="TickSignal";const v=Di(Eo.getDefaults(),arguments,["value"]);this.input=this._param=new Mo({context:this.context,convert:v.convert,multiplier:v.multiplier,param:this._constantSource.offset,units:v.units,value:v.value})}static getDefaults(){return Object.assign(Do.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(v,M){return this._param.ticksToTime(v,M)}timeToTicks(v,M){return this._param.timeToTicks(v,M)}getTimeOfTick(v){return this._param.getTimeOfTick(v)}getDurationOfTicks(v,M){return this._param.getDurationOfTicks(v,M)}getTicksAtTime(v){return this._param.getTicksAtTime(v)}get multiplier(){return this._param.multiplier}set multiplier(v){this._param.multiplier=v}dispose(){return super.dispose(),this._param.dispose(),this}}class Ro extends vo{constructor(){super(Di(Ro.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new yo,this._tickOffset=new Ni;const v=Di(Ro.getDefaults(),arguments,["frequency"]);this.frequency=new Eo({context:this.context,units:v.units,value:v.frequency}),Ui(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},vo.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(v,M){const I=this.toSeconds(v);return"started"!==this._state.getValueAtTime(I)&&(this._state.setStateAtTime("started",I),ci(M)&&this.setTicksAtTime(M,I)),this}stop(v){const M=this.toSeconds(v);if("stopped"===this._state.getValueAtTime(M)){const v=this._state.get(M);v&&v.time>0&&(this._tickOffset.cancel(v.time),this._state.cancel(v.time))}return this._state.cancel(M),this._state.setStateAtTime("stopped",M),this.setTicksAtTime(0,M),this}pause(v){const M=this.toSeconds(v);return"started"===this._state.getValueAtTime(M)&&this._state.setStateAtTime("paused",M),this}cancel(v){return v=this.toSeconds(v),this._state.cancel(v),this._tickOffset.cancel(v),this}getTicksAtTime(v){const M=this.toSeconds(v),I=this._state.getLastState("stopped",M),V={state:"paused",time:M};this._state.add(V);let N=I,j=0;return this._state.forEachBetween(I.time,M+this.sampleTime,(v=>{let M=N.time;const I=this._tickOffset.get(v.time);I&&I.time>=N.time&&(j=I.ticks,M=I.time),"started"===N.state&&"started"!==v.state&&(j+=this.frequency.getTicksAtTime(v.time)-this.frequency.getTicksAtTime(M)),N=v})),this._state.remove(V),j}get ticks(){return this.getTicksAtTime(this.now())}set ticks(v){this.setTicksAtTime(v,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(v){const M=this.now(),I=this.frequency.timeToTicks(v,M);this.setTicksAtTime(I,M)}getSecondsAtTime(v){v=this.toSeconds(v);const M=this._state.getLastState("stopped",v),I={state:"paused",time:v};this._state.add(I);let V=M,N=0;return this._state.forEachBetween(M.time,v+this.sampleTime,(v=>{let M=V.time;const I=this._tickOffset.get(v.time);I&&I.time>=V.time&&(N=I.seconds,M=I.time),"started"===V.state&&"started"!==v.state&&(N+=v.time-M),V=v})),this._state.remove(I),N}setTicksAtTime(v,M){return M=this.toSeconds(M),this._tickOffset.cancel(M),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(v,M),ticks:v,time:M}),this}getStateAtTime(v){return v=this.toSeconds(v),this._state.getValueAtTime(v)}getTimeOfTick(v,M=this.now()){const I=this._tickOffset.get(M),V=this._state.get(M),N=Math.max(I.time,V.time),j=this.frequency.getTicksAtTime(N)+v-I.ticks;return this.frequency.getTimeOfTick(j)}forEachTickBetween(v,M,I){let V=this._state.get(v);this._state.forEachBetween(v,M,(M=>{V&&"started"===V.state&&"started"!==M.state&&this.forEachTickBetween(Math.max(V.time,v),M.time-this.sampleTime,I),V=M}));let N=null;if(V&&"started"===V.state){const j=Math.max(V.time,v),dt=this.frequency.getTicksAtTime(j),vt=dt-this.frequency.getTicksAtTime(V.time);let yt=Math.ceil(vt)-vt;yt=Ii(yt,1)?0:yt;let xt=this.frequency.getTimeOfTick(dt+yt);for(;xt<M;){try{I(xt,Math.round(this.getTicksAtTime(xt)))}catch(v){N=v;break}xt+=this.frequency.getDurationOfTicks(1,xt)}}if(N)throw N;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class qo extends vo{constructor(){super(Di(qo.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=Zi,this._lastUpdate=0,this._state=new yo("stopped"),this._boundLoop=this._loop.bind(this);const v=Di(qo.getDefaults(),arguments,["callback","frequency"]);this.callback=v.callback,this._tickSource=new Ro({context:this.context,frequency:v.frequency,units:v.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,Ui(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(vo.getDefaults(),{callback:Zi,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(v,M){si(this.context);const I=this.toSeconds(v);return this.log("start",I),"started"!==this._state.getValueAtTime(I)&&(this._state.setStateAtTime("started",I),this._tickSource.start(I,M),I<this._lastUpdate&&this.emit("start",I,M)),this}stop(v){const M=this.toSeconds(v);return this.log("stop",M),this._state.cancel(M),this._state.setStateAtTime("stopped",M),this._tickSource.stop(M),M<this._lastUpdate&&this.emit("stop",M),this}pause(v){const M=this.toSeconds(v);return"started"===this._state.getValueAtTime(M)&&(this._state.setStateAtTime("paused",M),this._tickSource.pause(M),M<this._lastUpdate&&this.emit("pause",M)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(v){this._tickSource.ticks=v}get seconds(){return this._tickSource.seconds}set seconds(v){this._tickSource.seconds=v}getSecondsAtTime(v){return this._tickSource.getSecondsAtTime(v)}setTicksAtTime(v,M){return this._tickSource.setTicksAtTime(v,M),this}getTimeOfTick(v,M=this.now()){return this._tickSource.getTimeOfTick(v,M)}getTicksAtTime(v){return this._tickSource.getTicksAtTime(v)}nextTickTime(v,M){const I=this.toSeconds(M),V=this.getTicksAtTime(I);return this._tickSource.getTimeOfTick(V+v,I)}_loop(){const v=this._lastUpdate,M=this.now();this._lastUpdate=M,this.log("loop",v,M),v!==M&&(this._state.forEachBetween(v,M,(v=>{switch(v.state){case"started":const M=this._tickSource.getTicksAtTime(v.time);this.emit("start",v.time,M);break;case"stopped":0!==v.time&&this.emit("stop",v.time);break;case"paused":this.emit("pause",v.time)}})),this._tickSource.forEachTickBetween(v,M,((v,M)=>{this.callback(v,M)})))}getStateAtTime(v){const M=this.toSeconds(v);return this._state.getValueAtTime(M)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Bi.mixin(qo);class Fo extends wo{constructor(){super(Di(Fo.getDefaults(),arguments,["delayTime","maxDelay"])),this.name="Delay";const v=Di(Fo.getDefaults(),arguments,["delayTime","maxDelay"]),M=this.toSeconds(v.maxDelay);this._maxDelay=Math.max(M,this.toSeconds(v.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(M),this.delayTime=new xo({context:this.context,param:this._delayNode.delayTime,units:"time",value:v.delayTime,minValue:0,maxValue:this.maxDelay}),Ui(this,"delayTime")}static getDefaults(){return Object.assign(wo.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}function Io(M,I,V=2,N=Ji().sampleRate){return yi(this||v,void 0,void 0,(function*(){const v=Ji(),j=new Yi(V,I,N);Ki(j),yield M(j);const dt=j.render();Ki(v);const vt=yield dt;return new Xi(vt)}))}class Vo extends Ei{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const v=Di(Vo.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=v.baseUrl,Object.keys(v.urls).forEach((M=>{this._loadingCount++;const I=v.urls[M];this.add(M,I,this._bufferLoaded.bind(this,v.onload),v.onerror)}))}static getDefaults(){return{baseUrl:"",onerror:Zi,onload:Zi,urls:{}}}has(v){return this._buffers.has(v.toString())}get(v){return ti(this.has(v),"ToneAudioBuffers has no buffer named: "+v),this._buffers.get(v.toString())}_bufferLoaded(v){this._loadingCount--,0===this._loadingCount&&v&&v()}get loaded(){return Array.from(this._buffers).every((([v,M])=>M.loaded))}add(v,M,I=Zi,V=Zi){return fi(M)?this._buffers.set(v.toString(),new Xi(this.baseUrl+M,I,V)):this._buffers.set(v.toString(),new Xi(M,I,V)),this}dispose(){return super.dispose(),this._buffers.forEach((v=>v.dispose())),this._buffers.clear(),this}}class No extends lo{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(v){return oo(super._frequencyToUnits(v))}_ticksToUnits(v){return oo(super._ticksToUnits(v))}_beatsToUnits(v){return oo(super._beatsToUnits(v))}_secondsToUnits(v){return oo(super._secondsToUnits(v))}toMidi(){return this.valueOf()}toFrequency(){return ao(this.toMidi())}transpose(v){return new No(this.context,this.toMidi()+v)}}function Po(v,M){return new No(Ji(),v,M)}class jo extends mo{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(v){return this._getPPQ()*v}_secondsToUnits(v){return Math.floor(v/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(v){return v}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}function Lo(v,M){return new jo(Ji(),v,M)}class zo extends vo{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Ni,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(v,M){return this._events.add({callback:v,time:this.toSeconds(M)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(v){return this._events.cancel(this.toSeconds(v)),this}_drawLoop(){const v=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=v;){const M=this._events.shift();M&&v-M.time<=this.expiration&&M.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}ji((v=>{v.draw=new zo({context:v})})),zi((v=>{v.draw.dispose()}));class Bo extends Ei{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(v){ti(ci(v.time),"Events must have a time property"),ti(ci(v.duration),"Events must have a duration parameter"),v.time=v.time.valueOf();let M=new Wo(v.time,v.time+v.duration,v);for(null===this._root?this._root=M:this._root.insert(M),this._length++;null!==M;)M.updateHeight(),M.updateMax(),this._rebalance(M),M=M.parent;return this}remove(v){if(null!==this._root){const M=[];this._root.search(v.time,M);for(const I of M)if(I.event===v){this._removeNode(I),this._length--;break}}return this}get length(){return this._length}cancel(v){return this.forEachFrom(v,(v=>this.remove(v))),this}_setRoot(v){this._root=v,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(v,M){null!==v.parent?(v.isLeftChild()?v.parent.left=M:v.parent.right=M,this._rebalance(v.parent)):this._setRoot(M)}_removeNode(v){if(null===v.left&&null===v.right)this._replaceNodeInParent(v,null);else if(null===v.right)this._replaceNodeInParent(v,v.left);else if(null===v.left)this._replaceNodeInParent(v,v.right);else{let M,I=null;if(v.getBalance()>0)if(null===v.left.right)M=v.left,M.right=v.right,I=M;else{for(M=v.left.right;null!==M.right;)M=M.right;M.parent&&(M.parent.right=M.left,I=M.parent,M.left=v.left,M.right=v.right)}else if(null===v.right.left)M=v.right,M.left=v.left,I=M;else{for(M=v.right.left;null!==M.left;)M=M.left;M.parent&&(M.parent.left=M.right,I=M.parent,M.left=v.left,M.right=v.right)}null!==v.parent?v.isLeftChild()?v.parent.left=M:v.parent.right=M:this._setRoot(M),I&&this._rebalance(I)}v.dispose()}_rotateLeft(v){const M=v.parent,I=v.isLeftChild(),V=v.right;V&&(v.right=V.left,V.left=v),null!==M?I?M.left=V:M.right=V:this._setRoot(V)}_rotateRight(v){const M=v.parent,I=v.isLeftChild(),V=v.left;V&&(v.left=V.right,V.right=v),null!==M?I?M.left=V:M.right=V:this._setRoot(V)}_rebalance(v){const M=v.getBalance();M>1&&v.left?v.left.getBalance()<0?this._rotateLeft(v.left):this._rotateRight(v):M<-1&&v.right&&(v.right.getBalance()>0?this._rotateRight(v.right):this._rotateLeft(v))}get(v){if(null!==this._root){const M=[];if(this._root.search(v,M),M.length>0){let v=M[0];for(let I=1;I<M.length;I++)M[I].low>v.low&&(v=M[I]);return v.event}}return null}forEach(v){if(null!==this._root){const M=[];this._root.traverse((v=>M.push(v))),M.forEach((M=>{M.event&&v(M.event)}))}return this}forEachAtTime(v,M){if(null!==this._root){const I=[];this._root.search(v,I),I.forEach((v=>{v.event&&M(v.event)}))}return this}forEachFrom(v,M){if(null!==this._root){const I=[];this._root.searchAfter(v,I),I.forEach((v=>{v.event&&M(v.event)}))}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse((v=>v.dispose())),this._root=null,this}}class Wo{constructor(v,M,I){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=I,this.low=v,this.high=M,this.max=this.high}insert(v){v.low<=this.low?null===this.left?this.left=v:this.left.insert(v):null===this.right?this.right=v:this.right.insert(v)}search(v,M){v>this.max||(null!==this.left&&this.left.search(v,M),this.low<=v&&this.high>v&&M.push(this),this.low>v||null!==this.right&&this.right.search(v,M))}searchAfter(v,M){this.low>=v&&(M.push(this),null!==this.left&&this.left.searchAfter(v,M)),null!==this.right&&this.right.searchAfter(v,M)}traverse(v){v(this),null!==this.left&&this.left.traverse(v),null!==this.right&&this.right.traverse(v)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let v=0;return null!==this.left&&null!==this.right?v=this.left.height-this.right.height:null!==this.left?v=this.left.height+1:null!==this.right&&(v=-(this.right.height+1)),v}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(v){this._left=v,null!==v&&(v.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(v){this._right=v,null!==v&&(v.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Go extends wo{constructor(){super(Di(Go.getDefaults(),arguments,["volume"])),this.name="Volume";const v=Di(Go.getDefaults(),arguments,["volume"]);this.input=this.output=new ko({context:this.context,gain:v.volume,units:"decibels"}),this.volume=this.output.gain,Ui(this,"volume"),this._unmutedVolume=v.volume,this.mute=v.mute}static getDefaults(){return Object.assign(wo.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(v){!this.mute&&v?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!v&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class Uo extends wo{constructor(){super(Di(Uo.getDefaults(),arguments)),this.name="Destination",this.input=new Go({context:this.context}),this.output=new ko({context:this.context}),this.volume=this.input.volume;const v=Di(Uo.getDefaults(),arguments);bo(this.input,this.output,this.context.rawContext.destination),this.mute=v.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(wo.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(v){this.input.mute=v}chain(...v){return this.input.disconnect(),v.unshift(this.input),v.push(this.output),bo(...v),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}ji((v=>{v.destination=new Uo({context:v})})),zi((v=>{v.destination.dispose()}));class Qo extends Ei{constructor(v){super(),this.name="TimelineValue",this._timeline=new Ni({memory:10}),this._initialValue=v}set(v,M){return this._timeline.add({value:v,time:M}),this}get(v){const M=this._timeline.get(v);return M?M.value:this._initialValue}}class Zo{constructor(v,M){this.id=Zo._eventId++;const I=Object.assign(Zo.getDefaults(),M);this.transport=v,this.callback=I.callback,this._once=I.once,this.time=I.time}static getDefaults(){return{callback:Zi,once:!1,time:0}}invoke(v){this.callback&&(this.callback(v),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}Zo._eventId=0;class Xo extends Zo{constructor(v,M){super(v,M),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const I=Object.assign(Xo.getDefaults(),M);this.duration=new jo(v.context,I.duration).valueOf(),this._interval=new jo(v.context,I.interval).valueOf(),this._nextTick=I.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},Zo.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(v){this._createEvents(v),super.invoke(v)}_createEvents(v){const M=this.transport.getTicksAtTime(v);M>=this.time&&M>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new jo(this.context,this._nextTick).toSeconds()))}_restart(v){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const M=this.transport.getTicksAtTime(v);M>this.time&&(this._nextTick=this.time+Math.ceil((M-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new jo(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new jo(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}class Yo extends vo{constructor(){super(Di(Yo.getDefaults(),arguments)),this.name="Transport",this._loop=new Qo(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Ni,this._repeatedEvents=new Bo,this._syncedSignals=[],this._swingAmount=0;const v=Di(Yo.getDefaults(),arguments);this._ppq=v.ppq,this._clock=new qo({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=v.ppq,this.bpm.setValueAtTime(v.bpm,0),Ui(this,"bpm"),this._timeSignature=v.timeSignature,this._swingTicks=v.ppq/2}static getDefaults(){return Object.assign(vo.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(v,M){if(this._loop.get(v)&&M>=this._loopEnd&&(this.emit("loopEnd",v),this._clock.setTicksAtTime(this._loopStart,v),M=this._loopStart,this.emit("loopStart",v,this._clock.getSecondsAtTime(v)),this.emit("loop",v)),this._swingAmount>0&&M%this._ppq!=0&&M%(2*this._swingTicks)!=0){const I=M%(2*this._swingTicks)/(2*this._swingTicks),V=Math.sin(I*Math.PI)*this._swingAmount;v+=new jo(this.context,2*this._swingTicks/3).toSeconds()*V}this._timeline.forEachAtTime(M,(M=>M.invoke(v)))}schedule(v,M){const I=new Zo(this,{callback:v,time:new mo(this.context,M).toTicks()});return this._addEvent(I,this._timeline)}scheduleRepeat(v,M,I,V=1/0){const N=new Xo(this,{callback:v,duration:new ho(this.context,V).toTicks(),interval:new ho(this.context,M).toTicks(),time:new mo(this.context,I).toTicks()});return this._addEvent(N,this._repeatedEvents)}scheduleOnce(v,M){const I=new Zo(this,{callback:v,once:!0,time:new mo(this.context,M).toTicks()});return this._addEvent(I,this._timeline)}clear(v){if(this._scheduledEvents.hasOwnProperty(v)){const M=this._scheduledEvents[v.toString()];M.timeline.remove(M.event),M.event.dispose(),delete this._scheduledEvents[v.toString()]}return this}_addEvent(v,M){return this._scheduledEvents[v.id.toString()]={event:v,timeline:M},M.add(v),v.id}cancel(v=0){const M=this.toTicks(v);return this._timeline.forEachFrom(M,(v=>this.clear(v.id))),this._repeatedEvents.forEachFrom(M,(v=>this.clear(v.id))),this}_bindClockEvents(){this._clock.on("start",((v,M)=>{M=new jo(this.context,M).toSeconds(),this.emit("start",v,M)})),this._clock.on("stop",(v=>{this.emit("stop",v)})),this._clock.on("pause",(v=>{this.emit("pause",v)}))}get state(){return this._clock.getStateAtTime(this.now())}start(v,M){let I;return ci(M)&&(I=this.toTicks(M)),this._clock.start(v,I),this}stop(v){return this._clock.stop(v),this}pause(v){return this._clock.pause(v),this}toggle(v){return v=this.toSeconds(v),"started"!==this._clock.getStateAtTime(v)?this.start(v):this.stop(v),this}get timeSignature(){return this._timeSignature}set timeSignature(v){di(v)&&(v=v[0]/v[1]*4),this._timeSignature=v}get loopStart(){return new ho(this.context,this._loopStart,"i").toSeconds()}set loopStart(v){this._loopStart=this.toTicks(v)}get loopEnd(){return new ho(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(v){this._loopEnd=this.toTicks(v)}get loop(){return this._loop.get(this.now())}set loop(v){this._loop.set(v,this.now())}setLoopPoints(v,M){return this.loopStart=v,this.loopEnd=M,this}get swing(){return this._swingAmount}set swing(v){this._swingAmount=v}get swingSubdivision(){return new jo(this.context,this._swingTicks).toNotation()}set swingSubdivision(v){this._swingTicks=this.toTicks(v)}get position(){const v=this.now(),M=this._clock.getTicksAtTime(v);return new jo(this.context,M).toBarsBeatsSixteenths()}set position(v){const M=this.toTicks(v);this.ticks=M}get seconds(){return this._clock.seconds}set seconds(v){const M=this.now(),I=this._clock.frequency.timeToTicks(v,M);this.ticks=I}get progress(){if(this.loop){const v=this.now();return(this._clock.getTicksAtTime(v)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(v){if(this._clock.ticks!==v){const M=this.now();if("started"===this.state){const I=this._clock.getTicksAtTime(M),V=M+this._clock.frequency.getDurationOfTicks(Math.ceil(I)-I,M);this.emit("stop",V),this._clock.setTicksAtTime(v,V),this.emit("start",V,this._clock.getSecondsAtTime(V))}else this._clock.setTicksAtTime(v,M)}}getTicksAtTime(v){return Math.round(this._clock.getTicksAtTime(v))}getSecondsAtTime(v){return this._clock.getSecondsAtTime(v)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(v){this._clock.frequency.multiplier=v}nextSubdivision(v){if(v=this.toTicks(v),"started"!==this.state)return 0;{const M=this.now(),I=v-this.getTicksAtTime(M)%v;return this._clock.nextTickTime(I,M)}}syncSignal(v,M){if(!M){const I=this.now();if(0!==v.getValueAtTime(I)){const V=1/(60/this.bpm.getValueAtTime(I)/this.PPQ);M=v.getValueAtTime(I)/V}else M=0}const I=new ko(M);return this.bpm.connect(I),I.connect(v._param),this._syncedSignals.push({initial:v.value,ratio:I,signal:v}),v.value=0,this}unsyncSignal(v){for(let M=this._syncedSignals.length-1;M>=0;M--){const I=this._syncedSignals[M];I.signal===v&&(I.ratio.dispose(),I.signal.value=I.initial,this._syncedSignals.splice(M,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Qi(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Bi.mixin(Yo),ji((v=>{v.transport=new Yo({context:v})})),zi((v=>{v.transport.dispose()}));class Ho extends wo{constructor(v){super(v),this.input=void 0,this._state=new yo("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Zi,this._syncedStop=Zi,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Go({context:this.context,mute:v.mute,volume:v.volume}),this.volume=this._volume.volume,Ui(this,"volume"),this.onstop=v.onstop}static getDefaults(){return Object.assign(wo.getDefaults(),{mute:!1,onstop:Zi,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(v){this._volume.mute=v}_clampToCurrentTime(v){return this._synced?v:Math.max(v,this.context.currentTime)}start(v,M,I){let V=ai(v)&&this._synced?this.context.transport.seconds:this.toSeconds(v);if(V=this._clampToCurrentTime(V),this._synced||"started"!==this._state.getValueAtTime(V))if(this.log("start",V),this._state.setStateAtTime("started",V),this._synced){const v=this._state.get(V);v&&(v.offset=this.toSeconds(Oi(M,0)),v.duration=I?this.toSeconds(I):void 0);const N=this.context.transport.schedule((v=>{this._start(v,M,I)}),V);this._scheduled.push(N),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>V&&this._syncedStart(this.now(),this.context.transport.seconds)}else si(this.context),this._start(V,M,I);else ti(Ri(V,this._state.get(V).time),"Start time must be strictly greater than previous start time"),this._state.cancel(V),this._state.setStateAtTime("started",V),this.log("restart",V),this.restart(V,M,I);return this}stop(v){let M=ai(v)&&this._synced?this.context.transport.seconds:this.toSeconds(v);if(M=this._clampToCurrentTime(M),"started"===this._state.getValueAtTime(M)||ci(this._state.getNextState("started",M))){if(this.log("stop",M),this._synced){const v=this.context.transport.schedule(this._stop.bind(this),M);this._scheduled.push(v)}else this._stop(M);this._state.cancel(M),this._state.setStateAtTime("stopped",M)}return this}restart(v,M,I){return v=this.toSeconds(v),"started"===this._state.getValueAtTime(v)&&(this._state.cancel(v),this._restart(v,M,I)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(v,M)=>{if(M>0){const I=this._state.get(M);if(I&&"started"===I.state&&I.time!==M){const V=M-this.toSeconds(I.time);let N;I.duration&&(N=this.toSeconds(I.duration)-V),this._start(v,this.toSeconds(I.offset)+V,N)}}},this._syncedStop=v=>{const M=this.context.transport.getSecondsAtTime(Math.max(v-this.sampleTime,0));"started"===this._state.getValueAtTime(M)&&this._stop(v)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((v=>this.context.transport.clear(v))),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Zi,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class $o extends Co{constructor(){super(Di($o.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const v=Di($o.getDefaults(),arguments,["url","onload"]);To(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new xo({context:this.context,param:this._source.playbackRate,units:"positive",value:v.playbackRate}),this.loop=v.loop,this.loopStart=v.loopStart,this.loopEnd=v.loopEnd,this._buffer=new Xi(v.url,v.onload,v.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Co.getDefaults(),{url:new Xi,loop:!1,loopEnd:0,loopStart:0,onload:Zi,onerror:Zi,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(v){this._fadeIn=v}get fadeOut(){return this._fadeOut}set fadeOut(v){this._fadeOut=v}get curve(){return this._curve}set curve(v){this._curve=v}start(v,M,I,V=1){ti(this.buffer.loaded,"buffer is either not set or not loaded");const N=this.toSeconds(v);this._startGain(N,V),M=this.loop?Oi(M,this.loopStart):Oi(M,0);let j=Math.max(this.toSeconds(M),0);if(this.loop){const v=this.toSeconds(this.loopEnd)||this.buffer.duration,M=this.toSeconds(this.loopStart),I=v-M;qi(j,v)&&(j=(j-M)%I+M),Ii(j,this.buffer.duration)&&(j=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,Fi(j,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(N,j)),ci(I)){let v=this.toSeconds(I);v=Math.max(v,0),this.stop(N+v)}return this}_stopSource(v){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(v)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(v){this._source.loopStart=this.toSeconds(v)}get loopEnd(){return this._source.loopEnd}set loopEnd(v){this._source.loopEnd=this.toSeconds(v)}get buffer(){return this._buffer}set buffer(v){this._buffer.set(v)}get loop(){return this._source.loop}set loop(v){this._source.loop=v,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class Jo extends Ho{constructor(){super(Di(Jo.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;const v=Di(Jo.getDefaults(),arguments,["type"]);this._playbackRate=v.playbackRate,this.type=v.type,this._fadeIn=v.fadeIn,this._fadeOut=v.fadeOut}static getDefaults(){return Object.assign(Ho.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(v){if(ti(v in Wc,"Noise: invalid type: "+v),this._type!==v&&(this._type=v,"started"===this.state)){const v=this.now();this._stop(v),this._start(v)}}get playbackRate(){return this._playbackRate}set playbackRate(v){this._playbackRate=v,this._source&&(this._source.playbackRate.value=v)}_start(v){const M=Wc[this._type];this._source=new $o({url:M,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(v),Math.random()*(M.duration-.001))}_stop(v){this._source&&(this._source.stop(this.toSeconds(v)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(v){this._fadeIn=v,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(v){this._fadeOut=v,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(v){this._stop(v),this._start(v)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const Bc={brown:null,pink:null,white:null},Wc={get brown(){if(!Bc.brown){const v=[];for(let M=0;M<2;M++){const I=new Float32Array(220500);v[M]=I;let V=0;for(let v=0;v<220500;v++){const M=2*Math.random()-1;I[v]=(V+.02*M)/1.02,V=I[v],I[v]*=3.5}}Bc.brown=(new Xi).fromArray(v)}return Bc.brown},get pink(){if(!Bc.pink){const v=[];for(let M=0;M<2;M++){const I=new Float32Array(220500);let V,N,j,dt,vt,yt,xt;v[M]=I,V=N=j=dt=vt=yt=xt=0;for(let v=0;v<220500;v++){const M=2*Math.random()-1;V=.99886*V+.0555179*M,N=.99332*N+.0750759*M,j=.969*j+.153852*M,dt=.8665*dt+.3104856*M,vt=.55*vt+.5329522*M,yt=-.7616*yt-.016898*M,I[v]=V+N+j+dt+vt+yt+xt+.5362*M,I[v]*=.11,xt=.115926*M}}Bc.pink=(new Xi).fromArray(v)}return Bc.pink},get white(){if(!Bc.white){const v=[];for(let M=0;M<2;M++){const I=new Float32Array(220500);v[M]=I;for(let v=0;v<220500;v++)I[v]=2*Math.random()-1}Bc.white=(new Xi).fromArray(v)}return Bc.white}};class er extends wo{constructor(){super(Di(er.getDefaults(),arguments,["volume"])),this.name="UserMedia";const v=Di(er.getDefaults(),arguments,["volume"]);this._volume=this.output=new Go({context:this.context,volume:v.volume}),this.volume=this._volume.volume,Ui(this,"volume"),this.mute=v.mute}static getDefaults(){return Object.assign(wo.getDefaults(),{mute:!1,volume:0})}open(v){return yi(this,void 0,void 0,(function*(){ti(er.supported,"UserMedia is not supported"),"started"===this.state&&this.close();const M=yield er.enumerateDevices();ui(v)?this._device=M[v]:(this._device=M.find((M=>M.label===v||M.deviceId===v)),!this._device&&M.length>0&&(this._device=M[0]),ti(ci(this._device),"No matching device "+v));const I={audio:{echoCancellation:!1,sampleRate:this.context.sampleRate,noiseSuppression:!1,mozNoiseSuppression:!1}};this._device&&(I.audio.deviceId=this._device.deviceId);const V=yield navigator.mediaDevices.getUserMedia(I);if(!this._stream){this._stream=V;const v=this.context.createMediaStreamSource(V);To(v,this.output),this._mediaStream=v}return this}))}close(){return this._stream&&this._mediaStream&&(this._stream.getAudioTracks().forEach((v=>{v.stop()})),this._stream=void 0,this._mediaStream.disconnect(),this._mediaStream=void 0),this._device=void 0,this}static enumerateDevices(){return yi(this,void 0,void 0,(function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter((v=>"audioinput"===v.kind))}))}get state(){return this._stream&&this._stream.active?"started":"stopped"}get deviceId(){return this._device?this._device.deviceId:void 0}get groupId(){return this._device?this._device.groupId:void 0}get label(){return this._device?this._device.label:void 0}get mute(){return this._volume.mute}set mute(v){this._volume.mute=v}dispose(){return super.dispose(),this.close(),this._volume.dispose(),this.volume.dispose(),this}static get supported(){return ci(navigator.mediaDevices)&&ci(navigator.mediaDevices.getUserMedia)}}function sr(M,I){return yi(this||v,void 0,void 0,(function*(){const v=I/M.context.sampleRate,V=new Yi(1,v,M.context.sampleRate);new M.constructor(Object.assign(M.get(),{frequency:2/v,detune:0,context:V})).toDestination().start(0);return(yield V.render()).getChannelData(0)}))}class nr extends Co{constructor(){super(Di(nr.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const v=Di(nr.getDefaults(),arguments,["frequency","type"]);To(this._oscillator,this._gainNode),this.type=v.type,this.frequency=new xo({context:this.context,param:this._oscillator.frequency,units:"frequency",value:v.frequency}),this.detune=new xo({context:this.context,param:this._oscillator.detune,units:"cents",value:v.detune}),Ui(this,["frequency","detune"])}static getDefaults(){return Object.assign(Co.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(v){const M=this.toSeconds(v);return this.log("start",M),this._startGain(M),this._oscillator.start(M),this}_stopSource(v){this._oscillator.stop(v)}setPeriodicWave(v){return this._oscillator.setPeriodicWave(v),this}get type(){return this._oscillator.type}set type(v){this._oscillator.type=v}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class ir extends Ho{constructor(){super(Di(ir.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const v=Di(ir.getDefaults(),arguments,["frequency","type"]);this.frequency=new Do({context:this.context,units:"frequency",value:v.frequency}),Ui(this,"frequency"),this.detune=new Do({context:this.context,units:"cents",value:v.detune}),Ui(this,"detune"),this._partials=v.partials,this._partialCount=v.partialCount,this._type=v.type,v.partialCount&&"custom"!==v.type&&(this._type=this.baseType+v.partialCount.toString()),this.phase=v.phase}static getDefaults(){return Object.assign(Ho.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(v){const M=this.toSeconds(v),I=new nr({context:this.context,onended:()=>this.onstop(this)});this._oscillator=I,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(M)}_stop(v){const M=this.toSeconds(v);this._oscillator&&this._oscillator.stop(M)}_restart(v){const M=this.toSeconds(v);return this.log("restart",M),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(M),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type)return ir._periodicWaveCache.find((v=>{return v.phase===this._phase&&(M=v.partials,I=this._partials,M.length===I.length&&M.every(((v,M)=>I[M]===v)));var M,I}));{const v=ir._periodicWaveCache.find((v=>v.type===this._type&&v.phase===this._phase));return this._partialCount=v?v.partialCount:this._partialCount,v}}get type(){return this._type}set type(v){this._type=v;const M=-1!==["sine","square","sawtooth","triangle"].indexOf(v);if(0===this._phase&&M)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=v);else{const M=this._getCachedPeriodicWave();if(ci(M)){const{partials:v,wave:I}=M;this._wave=I,this._partials=v,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[M,I]=this._getRealImaginary(v,this._phase),V=this.context.createPeriodicWave(M,I);this._wave=V,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),ir._periodicWaveCache.push({imag:I,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:M,type:this._type,wave:this._wave}),ir._periodicWaveCache.length>100&&ir._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(v){this.partialCount&&"custom"!==this._type&&"custom"!==v?this.type=v+this.partialCount:this.type=v}get partialCount(){return this._partialCount}set partialCount(v){ei(v,0);let M=this._type;const I=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(I&&(M=I[1]),"custom"!==this._type)this.type=0===v?M:M+v.toString();else{const M=new Float32Array(v);this._partials.forEach(((v,I)=>M[I]=v)),this._partials=Array.from(M),this.type=this._type}}_getRealImaginary(v,M){let I=2048;const V=new Float32Array(I),N=new Float32Array(I);let j=1;if("custom"===v){if(j=this._partials.length+1,this._partialCount=this._partials.length,I=j,0===this._partials.length)return[V,N]}else{const M=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(v);M?(j=parseInt(M[2],10)+1,this._partialCount=parseInt(M[2],10),v=M[1],j=Math.max(j,2),I=j):this._partialCount=0,this._partials=[]}for(let dt=1;dt<I;++dt){const I=2/(dt*Math.PI);let vt;switch(v){case"sine":vt=dt<=j?1:0,this._partials[dt-1]=vt;break;case"square":vt=1&dt?2*I:0,this._partials[dt-1]=vt;break;case"sawtooth":vt=I*(1&dt?1:-1),this._partials[dt-1]=vt;break;case"triangle":vt=1&dt?I*I*2*(dt-1>>1&1?-1:1):0,this._partials[dt-1]=vt;break;case"custom":vt=this._partials[dt-1];break;default:throw new TypeError("Oscillator: invalid type: "+v)}0!==vt?(V[dt]=-vt*Math.sin(M*dt),N[dt]=vt*Math.cos(M*dt)):(V[dt]=0,N[dt]=0)}return[V,N]}_inverseFFT(v,M,I){let V=0;const N=v.length;for(let j=0;j<N;j++)V+=v[j]*Math.cos(j*I)+M[j]*Math.sin(j*I);return V}getInitialValue(){const[v,M]=this._getRealImaginary(this._type,0);let I=0;const V=2*Math.PI;for(let N=0;N<32;N++)I=Math.max(this._inverseFFT(v,M,N/32*V),I);return Vi(-this._inverseFFT(v,M,this._phase)/I,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(v){this._partials=v,this._partialCount=this._partials.length,v.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(v){this._phase=v*Math.PI/180,this.type=this._type}asArray(v=1024){return yi(this,void 0,void 0,(function*(){return sr(this,v)}))}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}ir._periodicWaveCache=[];class or extends wo{constructor(){super(Object.assign(Di(or.getDefaults(),arguments,["context"])))}connect(v,M=0,I=0){return Oo(this,v,M,I),this}}class rr extends or{constructor(){super(Object.assign(Di(rr.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const v=Di(rr.getDefaults(),arguments,["mapping","length"]);di(v.mapping)||v.mapping instanceof Float32Array?this.curve=Float32Array.from(v.mapping):hi(v.mapping)&&this.setMap(v.mapping,v.length)}static getDefaults(){return Object.assign(Do.getDefaults(),{length:1024})}setMap(v,M=1024){const I=new Float32Array(M);for(let V=0,N=M;V<N;V++){const M=V/(N-1)*2-1;I[V]=v(M,V)}return this.curve=I,this}get curve(){return this._shaper.curve}set curve(v){this._shaper.curve=v}get oversample(){return this._shaper.oversample}set oversample(v){ti(["none","2x","4x"].some((M=>M.includes(v))),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=v}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class ar extends or{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new rr({context:this.context,mapping:v=>(v+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class cr extends Do{constructor(){super(Object.assign(Di(cr.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const v=Di(cr.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new ko({context:this.context,minValue:v.minValue,maxValue:v.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(v.value,0)}static getDefaults(){return Object.assign(Do.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class hr extends Ho{constructor(){super(Di(hr.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new ar({context:this.context}),this._modulationNode=new ko({context:this.context});const v=Di(hr.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new ir({context:this.context,detune:v.detune,frequency:v.frequency,onstop:()=>this.onstop(this),phase:v.phase,type:v.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new ir({context:this.context,phase:v.phase,type:v.modulationType}),this.harmonicity=new cr({context:this.context,units:"positive",value:v.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),Ui(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ir.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(v){this._modulator.start(v),this._carrier.start(v)}_stop(v){this._modulator.stop(v),this._carrier.stop(v)}_restart(v){this._modulator.restart(v),this._carrier.restart(v)}get type(){return this._carrier.type}set type(v){this._carrier.type=v}get baseType(){return this._carrier.baseType}set baseType(v){this._carrier.baseType=v}get partialCount(){return this._carrier.partialCount}set partialCount(v){this._carrier.partialCount=v}get modulationType(){return this._modulator.type}set modulationType(v){this._modulator.type=v}get phase(){return this._carrier.phase}set phase(v){this._carrier.phase=v,this._modulator.phase=v}get partials(){return this._carrier.partials}set partials(v){this._carrier.partials=v}asArray(v=1024){return yi(this,void 0,void 0,(function*(){return sr(this,v)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class ur extends Ho{constructor(){super(Di(ur.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new ko({context:this.context,gain:0});const v=Di(ur.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new ir({context:this.context,detune:v.detune,frequency:0,onstop:()=>this.onstop(this),phase:v.phase,type:v.type}),this.detune=this._carrier.detune,this.frequency=new Do({context:this.context,units:"frequency",value:v.frequency}),this._modulator=new ir({context:this.context,phase:v.phase,type:v.modulationType}),this.harmonicity=new cr({context:this.context,units:"positive",value:v.harmonicity}),this.modulationIndex=new cr({context:this.context,units:"positive",value:v.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),Ui(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ir.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(v){this._modulator.start(v),this._carrier.start(v)}_stop(v){this._modulator.stop(v),this._carrier.stop(v)}_restart(v){return this._modulator.restart(v),this._carrier.restart(v),this}get type(){return this._carrier.type}set type(v){this._carrier.type=v}get baseType(){return this._carrier.baseType}set baseType(v){this._carrier.baseType=v}get partialCount(){return this._carrier.partialCount}set partialCount(v){this._carrier.partialCount=v}get modulationType(){return this._modulator.type}set modulationType(v){this._modulator.type=v}get phase(){return this._carrier.phase}set phase(v){this._carrier.phase=v,this._modulator.phase=v}get partials(){return this._carrier.partials}set partials(v){this._carrier.partials=v}asArray(v=1024){return yi(this,void 0,void 0,(function*(){return sr(this,v)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class lr extends Ho{constructor(){super(Di(lr.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new ko({context:this.context,gain:0}),this._thresh=new rr({context:this.context,mapping:v=>v<=0?-1:1});const v=Di(lr.getDefaults(),arguments,["frequency","width"]);this.width=new Do({context:this.context,units:"audioRange",value:v.width}),this._triangle=new ir({context:this.context,detune:v.detune,frequency:v.frequency,onstop:()=>this.onstop(this),phase:v.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),Ui(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Ho.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(v){v=this.toSeconds(v),this._triangle.start(v),this._widthGate.gain.setValueAtTime(1,v)}_stop(v){v=this.toSeconds(v),this._triangle.stop(v),this._widthGate.gain.cancelScheduledValues(v),this._widthGate.gain.setValueAtTime(0,v)}_restart(v){this._triangle.restart(v),this._widthGate.gain.cancelScheduledValues(v),this._widthGate.gain.setValueAtTime(1,v)}get phase(){return this._triangle.phase}set phase(v){this._triangle.phase=v}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(v){this._triangle.type=v}asArray(v=1024){return yi(this,void 0,void 0,(function*(){return sr(this,v)}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class pr extends Ho{constructor(){super(Di(pr.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const v=Di(pr.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new Do({context:this.context,units:"frequency",value:v.frequency}),this.detune=new Do({context:this.context,units:"cents",value:v.detune}),this._spread=v.spread,this._type=v.type,this._phase=v.phase,this._partials=v.partials,this._partialCount=v.partialCount,this.count=v.count,Ui(this,["frequency","detune"])}static getDefaults(){return Object.assign(ir.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(v){v=this.toSeconds(v),this._forEach((M=>M.start(v)))}_stop(v){v=this.toSeconds(v),this._forEach((M=>M.stop(v)))}_restart(v){this._forEach((M=>M.restart(v)))}_forEach(v){for(let M=0;M<this._oscillators.length;M++)v(this._oscillators[M],M)}get type(){return this._type}set type(v){this._type=v,this._forEach((M=>M.type=v))}get spread(){return this._spread}set spread(v){if(this._spread=v,this._oscillators.length>1){const M=-v/2,I=v/(this._oscillators.length-1);this._forEach(((v,V)=>v.detune.value=M+I*V))}}get count(){return this._oscillators.length}set count(v){if(ei(v,1),this._oscillators.length!==v){this._forEach((v=>v.dispose())),this._oscillators=[];for(let M=0;M<v;M++){const I=new ir({context:this.context,volume:-6-1.1*v,type:this._type,phase:this._phase+M/v*360,partialCount:this._partialCount,onstop:0===M?()=>this.onstop(this):Zi});"custom"===this.type&&(I.partials=this._partials),this.frequency.connect(I.frequency),this.detune.connect(I.detune),I.detune.overridden=!1,I.connect(this.output),this._oscillators[M]=I}this.spread=this._spread,"started"===this.state&&this._forEach((v=>v.start()))}}get phase(){return this._phase}set phase(v){this._phase=v,this._forEach(((v,M)=>v.phase=this._phase+M/this.count*360))}get baseType(){return this._oscillators[0].baseType}set baseType(v){this._forEach((M=>M.baseType=v)),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(v){this._partials=v,this._partialCount=this._partials.length,v.length&&(this._type="custom",this._forEach((M=>M.partials=v)))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(v){this._partialCount=v,this._forEach((M=>M.partialCount=v)),this._type=this._oscillators[0].type}asArray(v=1024){return yi(this,void 0,void 0,(function*(){return sr(this,v)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach((v=>v.dispose())),this}}class dr extends Ho{constructor(){super(Di(dr.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new cr({context:this.context,value:2});const v=Di(dr.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new lr({context:this.context,frequency:v.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new ir({context:this.context,detune:v.detune,frequency:v.frequency,onstop:()=>this.onstop(this),phase:v.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),Ui(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Ho.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(v){v=this.toSeconds(v),this._modulator.start(v),this._pulse.start(v)}_stop(v){v=this.toSeconds(v),this._modulator.stop(v),this._pulse.stop(v)}_restart(v){this._modulator.restart(v),this._pulse.restart(v)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(v){this._modulator.phase=v}asArray(v=1024){return yi(this,void 0,void 0,(function*(){return sr(this,v)}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const Uc={am:hr,fat:pr,fm:ur,oscillator:ir,pulse:lr,pwm:dr};class _r extends Ho{constructor(){super(Di(_r.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const v=Di(_r.getDefaults(),arguments,["frequency","type"]);this.frequency=new Do({context:this.context,units:"frequency",value:v.frequency}),this.detune=new Do({context:this.context,units:"cents",value:v.detune}),Ui(this,["frequency","detune"]),this.set(v)}static getDefaults(){return Object.assign(ir.getDefaults(),ur.getDefaults(),hr.getDefaults(),pr.getDefaults(),lr.getDefaults(),dr.getDefaults())}_start(v){this._oscillator.start(v)}_stop(v){this._oscillator.stop(v)}_restart(v){return this._oscillator.restart(v),this}get type(){let v="";return["am","fm","fat"].some((v=>this._sourceType===v))&&(v=this._sourceType),v+this._oscillator.type}set type(v){"fm"===v.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=v.substr(2)):"am"===v.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=v.substr(2)):"fat"===v.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=v.substr(3)):"pwm"===v?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===v?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=v)}get partials(){return this._oscillator.partials}set partials(v){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=v)}get partialCount(){return this._oscillator.partialCount}set partialCount(v){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=v)}set(v){return Reflect.has(v,"type")&&v.type&&(this.type=v.type),super.set(v),this}_createNewOscillator(v){if(v!==this._sourceType){this._sourceType=v;const M=Uc[v],I=this.now();if(this._oscillator){const v=this._oscillator;v.stop(I),this.context.setTimeout((()=>v.dispose()),this.blockTime)}this._oscillator=new M({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(I)}}get phase(){return this._oscillator.phase}set phase(v){this._oscillator.phase=v}get sourceType(){return this._sourceType}set sourceType(v){let M="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(M=this._oscillator.type),"fm"===v?this.type="fm"+M:"am"===v?this.type="am"+M:"fat"===v?this.type="fat"+M:"oscillator"===v?this.type=M:"pulse"===v?this.type="pulse":"pwm"===v&&(this.type="pwm")}_getOscType(v,M){return v instanceof Uc[M]}get baseType(){return this._oscillator.baseType}set baseType(v){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===v||"pwm"===v||(this._oscillator.baseType=v)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(v){this._getOscType(this._oscillator,"fat")&&ui(v)&&(this._oscillator.count=v)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(v){this._getOscType(this._oscillator,"fat")&&ui(v)&&(this._oscillator.spread=v)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(v){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&fi(v)&&(this._oscillator.modulationType=v)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(v=1024){return yi(this,void 0,void 0,(function*(){return sr(this,v)}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class mr extends Do{constructor(){super(Object.assign(Di(mr.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new ko({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,bo(this._constantSource,this._sum)}static getDefaults(){return Object.assign(Do.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class gr extends or{constructor(){super(Object.assign(Di(gr.getDefaults(),arguments,["min","max"]))),this.name="Scale";const v=Di(gr.getDefaults(),arguments,["min","max"]);this._mult=this.input=new cr({context:this.context,value:v.max-v.min}),this._add=this.output=new mr({context:this.context,value:v.min}),this._min=v.min,this._max=v.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(or.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(v){this._min=v,this._setRange()}get max(){return this._max}set max(v){this._max=v,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class vr extends or{constructor(){super(Object.assign(Di(vr.getDefaults(),arguments))),this.name="Zero",this._gain=new ko({context:this.context}),this.output=this._gain,this.input=void 0,To(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),So(this.context.getConstant(0),this._gain),this}}class yr extends wo{constructor(){super(Di(yr.getDefaults(),arguments,["frequency","min","max"])),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=xo.prototype._fromType,this._toType=xo.prototype._toType,this._is=xo.prototype._is,this._clampValue=xo.prototype._clampValue;const v=Di(yr.getDefaults(),arguments,["frequency","min","max"]);this._oscillator=new ir(v),this.frequency=this._oscillator.frequency,this._amplitudeGain=new ko({context:this.context,gain:v.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new Do({context:this.context,units:"audioRange",value:0}),this._zeros=new vr({context:this.context}),this._a2g=new ar({context:this.context}),this._scaler=this.output=new gr({context:this.context,max:v.max,min:v.min}),this.units=v.units,this.min=v.min,this.max=v.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),Ui(this,["amplitude","frequency"]),this.phase=v.phase}static getDefaults(){return Object.assign(ir.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(v){return v=this.toSeconds(v),this._stoppedSignal.setValueAtTime(0,v),this._oscillator.start(v),this}stop(v){return v=this.toSeconds(v),this._stoppedSignal.setValueAtTime(this._stoppedValue,v),this._oscillator.stop(v),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(v){v=this._fromType(v),this._scaler.min=v}get max(){return this._toType(this._scaler.max)}set max(v){v=this._fromType(v),this._scaler.max=v}get type(){return this._oscillator.type}set type(v){this._oscillator.type=v,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(v){this._oscillator.partials=v,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(v){this._oscillator.phase=v,this._setStoppedValue()}get units(){return this._units}set units(v){const M=this.min,I=this.max;this._units=v,this.min=M,this.max=I}get state(){return this._oscillator.state}connect(v,M,I){return(v instanceof xo||v instanceof Do)&&(this.convert=v.convert,this.units=v.units),Oo(this,v,M,I),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function xr(M,I=1/0){const V=new WeakMap;return function(N,j){Reflect.defineProperty(N,j,{configurable:!0,enumerable:!0,get:function(){return V.get(this||v)},set:function(N){ei(N,M,I),V.set(this||v,N)}})}}function wr(M,I=1/0){const V=new WeakMap;return function(N,j){Reflect.defineProperty(N,j,{configurable:!0,enumerable:!0,get:function(){return V.get(this||v)},set:function(N){ei(this.toSeconds(N),M,I),V.set(this||v,N)}})}}class br extends Ho{constructor(){super(Di(br.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const v=Di(br.getDefaults(),arguments,["url","onload"]);this._buffer=new Xi({onload:this._onload.bind(this,v.onload),onerror:v.onerror,reverse:v.reverse,url:v.url}),this.autostart=v.autostart,this._loop=v.loop,this._loopStart=v.loopStart,this._loopEnd=v.loopEnd,this._playbackRate=v.playbackRate,this.fadeIn=v.fadeIn,this.fadeOut=v.fadeOut}static getDefaults(){return Object.assign(Ho.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Zi,onerror:Zi,playbackRate:1,reverse:!1})}load(v){return yi(this,void 0,void 0,(function*(){return yield this._buffer.load(v),this._onload(),this}))}_onload(v=Zi){v(),this.autostart&&this.start()}_onSourceEnd(v){this.onstop(this),this._activeSources.delete(v),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(v,M,I){return super.start(v,M,I),this}_start(v,M,I){M=this._loop?Oi(M,this._loopStart):Oi(M,0);const V=this.toSeconds(M),N=I;I=Oi(I,Math.max(this._buffer.duration-V,0));let j=this.toSeconds(I);j/=this._playbackRate,v=this.toSeconds(v);const dt=new $o({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(v+j),this._state.setStateAtTime("stopped",v+j,{implicitEnd:!0})),this._activeSources.add(dt),this._loop&&ai(N)?dt.start(v,V):dt.start(v,V,j-this.toSeconds(this.fadeOut))}_stop(v){const M=this.toSeconds(v);this._activeSources.forEach((v=>v.stop(M)))}restart(v,M,I){return super.restart(v,M,I),this}_restart(v,M,I){this._stop(v),this._start(v,M,I)}seek(v,M){const I=this.toSeconds(M);if("started"===this._state.getValueAtTime(I)){const M=this.toSeconds(v);this._stop(I),this._start(I,M)}return this}setLoopPoints(v,M){return this.loopStart=v,this.loopEnd=M,this}get loopStart(){return this._loopStart}set loopStart(v){this._loopStart=v,this.buffer.loaded&&ei(this.toSeconds(v),0,this.buffer.duration),this._activeSources.forEach((M=>{M.loopStart=v}))}get loopEnd(){return this._loopEnd}set loopEnd(v){this._loopEnd=v,this.buffer.loaded&&ei(this.toSeconds(v),0,this.buffer.duration),this._activeSources.forEach((M=>{M.loopEnd=v}))}get buffer(){return this._buffer}set buffer(v){this._buffer.set(v)}get loop(){return this._loop}set loop(v){if(this._loop!==v&&(this._loop=v,this._activeSources.forEach((M=>{M.loop=v})),v)){const v=this._state.getNextState("stopped",this.now());v&&this._state.cancel(v.time)}}get playbackRate(){return this._playbackRate}set playbackRate(v){this._playbackRate=v;const M=this.now(),I=this._state.getNextState("stopped",M);I&&I.implicitEnd&&(this._state.cancel(I.time),this._activeSources.forEach((v=>v.cancelStop()))),this._activeSources.forEach((I=>{I.playbackRate.setValueAtTime(v,M)}))}get reverse(){return this._buffer.reverse}set reverse(v){this._buffer.reverse=v}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach((v=>v.dispose())),this._activeSources.clear(),this._buffer.dispose(),this}}vi([wr(0)],br.prototype,"fadeIn",void 0),vi([wr(0)],br.prototype,"fadeOut",void 0);class Tr extends wo{constructor(){super(Di(Tr.getDefaults(),arguments,["urls","onload"],"urls")),this.name="Players",this.input=void 0,this._players=new Map;const v=Di(Tr.getDefaults(),arguments,["urls","onload"],"urls");this._volume=this.output=new Go({context:this.context,volume:v.volume}),this.volume=this._volume.volume,Ui(this,"volume"),this._buffers=new Vo({urls:v.urls,onload:v.onload,baseUrl:v.baseUrl,onerror:v.onerror}),this.mute=v.mute,this._fadeIn=v.fadeIn,this._fadeOut=v.fadeOut}static getDefaults(){return Object.assign(Ho.getDefaults(),{baseUrl:"",fadeIn:0,fadeOut:0,mute:!1,onload:Zi,onerror:Zi,urls:{},volume:0})}get mute(){return this._volume.mute}set mute(v){this._volume.mute=v}get fadeIn(){return this._fadeIn}set fadeIn(v){this._fadeIn=v,this._players.forEach((M=>{M.fadeIn=v}))}get fadeOut(){return this._fadeOut}set fadeOut(v){this._fadeOut=v,this._players.forEach((M=>{M.fadeOut=v}))}get state(){return Array.from(this._players).some((([v,M])=>"started"===M.state))?"started":"stopped"}has(v){return this._buffers.has(v)}player(v){if(ti(this.has(v),`No Player with the name ${v} exists on this object`),!this._players.has(v)){const M=new br({context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,url:this._buffers.get(v)}).connect(this.output);this._players.set(v,M)}return this._players.get(v)}get loaded(){return this._buffers.loaded}add(v,M,I){return ti(!this._buffers.has(v),"A buffer with that name already exists on this object"),this._buffers.add(v,M,I),this}stopAll(v){return this._players.forEach((M=>M.stop(v))),this}dispose(){return super.dispose(),this._volume.dispose(),this.volume.dispose(),this._players.forEach((v=>v.dispose())),this._buffers.dispose(),this}}class Sr extends Ho{constructor(){super(Di(Sr.getDefaults(),arguments,["url","onload"])),this.name="GrainPlayer",this._loopStart=0,this._loopEnd=0,this._activeSources=[];const v=Di(Sr.getDefaults(),arguments,["url","onload"]);this.buffer=new Xi({onload:v.onload,onerror:v.onerror,reverse:v.reverse,url:v.url}),this._clock=new qo({context:this.context,callback:this._tick.bind(this),frequency:1/v.grainSize}),this._playbackRate=v.playbackRate,this._grainSize=v.grainSize,this._overlap=v.overlap,this.detune=v.detune,this.overlap=v.overlap,this.loop=v.loop,this.playbackRate=v.playbackRate,this.grainSize=v.grainSize,this.loopStart=v.loopStart,this.loopEnd=v.loopEnd,this.reverse=v.reverse,this._clock.on("stop",this._onstop.bind(this))}static getDefaults(){return Object.assign(Ho.getDefaults(),{onload:Zi,onerror:Zi,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1})}_start(v,M,I){M=Oi(M,0),M=this.toSeconds(M),v=this.toSeconds(v);const V=1/this._clock.frequency.getValueAtTime(v);this._clock.start(v,M/V),I&&this.stop(v+this.toSeconds(I))}restart(v,M,I){return super.restart(v,M,I),this}_restart(v,M,I){this._stop(v),this._start(v,M,I)}_stop(v){this._clock.stop(v)}_onstop(v){this._activeSources.forEach((M=>{M.fadeOut=0,M.stop(v)})),this.onstop(this)}_tick(v){const M=this._clock.getTicksAtTime(v),I=M*this._grainSize;if(this.log("offset",I),!this.loop&&I>this.buffer.duration)return void this.stop(v);const V=I<this._overlap?0:this._overlap,N=new $o({context:this.context,url:this.buffer,fadeIn:V,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:no(this.detune/100)}).connect(this.output);N.start(v,this._grainSize*M),N.stop(v+this._grainSize/this.playbackRate),this._activeSources.push(N),N.onended=()=>{const v=this._activeSources.indexOf(N);-1!==v&&this._activeSources.splice(v,1)}}get playbackRate(){return this._playbackRate}set playbackRate(v){ei(v,.001),this._playbackRate=v,this.grainSize=this._grainSize}get loopStart(){return this._loopStart}set loopStart(v){this.buffer.loaded&&ei(this.toSeconds(v),0,this.buffer.duration),this._loopStart=this.toSeconds(v)}get loopEnd(){return this._loopEnd}set loopEnd(v){this.buffer.loaded&&ei(this.toSeconds(v),0,this.buffer.duration),this._loopEnd=this.toSeconds(v)}get reverse(){return this.buffer.reverse}set reverse(v){this.buffer.reverse=v}get grainSize(){return this._grainSize}set grainSize(v){this._grainSize=this.toSeconds(v),this._clock.frequency.setValueAtTime(this._playbackRate/this._grainSize,this.now())}get overlap(){return this._overlap}set overlap(v){const M=this.toSeconds(v);ei(M,0),this._overlap=M}get loaded(){return this.buffer.loaded}dispose(){return super.dispose(),this.buffer.dispose(),this._clock.dispose(),this._activeSources.forEach((v=>v.dispose())),this}}class kr extends or{constructor(){super(...arguments),this.name="Abs",this._abs=new rr({context:this.context,mapping:v=>Math.abs(v)<.001?0:Math.abs(v)}),this.input=this._abs,this.output=this._abs}dispose(){return super.dispose(),this._abs.dispose(),this}}class Cr extends or{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new rr({context:this.context,mapping:v=>2*Math.abs(v)-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Ar extends or{constructor(){super(...arguments),this.name="Negate",this._multiply=new cr({context:this.context,value:-1}),this.input=this._multiply,this.output=this._multiply}dispose(){return super.dispose(),this._multiply.dispose(),this}}class Dr extends Do{constructor(){super(Object.assign(Di(Dr.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Subtract",this._sum=new ko({context:this.context}),this.input=this._sum,this.output=this._sum,this._neg=new Ar({context:this.context}),this.subtrahend=this._param,bo(this._constantSource,this._neg,this._sum)}static getDefaults(){return Object.assign(Do.getDefaults(),{value:0})}dispose(){return super.dispose(),this._neg.dispose(),this._sum.dispose(),this}}class Or extends or{constructor(){super(Object.assign(Di(Or.getDefaults(),arguments))),this.name="GreaterThanZero",this._thresh=this.output=new rr({context:this.context,length:127,mapping:v=>v<=0?0:1}),this._scale=this.input=new cr({context:this.context,value:1e4}),this._scale.connect(this._thresh)}dispose(){return super.dispose(),this._scale.dispose(),this._thresh.dispose(),this}}class Mr extends Do{constructor(){super(Object.assign(Di(Mr.getDefaults(),arguments,["value"]))),this.name="GreaterThan",this.override=!1;const v=Di(Mr.getDefaults(),arguments,["value"]);this._subtract=this.input=new Dr({context:this.context,value:v.value}),this._gtz=this.output=new Or({context:this.context}),this.comparator=this._param=this._subtract.subtrahend,Ui(this,"comparator"),this._subtract.connect(this._gtz)}static getDefaults(){return Object.assign(Do.getDefaults(),{value:0})}dispose(){return super.dispose(),this._gtz.dispose(),this._subtract.dispose(),this.comparator.dispose(),this}}class Er extends or{constructor(){super(Object.assign(Di(Er.getDefaults(),arguments,["value"]))),this.name="Pow";const v=Di(Er.getDefaults(),arguments,["value"]);this._exponentScaler=this.input=this.output=new rr({context:this.context,mapping:this._expFunc(v.value),length:8192}),this._exponent=v.value}static getDefaults(){return Object.assign(or.getDefaults(),{value:1})}_expFunc(v){return M=>Math.pow(Math.abs(M),v)}get value(){return this._exponent}set value(v){this._exponent=v,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class Rr extends gr{constructor(){super(Object.assign(Di(Rr.getDefaults(),arguments,["min","max","exponent"]))),this.name="ScaleExp";const v=Di(Rr.getDefaults(),arguments,["min","max","exponent"]);this.input=this._exp=new Er({context:this.context,value:v.exponent}),this._exp.connect(this._mult)}static getDefaults(){return Object.assign(gr.getDefaults(),{exponent:1})}get exponent(){return this._exp.value}set exponent(v){this._exp.value=v}dispose(){return super.dispose(),this._exp.dispose(),this}}class qr extends Do{constructor(){super(Di(Do.getDefaults(),arguments,["value","units"])),this.name="SyncedSignal",this.override=!1;const v=Di(Do.getDefaults(),arguments,["value","units"]);this._lastVal=v.value,this._synced=this.context.transport.scheduleRepeat(this._onTick.bind(this),"1i"),this._syncedCallback=this._anchorValue.bind(this),this.context.transport.on("start",this._syncedCallback),this.context.transport.on("pause",this._syncedCallback),this.context.transport.on("stop",this._syncedCallback),this._constantSource.disconnect(),this._constantSource.stop(0),this._constantSource=this.output=new Ao({context:this.context,offset:v.value,units:v.units}).start(0),this.setValueAtTime(v.value,0)}_onTick(v){const M=super.getValueAtTime(this.context.transport.seconds);this._lastVal!==M&&(this._lastVal=M,this._constantSource.offset.setValueAtTime(M,v))}_anchorValue(v){const M=super.getValueAtTime(this.context.transport.seconds);this._lastVal=M,this._constantSource.offset.cancelAndHoldAtTime(v),this._constantSource.offset.setValueAtTime(M,v)}getValueAtTime(v){const M=new mo(this.context,v).toSeconds();return super.getValueAtTime(M)}setValueAtTime(v,M){const I=new mo(this.context,M).toSeconds();return super.setValueAtTime(v,I),this}linearRampToValueAtTime(v,M){const I=new mo(this.context,M).toSeconds();return super.linearRampToValueAtTime(v,I),this}exponentialRampToValueAtTime(v,M){const I=new mo(this.context,M).toSeconds();return super.exponentialRampToValueAtTime(v,I),this}setTargetAtTime(v,M,I){const V=new mo(this.context,M).toSeconds();return super.setTargetAtTime(v,V,I),this}cancelScheduledValues(v){const M=new mo(this.context,v).toSeconds();return super.cancelScheduledValues(M),this}setValueCurveAtTime(v,M,I,V){const N=new mo(this.context,M).toSeconds();return I=this.toSeconds(I),super.setValueCurveAtTime(v,N,I,V),this}cancelAndHoldAtTime(v){const M=new mo(this.context,v).toSeconds();return super.cancelAndHoldAtTime(M),this}setRampPoint(v){const M=new mo(this.context,v).toSeconds();return super.setRampPoint(M),this}exponentialRampTo(v,M,I){const V=new mo(this.context,I).toSeconds();return super.exponentialRampTo(v,M,V),this}linearRampTo(v,M,I){const V=new mo(this.context,I).toSeconds();return super.linearRampTo(v,M,V),this}targetRampTo(v,M,I){const V=new mo(this.context,I).toSeconds();return super.targetRampTo(v,M,V),this}dispose(){return super.dispose(),this.context.transport.clear(this._synced),this.context.transport.off("start",this._syncedCallback),this.context.transport.off("pause",this._syncedCallback),this.context.transport.off("stop",this._syncedCallback),this._constantSource.dispose(),this}}class Fr extends wo{constructor(){super(Di(Fr.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new Do({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const v=Di(Fr.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=v.attack,this.decay=v.decay,this.sustain=v.sustain,this.release=v.release,this.attackCurve=v.attackCurve,this.releaseCurve=v.releaseCurve,this.decayCurve=v.decayCurve}static getDefaults(){return Object.assign(wo.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(v,M){if(fi(v))return v;{let I;for(I in Gc)if(Gc[I][M]===v)return I;return v}}_setCurve(v,M,I){if(fi(I)&&Reflect.has(Gc,I)){const V=Gc[I];li(V)?"_decayCurve"!==v&&(this[v]=V[M]):this[v]=V}else{if(!di(I)||"_decayCurve"===v)throw new Error("Envelope: invalid curve: "+I);this[v]=I}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(v){this._setCurve("_attackCurve","In",v)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(v){this._setCurve("_releaseCurve","Out",v)}get decayCurve(){return this._decayCurve}set decayCurve(v){ti(["linear","exponential"].some((M=>M===v)),"Invalid envelope curve: "+v),this._decayCurve=v}triggerAttack(v,M=1){this.log("triggerAttack",v,M),v=this.toSeconds(v);let I=this.toSeconds(this.attack);const V=this.toSeconds(this.decay),N=this.getValueAtTime(v);N>0&&(I=(1-N)/(1/I));if(I<this.sampleTime)this._sig.cancelScheduledValues(v),this._sig.setValueAtTime(M,v);else if("linear"===this._attackCurve)this._sig.linearRampTo(M,I,v);else if("exponential"===this._attackCurve)this._sig.targetRampTo(M,I,v);else{this._sig.cancelAndHoldAtTime(v);let V=this._attackCurve;for(let v=1;v<V.length;v++)if(V[v-1]<=N&&N<=V[v]){V=this._attackCurve.slice(v),V[0]=N;break}this._sig.setValueCurveAtTime(V,v,I,M)}if(V&&this.sustain<1){const N=M*this.sustain,j=v+I;this.log("decay",j),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(N,V+j):this._sig.exponentialApproachValueAtTime(N,j,V)}return this}triggerRelease(v){this.log("triggerRelease",v),v=this.toSeconds(v);const M=this.getValueAtTime(v);if(M>0){const I=this.toSeconds(this.release);I<this.sampleTime?this._sig.setValueAtTime(0,v):"linear"===this._releaseCurve?this._sig.linearRampTo(0,I,v):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,I,v):(ti(di(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(v),this._sig.setValueCurveAtTime(this._releaseCurve,v,I,M))}return this}getValueAtTime(v){return this._sig.getValueAtTime(v)}triggerAttackRelease(v,M,I=1){return M=this.toSeconds(M),this.triggerAttack(M,I),this.triggerRelease(M+this.toSeconds(v)),this}cancel(v){return this._sig.cancelScheduledValues(this.toSeconds(v)),this}connect(v,M=0,I=0){return Oo(this,v,M,I),this}asArray(v=1024){return yi(this,void 0,void 0,(function*(){const M=v/this.context.sampleRate,I=new Yi(1,M,this.context.sampleRate),V=this.toSeconds(this.attack)+this.toSeconds(this.decay),N=V+this.toSeconds(this.release),j=.1*N,dt=N+j,vt=new this.constructor(Object.assign(this.get(),{attack:M*this.toSeconds(this.attack)/dt,decay:M*this.toSeconds(this.decay)/dt,release:M*this.toSeconds(this.release)/dt,context:I}));vt._sig.toDestination(),vt.triggerAttackRelease(M*(V+j)/dt,0);return(yield I.render()).getChannelData(0)}))}dispose(){return super.dispose(),this._sig.dispose(),this}}vi([wr(0)],Fr.prototype,"attack",void 0),vi([wr(0)],Fr.prototype,"decay",void 0),vi([xr(0,1)],Fr.prototype,"sustain",void 0),vi([wr(0)],Fr.prototype,"release",void 0);const Gc=(()=>{let v,M;const I=[];for(v=0;v<128;v++)I[v]=Math.sin(v/127*(Math.PI/2));const V=[];for(v=0;v<127;v++){M=v/127;const I=Math.sin(M*(2*Math.PI)*6.4-Math.PI/2)+1;V[v]=I/10+.83*M}V[127]=1;const N=[];for(v=0;v<128;v++)N[v]=Math.ceil(v/127*5)/5;const j=[];for(v=0;v<128;v++)M=v/127,j[v]=.5*(1-Math.cos(Math.PI*M));const dt=[];for(v=0;v<128;v++){M=v/127;const I=4*Math.pow(M,3)+.2,V=Math.cos(I*Math.PI*2*M);dt[v]=Math.abs(V*(1-M))}function a(v){const M=new Array(v.length);for(let I=0;I<v.length;I++)M[I]=1-v[I];return M}return{bounce:{In:a(dt),Out:dt},cosine:{In:I,Out:(vt=I,vt.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:V,Out:a(V)},sine:{In:j,Out:a(j)},step:{In:N,Out:a(N)}};var vt})();class Vr extends wo{constructor(){super(Di(Vr.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const v=Di(Vr.getDefaults(),arguments);this._volume=this.output=new Go({context:this.context,volume:v.volume}),this.volume=this._volume.volume,Ui(this,"volume")}static getDefaults(){return Object.assign(wo.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let v=!1;return this._synced||(this._synced=!0,v=!0),v}_syncMethod(v,M){const I=this["_original_"+v]=this[v];this[v]=(...v)=>{const V=v[M],N=this.context.transport.schedule((V=>{v[M]=V,I.apply(this,v)}),V);this._scheduledEvents.push(N)}}unsync(){return this._scheduledEvents.forEach((v=>this.context.transport.clear(v))),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(v,M,I,V){const N=this.toSeconds(I),j=this.toSeconds(M);return this.triggerAttack(v,N,V),this.triggerRelease(N+j),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Nr extends Vr{constructor(){super(Di(Nr.getDefaults(),arguments));const v=Di(Nr.getDefaults(),arguments);this.portamento=v.portamento,this.onsilence=v.onsilence}static getDefaults(){return Object.assign(Vr.getDefaults(),{detune:0,onsilence:Zi,portamento:0})}triggerAttack(v,M,I=1){this.log("triggerAttack",v,M,I);const V=this.toSeconds(M);return this._triggerEnvelopeAttack(V,I),this.setNote(v,V),this}triggerRelease(v){this.log("triggerRelease",v);const M=this.toSeconds(v);return this._triggerEnvelopeRelease(M),this}setNote(v,M){const I=this.toSeconds(M),V=v instanceof lo?v.toFrequency():v;if(this.portamento>0&&this.getLevelAtTime(I)>.05){const v=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(V,v,I)}else this.frequency.setValueAtTime(V,I);return this}}vi([wr(0)],Nr.prototype,"portamento",void 0);class Pr extends Fr{constructor(){super(Di(Pr.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new ko({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class jr extends Nr{constructor(){super(Di(jr.getDefaults(),arguments)),this.name="Synth";const v=Di(jr.getDefaults(),arguments);this.oscillator=new _r(Object.assign({context:this.context,detune:v.detune,onstop:()=>this.onsilence(this)},v.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new Pr(Object.assign({context:this.context},v.envelope)),this.oscillator.chain(this.envelope,this.output),Ui(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Nr.getDefaults(),{envelope:Object.assign(Mi(Fr.getDefaults(),Object.keys(wo.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(Mi(_r.getDefaults(),[...Object.keys(Ho.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(v,M){if(this.envelope.triggerAttack(v,M),this.oscillator.start(v),0===this.envelope.sustain){const M=this.toSeconds(this.envelope.attack),I=this.toSeconds(this.envelope.decay);this.oscillator.stop(v+M+I)}}_triggerEnvelopeRelease(v){this.envelope.triggerRelease(v),this.oscillator.stop(v+this.toSeconds(this.envelope.release))}getLevelAtTime(v){return v=this.toSeconds(v),this.envelope.getValueAtTime(v)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Lr extends Nr{constructor(){super(Di(Lr.getDefaults(),arguments)),this.name="ModulationSynth";const v=Di(Lr.getDefaults(),arguments);this._carrier=new jr({context:this.context,oscillator:v.oscillator,envelope:v.envelope,onsilence:()=>this.onsilence(this),volume:-10}),this._modulator=new jr({context:this.context,oscillator:v.modulation,envelope:v.modulationEnvelope,volume:-10}),this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope,this.modulation=this._modulator.oscillator,this.modulationEnvelope=this._modulator.envelope,this.frequency=new Do({context:this.context,units:"frequency"}),this.detune=new Do({context:this.context,value:v.detune,units:"cents"}),this.harmonicity=new cr({context:this.context,value:v.harmonicity,minValue:0}),this._modulationNode=new ko({context:this.context,gain:0}),Ui(this,["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])}static getDefaults(){return Object.assign(Nr.getDefaults(),{harmonicity:3,oscillator:Object.assign(Mi(_r.getDefaults(),[...Object.keys(Ho.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope:Object.assign(Mi(Fr.getDefaults(),Object.keys(wo.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(Mi(_r.getDefaults(),[...Object.keys(Ho.getDefaults()),"frequency","detune"]),{type:"square"}),modulationEnvelope:Object.assign(Mi(Fr.getDefaults(),Object.keys(wo.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}_triggerEnvelopeAttack(v,M){this._carrier._triggerEnvelopeAttack(v,M),this._modulator._triggerEnvelopeAttack(v,M)}_triggerEnvelopeRelease(v){return this._carrier._triggerEnvelopeRelease(v),this._modulator._triggerEnvelopeRelease(v),this}getLevelAtTime(v){return v=this.toSeconds(v),this.envelope.getValueAtTime(v)}dispose(){return super.dispose(),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}}class zr extends Lr{constructor(){super(Di(zr.getDefaults(),arguments)),this.name="AMSynth",this._modulationScale=new ar({context:this.context}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output)}dispose(){return super.dispose(),this._modulationScale.dispose(),this}}class Br extends wo{constructor(){super(Di(Br.getDefaults(),arguments,["frequency","type"])),this.name="BiquadFilter";const v=Di(Br.getDefaults(),arguments,["frequency","type"]);this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new xo({context:this.context,units:"number",value:v.Q,param:this._filter.Q}),this.frequency=new xo({context:this.context,units:"frequency",value:v.frequency,param:this._filter.frequency}),this.detune=new xo({context:this.context,units:"cents",value:v.detune,param:this._filter.detune}),this.gain=new xo({context:this.context,units:"decibels",convert:!1,value:v.gain,param:this._filter.gain}),this.type=v.type}static getDefaults(){return Object.assign(wo.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(v){ti(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(v),"Invalid filter type: "+v),this._filter.type=v}getFrequencyResponse(v=128){const M=new Float32Array(v);for(let I=0;I<v;I++){const V=19980*Math.pow(I/v,2)+20;M[I]=V}const I=new Float32Array(v),V=new Float32Array(v),N=this.context.createBiquadFilter();return N.type=this.type,N.Q.value=this.Q.value,N.frequency.value=this.frequency.value,N.gain.value=this.gain.value,N.getFrequencyResponse(M,I,V),I}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class Wr extends wo{constructor(){super(Di(Wr.getDefaults(),arguments,["frequency","type","rolloff"])),this.name="Filter",this.input=new ko({context:this.context}),this.output=new ko({context:this.context}),this._filters=[];const v=Di(Wr.getDefaults(),arguments,["frequency","type","rolloff"]);this._filters=[],this.Q=new Do({context:this.context,units:"positive",value:v.Q}),this.frequency=new Do({context:this.context,units:"frequency",value:v.frequency}),this.detune=new Do({context:this.context,units:"cents",value:v.detune}),this.gain=new Do({context:this.context,units:"decibels",convert:!1,value:v.gain}),this._type=v.type,this.rolloff=v.rolloff,Ui(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(wo.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(v){ti(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(v),"Invalid filter type: "+v),this._type=v,this._filters.forEach((M=>M.type=v))}get rolloff(){return this._rolloff}set rolloff(v){const M=ui(v)?v:parseInt(v,10),I=[-12,-24,-48,-96];let V=I.indexOf(M);ti(-1!==V,"rolloff can only be "+I.join(", ")),V+=1,this._rolloff=M,this.input.disconnect(),this._filters.forEach((v=>v.disconnect())),this._filters=new Array(V);for(let v=0;v<V;v++){const M=new Br({context:this.context});M.type=this._type,this.frequency.connect(M.frequency),this.detune.connect(M.detune),this.Q.connect(M.Q),this.gain.connect(M.gain),this._filters[v]=M}this._internalChannels=this._filters,bo(this.input,...this._internalChannels,this.output)}getFrequencyResponse(v=128){const M=new Br({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),I=new Float32Array(v).map((()=>1));return this._filters.forEach((()=>{M.getFrequencyResponse(v).forEach(((v,M)=>I[M]*=v))})),M.dispose(),I}dispose(){return super.dispose(),this._filters.forEach((v=>{v.dispose()})),Qi(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class Gr extends Fr{constructor(){super(Di(Gr.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="FrequencyEnvelope";const v=Di(Gr.getDefaults(),arguments,["attack","decay","sustain","release"]);this._octaves=v.octaves,this._baseFrequency=this.toFrequency(v.baseFrequency),this._exponent=this.input=new Er({context:this.context,value:v.exponent}),this._scale=this.output=new gr({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(Fr.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(v){const M=this.toFrequency(v);ei(M,0),this._baseFrequency=M,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(v){this._octaves=v,this._scale.max=this._baseFrequency*Math.pow(2,v)}get exponent(){return this._exponent.value}set exponent(v){this._exponent.value=v}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}}class Ur extends Nr{constructor(){super(Di(Ur.getDefaults(),arguments)),this.name="MonoSynth";const v=Di(Ur.getDefaults(),arguments);this.oscillator=new _r(Object.assign(v.oscillator,{context:this.context,detune:v.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new Wr(Object.assign(v.filter,{context:this.context})),this.filterEnvelope=new Gr(Object.assign(v.filterEnvelope,{context:this.context})),this.envelope=new Pr(Object.assign(v.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),Ui(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(Nr.getDefaults(),{envelope:Object.assign(Mi(Fr.getDefaults(),Object.keys(wo.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(Mi(Wr.getDefaults(),Object.keys(wo.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(Mi(Gr.getDefaults(),Object.keys(wo.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(Mi(_r.getDefaults(),Object.keys(Ho.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(v,M=1){if(this.envelope.triggerAttack(v,M),this.filterEnvelope.triggerAttack(v),this.oscillator.start(v),0===this.envelope.sustain){const M=this.toSeconds(this.envelope.attack),I=this.toSeconds(this.envelope.decay);this.oscillator.stop(v+M+I)}}_triggerEnvelopeRelease(v){this.envelope.triggerRelease(v),this.filterEnvelope.triggerRelease(v),this.oscillator.stop(v+this.toSeconds(this.envelope.release))}getLevelAtTime(v){return v=this.toSeconds(v),this.envelope.getValueAtTime(v)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}class Qr extends Nr{constructor(){super(Di(Qr.getDefaults(),arguments)),this.name="DuoSynth";const v=Di(Qr.getDefaults(),arguments);this.voice0=new Ur(Object.assign(v.voice0,{context:this.context,onsilence:()=>this.onsilence(this)})),this.voice1=new Ur(Object.assign(v.voice1,{context:this.context})),this.harmonicity=new cr({context:this.context,units:"positive",value:v.harmonicity}),this._vibrato=new yr({frequency:v.vibratoRate,context:this.context,min:-50,max:50}),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=new ko({context:this.context,units:"normalRange",gain:v.vibratoAmount}),this.vibratoAmount=this._vibratoGain.gain,this.frequency=new Do({context:this.context,units:"frequency",value:440}),this.detune=new Do({context:this.context,units:"cents",value:v.detune}),this.frequency.connect(this.voice0.frequency),this.frequency.chain(this.harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.detune.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output),Ui(this,["voice0","voice1","frequency","vibratoAmount","vibratoRate"])}getLevelAtTime(v){return v=this.toSeconds(v),this.voice0.envelope.getValueAtTime(v)+this.voice1.envelope.getValueAtTime(v)}static getDefaults(){return Ai(Nr.getDefaults(),{vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:Ai(Mi(Ur.getDefaults(),Object.keys(Nr.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}),voice1:Ai(Mi(Ur.getDefaults(),Object.keys(Nr.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}})})}_triggerEnvelopeAttack(v,M){this.voice0._triggerEnvelopeAttack(v,M),this.voice1._triggerEnvelopeAttack(v,M)}_triggerEnvelopeRelease(v){return this.voice0._triggerEnvelopeRelease(v),this.voice1._triggerEnvelopeRelease(v),this}dispose(){return super.dispose(),this.voice0.dispose(),this.voice1.dispose(),this.frequency.dispose(),this.detune.dispose(),this._vibrato.dispose(),this.vibratoRate.dispose(),this._vibratoGain.dispose(),this.harmonicity.dispose(),this}}class Zr extends Lr{constructor(){super(Di(Zr.getDefaults(),arguments)),this.name="FMSynth";const v=Di(Zr.getDefaults(),arguments);this.modulationIndex=new cr({context:this.context,value:v.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output)}static getDefaults(){return Object.assign(Lr.getDefaults(),{modulationIndex:10})}dispose(){return super.dispose(),this.modulationIndex.dispose(),this}}const Xc=[1,1.483,1.932,2.546,2.63,3.897];class Yr extends Nr{constructor(){super(Di(Yr.getDefaults(),arguments)),this.name="MetalSynth",this._oscillators=[],this._freqMultipliers=[];const v=Di(Yr.getDefaults(),arguments);this.detune=new Do({context:this.context,units:"cents",value:v.detune}),this.frequency=new Do({context:this.context,units:"frequency"}),this._amplitude=new ko({context:this.context,gain:0}).connect(this.output),this._highpass=new Wr({Q:0,context:this.context,type:"highpass"}).connect(this._amplitude);for(let M=0;M<Xc.length;M++){const I=new ur({context:this.context,harmonicity:v.harmonicity,modulationIndex:v.modulationIndex,modulationType:"square",onstop:0===M?()=>this.onsilence(this):Zi,type:"square"});I.connect(this._highpass),this._oscillators[M]=I;const V=new cr({context:this.context,value:Xc[M]});this._freqMultipliers[M]=V,this.frequency.chain(V,I.frequency),this.detune.connect(I.detune)}this._filterFreqScaler=new gr({context:this.context,max:7e3,min:this.toFrequency(v.resonance)}),this.envelope=new Fr({attack:v.envelope.attack,attackCurve:"linear",context:this.context,decay:v.envelope.decay,release:v.envelope.release,sustain:0}),this.envelope.chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitude.gain),this._octaves=v.octaves,this.octaves=v.octaves}static getDefaults(){return Ai(Nr.getDefaults(),{envelope:Object.assign(Mi(Fr.getDefaults(),Object.keys(wo.getDefaults())),{attack:.001,decay:1.4,release:.2}),harmonicity:5.1,modulationIndex:32,octaves:1.5,resonance:4e3})}_triggerEnvelopeAttack(v,M=1){return this.envelope.triggerAttack(v,M),this._oscillators.forEach((M=>M.start(v))),0===this.envelope.sustain&&this._oscillators.forEach((M=>{M.stop(v+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay))})),this}_triggerEnvelopeRelease(v){return this.envelope.triggerRelease(v),this._oscillators.forEach((M=>M.stop(v+this.toSeconds(this.envelope.release)))),this}getLevelAtTime(v){return v=this.toSeconds(v),this.envelope.getValueAtTime(v)}get modulationIndex(){return this._oscillators[0].modulationIndex.value}set modulationIndex(v){this._oscillators.forEach((M=>M.modulationIndex.value=v))}get harmonicity(){return this._oscillators[0].harmonicity.value}set harmonicity(v){this._oscillators.forEach((M=>M.harmonicity.value=v))}get resonance(){return this._filterFreqScaler.min}set resonance(v){this._filterFreqScaler.min=this.toFrequency(v),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(v){this._octaves=v,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,v)}dispose(){return super.dispose(),this._oscillators.forEach((v=>v.dispose())),this._freqMultipliers.forEach((v=>v.dispose())),this.frequency.dispose(),this.detune.dispose(),this._filterFreqScaler.dispose(),this._amplitude.dispose(),this.envelope.dispose(),this._highpass.dispose(),this}}class Hr extends jr{constructor(){super(Di(Hr.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const v=Di(Hr.getDefaults(),arguments);this.pitchDecay=v.pitchDecay,this.octaves=v.octaves,Ui(this,["oscillator","envelope"])}static getDefaults(){return Ai(Nr.getDefaults(),jr.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(v,M){const I=this.toSeconds(M),V=this.toFrequency(v instanceof lo?v.toFrequency():v),N=V*this.octaves;return this.oscillator.frequency.setValueAtTime(N,I),this.oscillator.frequency.exponentialRampToValueAtTime(V,I+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}vi([xr(0)],Hr.prototype,"octaves",void 0),vi([wr(0)],Hr.prototype,"pitchDecay",void 0);class $r extends Vr{constructor(){super(Di($r.getDefaults(),arguments)),this.name="NoiseSynth";const v=Di($r.getDefaults(),arguments);this.noise=new Jo(Object.assign({context:this.context},v.noise)),this.envelope=new Pr(Object.assign({context:this.context},v.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(Vr.getDefaults(),{envelope:Object.assign(Mi(Fr.getDefaults(),Object.keys(wo.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(Mi(Jo.getDefaults(),Object.keys(Ho.getDefaults())),{type:"white"})})}triggerAttack(v,M=1){return v=this.toSeconds(v),this.envelope.triggerAttack(v,M),this.noise.start(v),0===this.envelope.sustain&&this.noise.stop(v+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(v){return v=this.toSeconds(v),this.envelope.triggerRelease(v),this.noise.stop(v+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(v,M,I=1){return M=this.toSeconds(M),v=this.toSeconds(v),this.triggerAttack(M,I),this.triggerRelease(M+v),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}const Yc=new Set;function Kr(v){Yc.add(v)}function ta(v,M){const I=`registerProcessor("${v}", ${M})`;Yc.add(I)}class ea extends wo{constructor(v){super(v),this.name="ToneAudioWorklet",this.workletOptions={},this.onprocessorerror=Zi;const M=URL.createObjectURL(new Blob([Array.from(Yc).join("\n")],{type:"text/javascript"})),I=this._audioWorkletName();this._dummyGain=this.context.createGain(),this._dummyParam=this._dummyGain.gain,this.context.addAudioWorkletModule(M,I).then((()=>{this.disposed||(this._worklet=this.context.createAudioWorkletNode(I,this.workletOptions),this._worklet.onprocessorerror=this.onprocessorerror.bind(this),this.onReady(this._worklet))}))}dispose(){return super.dispose(),this._dummyGain.disconnect(),this._worklet&&(this._worklet.port.postMessage("dispose"),this._worklet.disconnect()),this}}Kr('\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n');Kr("\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n");Kr("\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n");ta("feedback-comb-filter",'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n');class sa extends ea{constructor(){super(Di(sa.getDefaults(),arguments,["delayTime","resonance"])),this.name="FeedbackCombFilter";const v=Di(sa.getDefaults(),arguments,["delayTime","resonance"]);this.input=new ko({context:this.context}),this.output=new ko({context:this.context}),this.delayTime=new xo({context:this.context,value:v.delayTime,units:"time",minValue:0,maxValue:1,param:this._dummyParam,swappable:!0}),this.resonance=new xo({context:this.context,value:v.resonance,units:"normalRange",param:this._dummyParam,swappable:!0}),Ui(this,["resonance","delayTime"])}_audioWorkletName(){return"feedback-comb-filter"}static getDefaults(){return Object.assign(wo.getDefaults(),{delayTime:.1,resonance:.5})}onReady(v){bo(this.input,v,this.output);const M=v.parameters.get("delayTime");this.delayTime.setParam(M);const I=v.parameters.get("feedback");this.resonance.setParam(I)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.delayTime.dispose(),this.resonance.dispose(),this}}class na extends wo{constructor(){super(Di(na.getDefaults(),arguments,["frequency","type"])),this.name="OnePoleFilter";const v=Di(na.getDefaults(),arguments,["frequency","type"]);this._frequency=v.frequency,this._type=v.type,this.input=new ko({context:this.context}),this.output=new ko({context:this.context}),this._createFilter()}static getDefaults(){return Object.assign(wo.getDefaults(),{frequency:880,type:"lowpass"})}_createFilter(){const v=this._filter,M=this.toFrequency(this._frequency),I=1/(2*Math.PI*M);if("lowpass"===this._type){const v=1/(I*this.context.sampleRate),M=v-1;this._filter=this.context.createIIRFilter([v,0],[1,M])}else{const v=1/(I*this.context.sampleRate)-1;this._filter=this.context.createIIRFilter([1,-1],[1,v])}this.input.chain(this._filter,this.output),v&&this.context.setTimeout((()=>{this.disposed||(this.input.disconnect(v),v.disconnect())}),this.blockTime)}get frequency(){return this._frequency}set frequency(v){this._frequency=v,this._createFilter()}get type(){return this._type}set type(v){this._type=v,this._createFilter()}getFrequencyResponse(v=128){const M=new Float32Array(v);for(let I=0;I<v;I++){const V=19980*Math.pow(I/v,2)+20;M[I]=V}const I=new Float32Array(v),V=new Float32Array(v);return this._filter.getFrequencyResponse(M,I,V),I}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}}class ia extends wo{constructor(){super(Di(ia.getDefaults(),arguments,["delayTime","resonance","dampening"])),this.name="LowpassCombFilter";const v=Di(ia.getDefaults(),arguments,["delayTime","resonance","dampening"]);this._combFilter=this.output=new sa({context:this.context,delayTime:v.delayTime,resonance:v.resonance}),this.delayTime=this._combFilter.delayTime,this.resonance=this._combFilter.resonance,this._lowpass=this.input=new na({context:this.context,frequency:v.dampening,type:"lowpass"}),this._lowpass.connect(this._combFilter)}static getDefaults(){return Object.assign(wo.getDefaults(),{dampening:3e3,delayTime:.1,resonance:.5})}get dampening(){return this._lowpass.frequency}set dampening(v){this._lowpass.frequency=v}dispose(){return super.dispose(),this._combFilter.dispose(),this._lowpass.dispose(),this}}class oa extends Vr{constructor(){super(Di(oa.getDefaults(),arguments)),this.name="PluckSynth";const v=Di(oa.getDefaults(),arguments);this._noise=new Jo({context:this.context,type:"pink"}),this.attackNoise=v.attackNoise,this._lfcf=new ia({context:this.context,dampening:v.dampening,resonance:v.resonance}),this.resonance=v.resonance,this.release=v.release,this._noise.connect(this._lfcf),this._lfcf.connect(this.output)}static getDefaults(){return Ai(Vr.getDefaults(),{attackNoise:1,dampening:4e3,resonance:.7,release:1})}get dampening(){return this._lfcf.dampening}set dampening(v){this._lfcf.dampening=v}triggerAttack(v,M){const I=this.toFrequency(v);M=this.toSeconds(M);const V=1/I;return this._lfcf.delayTime.setValueAtTime(V,M),this._noise.start(M),this._noise.stop(M+V*this.attackNoise),this._lfcf.resonance.cancelScheduledValues(M),this._lfcf.resonance.setValueAtTime(this.resonance,M),this}triggerRelease(v){return this._lfcf.resonance.linearRampTo(0,this.release,v),this}dispose(){return super.dispose(),this._noise.dispose(),this._lfcf.dispose(),this}}class ra extends Vr{constructor(){super(Di(ra.getDefaults(),arguments,["voice","options"])),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0;const v=Di(ra.getDefaults(),arguments,["voice","options"]);ti(!ui(v.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const M=v.voice.getDefaults();this.options=Object.assign(M,v.options),this.voice=v.voice,this.maxPolyphony=v.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const I=this._voices.indexOf(this._dummyVoice);this._voices.splice(I,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(Vr.getDefaults(),{maxPolyphony:32,options:{},voice:jr})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(v){this._availableVoices.push(v);const M=this._activeVoices.findIndex((M=>M.voice===v));this._activeVoices.splice(M,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const v=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return v.connect(this.output),this._voices.push(v),v}ri("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(.95*this._averageActiveVoices,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const v=this._availableVoices.shift(),M=this._voices.indexOf(v);this._voices.splice(M,1),this.context.isOffline||v.dispose()}}_triggerAttack(v,M,I){v.forEach((v=>{const V=new No(this.context,v).toMidi(),N=this._getNextAvailableVoice();N&&(N.triggerAttack(v,M,I),this._activeVoices.push({midi:V,voice:N,released:!1}),this.log("triggerAttack",v,M))}))}_triggerRelease(v,M){v.forEach((v=>{const I=new No(this.context,v).toMidi(),V=this._activeVoices.find((({midi:v,released:M})=>v===I&&!M));V&&(V.voice.triggerRelease(M),V.released=!0,this.log("triggerRelease",v,M))}))}_scheduleEvent(v,M,I,V){ti(!this.disposed,"Synth was already disposed"),I<=this.now()?"attack"===v?this._triggerAttack(M,I,V):this._triggerRelease(M,I):this.context.setTimeout((()=>{this._scheduleEvent(v,M,I,V)}),I-this.now())}triggerAttack(v,M,I){Array.isArray(v)||(v=[v]);const V=this.toSeconds(M);return this._scheduleEvent("attack",v,V,I),this}triggerRelease(v,M){Array.isArray(v)||(v=[v]);const I=this.toSeconds(M);return this._scheduleEvent("release",v,I),this}triggerAttackRelease(v,M,I,V){const N=this.toSeconds(I);if(this.triggerAttack(v,N,V),di(M)){ti(di(v),"If the duration is an array, the notes must also be an array"),v=v;for(let I=0;I<v.length;I++){const V=M[Math.min(I,M.length-1)],j=this.toSeconds(V);ti(j>0,"The duration must be greater than 0"),this.triggerRelease(v[I],N+j)}}else{const I=this.toSeconds(M);ti(I>0,"The duration must be greater than 0"),this.triggerRelease(v,N+I)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}set(v){const M=Mi(v,["onsilence","context"]);return this.options=Ai(this.options,M),this._voices.forEach((v=>v.set(M))),this._dummyVoice.set(M),this}get(){return this._dummyVoice.get()}releaseAll(v){const M=this.toSeconds(v);return this._activeVoices.forEach((({voice:v})=>{v.triggerRelease(M)})),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach((v=>v.dispose())),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class aa extends Vr{constructor(){super(Di(aa.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const v=Di(aa.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),M={};Object.keys(v.urls).forEach((I=>{const V=parseInt(I,10);if(ti(_i(I)||ui(V)&&isFinite(V),"url key is neither a note or midi pitch: "+I),_i(I)){const V=new lo(this.context,I).toMidi();M[V]=v.urls[I]}else ui(V)&&isFinite(V)&&(M[V]=v.urls[V])})),this._buffers=new Vo({urls:M,onload:v.onload,baseUrl:v.baseUrl,onerror:v.onerror}),this.attack=v.attack,this.release=v.release,this.curve=v.curve,this._buffers.loaded&&Promise.resolve().then(v.onload)}static getDefaults(){return Object.assign(Vr.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Zi,onerror:Zi,release:.1,urls:{}})}_findClosest(v){let M=0;for(;M<96;){if(this._buffers.has(v+M))return-M;if(this._buffers.has(v-M))return M;M++}throw new Error("No available buffers for note: "+v)}triggerAttack(v,M,I=1){return this.log("triggerAttack",v,M,I),Array.isArray(v)||(v=[v]),v.forEach((v=>{const V=ro(new lo(this.context,v).toFrequency()),N=Math.round(V),j=V-N,dt=this._findClosest(N),vt=N-dt,yt=this._buffers.get(vt),xt=no(dt+j),wt=new $o({url:yt,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:xt}).connect(this.output);wt.start(M,0,yt.duration/xt,I),di(this._activeSources.get(N))||this._activeSources.set(N,[]),this._activeSources.get(N).push(wt),wt.onended=()=>{if(this._activeSources&&this._activeSources.has(N)){const v=this._activeSources.get(N),M=v.indexOf(wt);-1!==M&&v.splice(M,1)}}})),this}triggerRelease(v,M){return this.log("triggerRelease",v,M),Array.isArray(v)||(v=[v]),v.forEach((v=>{const I=new lo(this.context,v).toMidi();if(this._activeSources.has(I)&&this._activeSources.get(I).length){const v=this._activeSources.get(I);M=this.toSeconds(M),v.forEach((v=>{v.stop(M)})),this._activeSources.set(I,[])}})),this}releaseAll(v){const M=this.toSeconds(v);return this._activeSources.forEach((v=>{for(;v.length;)v.shift().stop(M)})),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(v,M,I,V=1){const N=this.toSeconds(I);return this.triggerAttack(v,N,V),di(M)?(ti(di(v),"notes must be an array when duration is array"),v.forEach(((v,I)=>{const V=M[Math.min(I,M.length-1)];this.triggerRelease(v,N+this.toSeconds(V))}))):this.triggerRelease(v,N+this.toSeconds(M)),this}add(v,M,I){if(ti(_i(v)||isFinite(v),"note must be a pitch or midi: "+v),_i(v)){const V=new lo(this.context,v).toMidi();this._buffers.add(V,M,I)}else this._buffers.add(v,M,I);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach((v=>{v.forEach((v=>v.dispose()))})),this._activeSources.clear(),this}}vi([wr(0)],aa.prototype,"attack",void 0),vi([wr(0)],aa.prototype,"release",void 0);class ca extends vo{constructor(){super(Di(ca.getDefaults(),arguments,["callback","value"])),this.name="ToneEvent",this._state=new yo("stopped"),this._startOffset=0;const v=Di(ca.getDefaults(),arguments,["callback","value"]);this._loop=v.loop,this.callback=v.callback,this.value=v.value,this._loopStart=this.toTicks(v.loopStart),this._loopEnd=this.toTicks(v.loopEnd),this._playbackRate=v.playbackRate,this._probability=v.probability,this._humanize=v.humanize,this.mute=v.mute,this._playbackRate=v.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(vo.getDefaults(),{callback:Zi,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(v=-1){this._state.forEachFrom(v,(v=>{let M;if("started"===v.state){-1!==v.id&&this.context.transport.clear(v.id);const I=v.time+Math.round(this.startOffset/this._playbackRate);if(!0===this._loop||ui(this._loop)&&this._loop>1){M=1/0,ui(this._loop)&&(M=this._loop*this._getLoopDuration());const V=this._state.getAfter(I);null!==V&&(M=Math.min(M,V.time-I)),M!==1/0&&(this._state.setStateAtTime("stopped",I+M+1,{id:-1}),M=new jo(this.context,M));const N=new jo(this.context,this._getLoopDuration());v.id=this.context.transport.scheduleRepeat(this._tick.bind(this),N,new jo(this.context,I),M)}else v.id=this.context.transport.schedule(this._tick.bind(this),new jo(this.context,I))}}))}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(v){this._startOffset=v}get probability(){return this._probability}set probability(v){this._probability=v}get humanize(){return this._humanize}set humanize(v){this._humanize=v}start(v){const M=this.toTicks(v);return"stopped"===this._state.getValueAtTime(M)&&(this._state.add({id:-1,state:"started",time:M}),this._rescheduleEvents(M)),this}stop(v){this.cancel(v);const M=this.toTicks(v);if("started"===this._state.getValueAtTime(M)){this._state.setStateAtTime("stopped",M,{id:-1});const v=this._state.getBefore(M);let I=M;null!==v&&(I=v.time),this._rescheduleEvents(I)}return this}cancel(v){v=Oi(v,-1/0);const M=this.toTicks(v);return this._state.forEachFrom(M,(v=>{this.context.transport.clear(v.id)})),this._state.cancel(M),this}_tick(v){const M=this.context.transport.getTicksAtTime(v);if(!this.mute&&"started"===this._state.getValueAtTime(M)){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let M=.02;pi(this.humanize)||(M=this.toSeconds(this.humanize)),v+=(2*Math.random()-1)*M}this.callback(v,this.value)}}_getLoopDuration(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)}get loop(){return this._loop}set loop(v){this._loop=v,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(v){this._playbackRate=v,this._rescheduleEvents()}get loopEnd(){return new jo(this.context,this._loopEnd).toSeconds()}set loopEnd(v){this._loopEnd=this.toTicks(v),this._loop&&this._rescheduleEvents()}get loopStart(){return new jo(this.context,this._loopStart).toSeconds()}set loopStart(v){this._loopStart=this.toTicks(v),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const v=this.context.transport.ticks,M=this._state.get(v);if(null!==M&&"started"===M.state){const I=this._getLoopDuration();return(v-M.time)%I/I}return 0}return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class ha extends vo{constructor(){super(Di(ha.getDefaults(),arguments,["callback","interval"])),this.name="Loop";const v=Di(ha.getDefaults(),arguments,["callback","interval"]);this._event=new ca({context:this.context,callback:this._tick.bind(this),loop:!0,loopEnd:v.interval,playbackRate:v.playbackRate,probability:v.probability}),this.callback=v.callback,this.iterations=v.iterations}static getDefaults(){return Object.assign(vo.getDefaults(),{interval:"4n",callback:Zi,playbackRate:1,iterations:1/0,probability:1,mute:!1,humanize:!1})}start(v){return this._event.start(v),this}stop(v){return this._event.stop(v),this}cancel(v){return this._event.cancel(v),this}_tick(v){this.callback(v)}get state(){return this._event.state}get progress(){return this._event.progress}get interval(){return this._event.loopEnd}set interval(v){this._event.loopEnd=v}get playbackRate(){return this._event.playbackRate}set playbackRate(v){this._event.playbackRate=v}get humanize(){return this._event.humanize}set humanize(v){this._event.humanize=v}get probability(){return this._event.probability}set probability(v){this._event.probability=v}get mute(){return this._event.mute}set mute(v){this._event.mute=v}get iterations(){return!0===this._event.loop?1/0:this._event.loop}set iterations(v){this._event.loop=v===1/0||v}dispose(){return super.dispose(),this._event.dispose(),this}}class ua extends ca{constructor(){super(Di(ua.getDefaults(),arguments,["callback","events"])),this.name="Part",this._state=new yo("stopped"),this._events=new Set;const v=Di(ua.getDefaults(),arguments,["callback","events"]);this._state.increasing=!0,v.events.forEach((v=>{di(v)?this.add(v[0],v[1]):this.add(v)}))}static getDefaults(){return Object.assign(ca.getDefaults(),{events:[]})}start(v,M){const I=this.toTicks(v);if("started"!==this._state.getValueAtTime(I)){M=Oi(M,this._loop?this._loopStart:0),M=this._loop?Oi(M,this._loopStart):Oi(M,0);const v=this.toTicks(M);this._state.add({id:-1,offset:v,state:"started",time:I}),this._forEach((M=>{this._startNote(M,I,v)}))}return this}_startNote(v,M,I){M-=I,this._loop?v.startOffset>=this._loopStart&&v.startOffset<this._loopEnd?(v.startOffset<I&&(M+=this._getLoopDuration()),v.start(new jo(this.context,M))):v.startOffset<this._loopStart&&v.startOffset>=I&&(v.loop=!1,v.start(new jo(this.context,M))):v.startOffset>=I&&v.start(new jo(this.context,M))}get startOffset(){return this._startOffset}set startOffset(v){this._startOffset=v,this._forEach((v=>{v.startOffset+=this._startOffset}))}stop(v){const M=this.toTicks(v);return this._state.cancel(M),this._state.setStateAtTime("stopped",M),this._forEach((M=>{M.stop(v)})),this}at(v,M){const I=new mo(this.context,v).toTicks(),V=new jo(this.context,1).toSeconds(),N=this._events.values();let j=N.next();for(;!j.done;){const v=j.value;if(Math.abs(I-v.startOffset)<V)return ci(M)&&(v.value=M),v;j=N.next()}return ci(M)?(this.add(v,M),this.at(v)):null}add(v,M){v instanceof Object&&Reflect.has(v,"time")&&(v=(M=v).time);const I=this.toTicks(v);let V;return M instanceof ca?(V=M,V.callback=this._tick.bind(this)):V=new ca({callback:this._tick.bind(this),context:this.context,value:M}),V.startOffset=I,V.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(V),this._restartEvent(V),this}_restartEvent(v){this._state.forEach((M=>{"started"===M.state?this._startNote(v,M.time,M.offset):v.stop(new jo(this.context,M.time))}))}remove(v,M){return li(v)&&v.hasOwnProperty("time")&&(v=(M=v).time),v=this.toTicks(v),this._events.forEach((I=>{I.startOffset===v&&(ai(M)||ci(M)&&I.value===M)&&(this._events.delete(I),I.dispose())})),this}clear(){return this._forEach((v=>v.dispose())),this._events.clear(),this}cancel(v){return this._forEach((M=>M.cancel(v))),this._state.cancel(this.toTicks(v)),this}_forEach(v){return this._events&&this._events.forEach((M=>{M instanceof ua?M._forEach(v):v(M)})),this}_setAll(v,M){this._forEach((I=>{I[v]=M}))}_tick(v,M){this.mute||this.callback(v,M)}_testLoopBoundries(v){this._loop&&(v.startOffset<this._loopStart||v.startOffset>=this._loopEnd)?v.cancel(0):"stopped"===v.state&&this._restartEvent(v)}get probability(){return this._probability}set probability(v){this._probability=v,this._setAll("probability",v)}get humanize(){return this._humanize}set humanize(v){this._humanize=v,this._setAll("humanize",v)}get loop(){return this._loop}set loop(v){this._loop=v,this._forEach((M=>{M.loopStart=this.loopStart,M.loopEnd=this.loopEnd,M.loop=v,this._testLoopBoundries(M)}))}get loopEnd(){return new jo(this.context,this._loopEnd).toSeconds()}set loopEnd(v){this._loopEnd=this.toTicks(v),this._loop&&this._forEach((M=>{M.loopEnd=v,this._testLoopBoundries(M)}))}get loopStart(){return new jo(this.context,this._loopStart).toSeconds()}set loopStart(v){this._loopStart=this.toTicks(v),this._loop&&this._forEach((v=>{v.loopStart=this.loopStart,this._testLoopBoundries(v)}))}get playbackRate(){return this._playbackRate}set playbackRate(v){this._playbackRate=v,this._setAll("playbackRate",v)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}function*la(v){let M=0;for(;M<v.length;)M=fa(M,v),yield v[M],M++}function*pa(v){let M=v.length-1;for(;M>=0;)M=fa(M,v),yield v[M],M--}function*da(v,M){for(;;)yield*M(v)}function fa(v,M){return Vi(v,0,M.length-1)}function*_a(v,M){let I=M?0:v.length-1;for(;;)I=fa(I,v),yield v[I],M?(I++,I>=v.length-1&&(M=!1)):(I--,I<=0&&(M=!0))}function*ma(v){let M=0,I=0;for(;M<v.length;)M=fa(M,v),yield v[M],I++,M+=I%2?2:-1}function*ga(v){let M=v.length-1,I=0;for(;M>=0;)M=fa(M,v),yield v[M],I++,M+=I%2?-2:1}function*va(v){const M=[];for(let I=0;I<v.length;I++)M.push(I);for(;M.length>0;){const I=fa(M.splice(Math.floor(M.length*Math.random()),1)[0],v);yield v[I]}}function*ya(v,M="up",I=0){switch(ti(v.length>0,"The array must have more than one value in it"),M){case"up":yield*da(v,la);case"down":yield*da(v,pa);case"upDown":yield*_a(v,!0);case"downUp":yield*_a(v,!1);case"alternateUp":yield*da(v,ma);case"alternateDown":yield*da(v,ga);case"random":yield*function*(v){for(;;){const M=Math.floor(Math.random()*v.length);yield v[M]}}(v);case"randomOnce":yield*da(v,va);case"randomWalk":yield*function*(v){let M=Math.floor(Math.random()*v.length);for(;;)0===M?M++:M===v.length-1||Math.random()<.5?M--:M++,yield v[M]}(v)}}class xa extends ha{constructor(){super(Di(xa.getDefaults(),arguments,["callback","values","pattern"])),this.name="Pattern";const v=Di(xa.getDefaults(),arguments,["callback","values","pattern"]);this.callback=v.callback,this._values=v.values,this._pattern=ya(v.values,v.pattern),this._type=v.pattern}static getDefaults(){return Object.assign(ha.getDefaults(),{pattern:"up",values:[],callback:Zi})}_tick(v){const M=this._pattern.next();this._value=M.value,this.callback(v,this._value)}get values(){return this._values}set values(v){this._values=v,this.pattern=this._type}get value(){return this._value}get pattern(){return this._type}set pattern(v){this._type=v,this._pattern=ya(this._values,this._type)}}class wa extends ca{constructor(){super(Di(wa.getDefaults(),arguments,["callback","events","subdivision"])),this.name="Sequence",this._part=new ua({callback:this._seqCallback.bind(this),context:this.context}),this._events=[],this._eventsArray=[];const v=Di(wa.getDefaults(),arguments,["callback","events","subdivision"]);this._subdivision=this.toTicks(v.subdivision),this.events=v.events,this.loop=v.loop,this.loopStart=v.loopStart,this.loopEnd=v.loopEnd,this.playbackRate=v.playbackRate,this.probability=v.probability,this.humanize=v.humanize,this.mute=v.mute,this.playbackRate=v.playbackRate}static getDefaults(){return Object.assign(Mi(ca.getDefaults(),["value"]),{events:[],loop:!0,loopEnd:0,loopStart:0,subdivision:"8n"})}_seqCallback(v,M){null!==M&&this.callback(v,M)}get events(){return this._events}set events(v){this.clear(),this._eventsArray=v,this._events=this._createSequence(this._eventsArray),this._eventsUpdated()}start(v,M){return this._part.start(v,M?this._indexTime(M):M),this}stop(v){return this._part.stop(v),this}get subdivision(){return new jo(this.context,this._subdivision).toSeconds()}_createSequence(v){return new Proxy(v,{get:(v,M)=>v[M],set:(v,M,I)=>(fi(M)&&isFinite(parseInt(M,10))&&di(I)?v[M]=this._createSequence(I):v[M]=I,this._eventsUpdated(),!0)})}_eventsUpdated(){this._part.clear(),this._rescheduleSequence(this._eventsArray,this._subdivision,this.startOffset),this.loopEnd=this.loopEnd}_rescheduleSequence(v,M,I){v.forEach(((v,V)=>{const N=V*M+I;if(di(v))this._rescheduleSequence(v,M/v.length,N);else{const M=new jo(this.context,N,"i").toSeconds();this._part.add(M,v)}}))}_indexTime(v){return new jo(this.context,v*this._subdivision+this.startOffset).toSeconds()}clear(){return this._part.clear(),this}dispose(){return super.dispose(),this._part.dispose(),this}get loop(){return this._part.loop}set loop(v){this._part.loop=v}get loopStart(){return this._loopStart}set loopStart(v){this._loopStart=v,this._part.loopStart=this._indexTime(v)}get loopEnd(){return this._loopEnd}set loopEnd(v){this._loopEnd=v,this._part.loopEnd=0===v?this._indexTime(this._eventsArray.length):this._indexTime(v)}get startOffset(){return this._part.startOffset}set startOffset(v){this._part.startOffset=v}get playbackRate(){return this._part.playbackRate}set playbackRate(v){this._part.playbackRate=v}get probability(){return this._part.probability}set probability(v){this._part.probability=v}get progress(){return this._part.progress}get humanize(){return this._part.humanize}set humanize(v){this._part.humanize=v}get length(){return this._part.length}}class ba extends wo{constructor(){super(Object.assign(Di(ba.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new Cr({context:this.context}),this.a=new ko({context:this.context,gain:0}),this.b=new ko({context:this.context,gain:0}),this.output=new ko({context:this.context}),this._internalChannels=[this.a,this.b];const v=Di(ba.getDefaults(),arguments,["fade"]);this.fade=new Do({context:this.context,units:"normalRange",value:v.fade}),Ui(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",To(this._split,this.a.gain,0),To(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(wo.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class Ta extends wo{constructor(v){super(v),this.name="Effect",this._dryWet=new ba({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new ko({context:this.context}),this.effectReturn=new ko({context:this.context}),this.input=new ko({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(v.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],Ui(this,"wet")}static getDefaults(){return Object.assign(wo.getDefaults(),{wet:1})}connectEffect(v){return this._internalChannels.push(v),this.effectSend.chain(v,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class Sa extends Ta{constructor(v){super(v),this.name="LFOEffect",this._lfo=new yr({context:this.context,frequency:v.frequency,amplitude:v.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.type=v.type,Ui(this,["frequency","depth"])}static getDefaults(){return Object.assign(Ta.getDefaults(),{frequency:1,type:"sine",depth:1})}start(v){return this._lfo.start(v),this}stop(v){return this._lfo.stop(v),this}sync(){return this._lfo.sync(),this}unsync(){return this._lfo.unsync(),this}get type(){return this._lfo.type}set type(v){this._lfo.type=v}dispose(){return super.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class ka extends Sa{constructor(){super(Di(ka.getDefaults(),arguments,["frequency","baseFrequency","octaves"])),this.name="AutoFilter";const v=Di(ka.getDefaults(),arguments,["frequency","baseFrequency","octaves"]);this.filter=new Wr(Object.assign(v.filter,{context:this.context})),this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.octaves=v.octaves,this.baseFrequency=v.baseFrequency}static getDefaults(){return Object.assign(Sa.getDefaults(),{baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}})}get baseFrequency(){return this._lfo.min}set baseFrequency(v){this._lfo.min=this.toFrequency(v),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(v){this._octaves=v,this._lfo.max=this._lfo.min*Math.pow(2,v)}dispose(){return super.dispose(),this.filter.dispose(),this}}class Ca extends wo{constructor(){super(Object.assign(Di(Ca.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const v=Di(Ca.getDefaults(),arguments,["pan"]);this.pan=new xo({context:this.context,param:this._panner.pan,value:v.pan,minValue:-1,maxValue:1}),this._panner.channelCount=v.channelCount,this._panner.channelCountMode="explicit",Ui(this,"pan")}static getDefaults(){return Object.assign(wo.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}class Aa extends Sa{constructor(){super(Di(Aa.getDefaults(),arguments,["frequency"])),this.name="AutoPanner";const v=Di(Aa.getDefaults(),arguments,["frequency"]);this._panner=new Ca({context:this.context,channelCount:v.channelCount}),this.connectEffect(this._panner),this._lfo.connect(this._panner.pan),this._lfo.min=-1,this._lfo.max=1}static getDefaults(){return Object.assign(Sa.getDefaults(),{channelCount:1})}dispose(){return super.dispose(),this._panner.dispose(),this}}class Da extends wo{constructor(){super(Di(Da.getDefaults(),arguments,["smoothing"])),this.name="Follower";const v=Di(Da.getDefaults(),arguments,["smoothing"]);this._abs=this.input=new kr({context:this.context}),this._lowpass=this.output=new na({context:this.context,frequency:1/this.toSeconds(v.smoothing),type:"lowpass"}),this._abs.connect(this._lowpass),this._smoothing=v.smoothing}static getDefaults(){return Object.assign(wo.getDefaults(),{smoothing:.05})}get smoothing(){return this._smoothing}set smoothing(v){this._smoothing=v,this._lowpass.frequency=1/this.toSeconds(this.smoothing)}dispose(){return super.dispose(),this._abs.dispose(),this._lowpass.dispose(),this}}class Oa extends Ta{constructor(){super(Di(Oa.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"])),this.name="AutoWah";const v=Di(Oa.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]);this._follower=new Da({context:this.context,smoothing:v.follower}),this._sweepRange=new Rr({context:this.context,min:0,max:1,exponent:.5}),this._baseFrequency=this.toFrequency(v.baseFrequency),this._octaves=v.octaves,this._inputBoost=new ko({context:this.context}),this._bandpass=new Wr({context:this.context,rolloff:-48,frequency:0,Q:v.Q}),this._peaking=new Wr({context:this.context,type:"peaking"}),this._peaking.gain.value=v.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this._follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=v.sensitivity,Ui(this,["gain","Q"])}static getDefaults(){return Object.assign(Ta.getDefaults(),{baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.2})}get octaves(){return this._octaves}set octaves(v){this._octaves=v,this._setSweepRange()}get follower(){return this._follower.smoothing}set follower(v){this._follower.smoothing=v}get baseFrequency(){return this._baseFrequency}set baseFrequency(v){this._baseFrequency=this.toFrequency(v),this._setSweepRange()}get sensitivity(){return so(1/this._inputBoost.gain.value)}set sensitivity(v){this._inputBoost.gain.value=1/eo(v)}_setSweepRange(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)}dispose(){return super.dispose(),this._follower.dispose(),this._sweepRange.dispose(),this._bandpass.dispose(),this._peaking.dispose(),this._inputBoost.dispose(),this}}ta("bit-crusher","\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n");class Ma extends Ta{constructor(){super(Di(Ma.getDefaults(),arguments,["bits"])),this.name="BitCrusher";const v=Di(Ma.getDefaults(),arguments,["bits"]);this._bitCrusherWorklet=new Ea({context:this.context,bits:v.bits}),this.connectEffect(this._bitCrusherWorklet),this.bits=this._bitCrusherWorklet.bits}static getDefaults(){return Object.assign(Ta.getDefaults(),{bits:4})}dispose(){return super.dispose(),this._bitCrusherWorklet.dispose(),this}}class Ea extends ea{constructor(){super(Di(Ea.getDefaults(),arguments)),this.name="BitCrusherWorklet";const v=Di(Ea.getDefaults(),arguments);this.input=new ko({context:this.context}),this.output=new ko({context:this.context}),this.bits=new xo({context:this.context,value:v.bits,units:"positive",minValue:1,maxValue:16,param:this._dummyParam,swappable:!0})}static getDefaults(){return Object.assign(ea.getDefaults(),{bits:12})}_audioWorkletName(){return"bit-crusher"}onReady(v){bo(this.input,v,this.output);const M=v.parameters.get("bits");this.bits.setParam(M)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.bits.dispose(),this}}class Ra extends Ta{constructor(){super(Di(Ra.getDefaults(),arguments,["order"])),this.name="Chebyshev";const v=Di(Ra.getDefaults(),arguments,["order"]);this._shaper=new rr({context:this.context,length:4096}),this._order=v.order,this.connectEffect(this._shaper),this.order=v.order,this.oversample=v.oversample}static getDefaults(){return Object.assign(Ta.getDefaults(),{order:1,oversample:"none"})}_getCoefficient(v,M,I){return I.has(M)||(0===M?I.set(M,0):1===M?I.set(M,v):I.set(M,2*v*this._getCoefficient(v,M-1,I)-this._getCoefficient(v,M-2,I))),I.get(M)}get order(){return this._order}set order(v){this._order=v,this._shaper.setMap((M=>this._getCoefficient(M,v,new Map)))}get oversample(){return this._shaper.oversample}set oversample(v){this._shaper.oversample=v}dispose(){return super.dispose(),this._shaper.dispose(),this}}class qa extends wo{constructor(){super(Di(qa.getDefaults(),arguments,["channels"])),this.name="Split";const v=Di(qa.getDefaults(),arguments,["channels"]);this._splitter=this.input=this.output=this.context.createChannelSplitter(v.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(wo.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class Fa extends wo{constructor(){super(Di(Fa.getDefaults(),arguments,["channels"])),this.name="Merge";const v=Di(Fa.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(v.channels)}static getDefaults(){return Object.assign(wo.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class Ia extends wo{constructor(v){super(v),this.name="StereoEffect",this.input=new ko({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new ba({context:this.context,fade:v.wet}),this.wet=this._dryWet.fade,this._split=new qa({context:this.context,channels:2}),this._merge=new Fa({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),Ui(this,["wet"])}connectEffectLeft(...v){this._split.connect(v[0],0,0),bo(...v),To(v[v.length-1],this._merge,0,0)}connectEffectRight(...v){this._split.connect(v[0],1,0),bo(...v),To(v[v.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(wo.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class Va extends Ia{constructor(v){super(v),this.feedback=new Do({context:this.context,value:v.feedback,units:"normalRange"}),this._feedbackL=new ko({context:this.context}),this._feedbackR=new ko({context:this.context}),this._feedbackSplit=new qa({context:this.context,channels:2}),this._feedbackMerge=new Fa({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),Ui(this,["feedback"])}static getDefaults(){return Object.assign(Ia.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class Na extends Va{constructor(){super(Di(Na.getDefaults(),arguments,["frequency","delayTime","depth"])),this.name="Chorus";const v=Di(Na.getDefaults(),arguments,["frequency","delayTime","depth"]);this._depth=v.depth,this._delayTime=v.delayTime/1e3,this._lfoL=new yr({context:this.context,frequency:v.frequency,min:0,max:1}),this._lfoR=new yr({context:this.context,frequency:v.frequency,min:0,max:1,phase:180}),this._delayNodeL=new Fo({context:this.context}),this._delayNodeR=new Fo({context:this.context}),this.frequency=this._lfoL.frequency,Ui(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=v.type,this.spread=v.spread}static getDefaults(){return Object.assign(Va.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(v){this._depth=v;const M=this._delayTime*v;this._lfoL.min=Math.max(this._delayTime-M,0),this._lfoL.max=this._delayTime+M,this._lfoR.min=Math.max(this._delayTime-M,0),this._lfoR.max=this._delayTime+M}get delayTime(){return 1e3*this._delayTime}set delayTime(v){this._delayTime=v/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(v){this._lfoL.type=v,this._lfoR.type=v}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(v){this._lfoL.phase=90-v/2,this._lfoR.phase=v/2+90}start(v){return this._lfoL.start(v),this._lfoR.start(v),this}stop(v){return this._lfoL.stop(v),this._lfoR.stop(v),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}class Pa extends Ta{constructor(){super(Di(Pa.getDefaults(),arguments,["distortion"])),this.name="Distortion";const v=Di(Pa.getDefaults(),arguments,["distortion"]);this._shaper=new rr({context:this.context,length:4096}),this._distortion=v.distortion,this.connectEffect(this._shaper),this.distortion=v.distortion,this.oversample=v.oversample}static getDefaults(){return Object.assign(Ta.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(v){this._distortion=v;const M=100*v,I=Math.PI/180;this._shaper.setMap((v=>Math.abs(v)<.001?0:(3+M)*v*20*I/(Math.PI+M*Math.abs(v))))}get oversample(){return this._shaper.oversample}set oversample(v){this._shaper.oversample=v}dispose(){return super.dispose(),this._shaper.dispose(),this}}class ja extends Ta{constructor(v){super(v),this.name="FeedbackEffect",this._feedbackGain=new ko({context:this.context,gain:v.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,Ui(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(Ta.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class La extends ja{constructor(){super(Di(La.getDefaults(),arguments,["delayTime","feedback"])),this.name="FeedbackDelay";const v=Di(La.getDefaults(),arguments,["delayTime","feedback"]);this._delayNode=new Fo({context:this.context,delayTime:v.delayTime,maxDelay:v.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),Ui(this,"delayTime")}static getDefaults(){return Object.assign(ja.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class za extends wo{constructor(v){super(v),this.name="PhaseShiftAllpass",this.input=new ko({context:this.context}),this.output=new ko({context:this.context}),this.offset90=new ko({context:this.context});this._bank0=this._createAllPassFilterBank([.6923878,.9360654322959,.988229522686,.9987488452737]),this._bank1=this._createAllPassFilterBank([.4021921162426,.856171088242,.9722909545651,.9952884791278]),this._oneSampleDelay=this.context.createIIRFilter([0,1],[1,0]),bo(this.input,...this._bank0,this._oneSampleDelay,this.output),bo(this.input,...this._bank1,this.offset90)}_createAllPassFilterBank(v){return v.map((v=>{const M=[[v*v,0,-1],[1,0,-v*v]];return this.context.createIIRFilter(M[0],M[1])}))}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.offset90.dispose(),this._bank0.forEach((v=>v.disconnect())),this._bank1.forEach((v=>v.disconnect())),this._oneSampleDelay.disconnect(),this}}class Ba extends Ta{constructor(){super(Di(Ba.getDefaults(),arguments,["frequency"])),this.name="FrequencyShifter";const v=Di(Ba.getDefaults(),arguments,["frequency"]);this.frequency=new Do({context:this.context,units:"frequency",value:v.frequency,minValue:-this.context.sampleRate/2,maxValue:this.context.sampleRate/2}),this._sine=new nr({context:this.context,type:"sine"}),this._cosine=new ir({context:this.context,phase:-90,type:"sine"}),this._sineMultiply=new cr({context:this.context}),this._cosineMultiply=new cr({context:this.context}),this._negate=new Ar({context:this.context}),this._add=new mr({context:this.context}),this._phaseShifter=new za({context:this.context}),this.effectSend.connect(this._phaseShifter),this.frequency.fan(this._sine.frequency,this._cosine.frequency),this._phaseShifter.offset90.connect(this._cosineMultiply),this._cosine.connect(this._cosineMultiply.factor),this._phaseShifter.connect(this._sineMultiply),this._sine.connect(this._sineMultiply.factor),this._sineMultiply.connect(this._negate),this._cosineMultiply.connect(this._add),this._negate.connect(this._add.addend),this._add.connect(this.effectReturn);const M=this.immediate();this._sine.start(M),this._cosine.start(M)}static getDefaults(){return Object.assign(Ta.getDefaults(),{frequency:0})}dispose(){return super.dispose(),this.frequency.dispose(),this._add.dispose(),this._cosine.dispose(),this._cosineMultiply.dispose(),this._negate.dispose(),this._phaseShifter.dispose(),this._sine.dispose(),this._sineMultiply.dispose(),this}}const Qc=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],Zc=[225,556,441,341];class Ua extends Ia{constructor(){super(Di(Ua.getDefaults(),arguments,["roomSize","dampening"])),this.name="Freeverb",this._combFilters=[],this._allpassFiltersL=[],this._allpassFiltersR=[];const v=Di(Ua.getDefaults(),arguments,["roomSize","dampening"]);this.roomSize=new Do({context:this.context,value:v.roomSize,units:"normalRange"}),this._allpassFiltersL=Zc.map((v=>{const M=this.context.createBiquadFilter();return M.type="allpass",M.frequency.value=v,M})),this._allpassFiltersR=Zc.map((v=>{const M=this.context.createBiquadFilter();return M.type="allpass",M.frequency.value=v,M})),this._combFilters=Qc.map(((M,I)=>{const V=new ia({context:this.context,dampening:v.dampening,delayTime:M});return I<Qc.length/2?this.connectEffectLeft(V,...this._allpassFiltersL):this.connectEffectRight(V,...this._allpassFiltersR),this.roomSize.connect(V.resonance),V})),Ui(this,["roomSize"])}static getDefaults(){return Object.assign(Ia.getDefaults(),{roomSize:.7,dampening:3e3})}get dampening(){return this._combFilters[0].dampening}set dampening(v){this._combFilters.forEach((M=>M.dampening=v))}dispose(){return super.dispose(),this._allpassFiltersL.forEach((v=>v.disconnect())),this._allpassFiltersR.forEach((v=>v.disconnect())),this._combFilters.forEach((v=>v.dispose())),this.roomSize.dispose(),this}}const Hc=[.06748,.06404,.08212,.09004],$c=[.773,.802,.753,.733],Jc=[347,113,37];class Ya extends Ia{constructor(){super(Di(Ya.getDefaults(),arguments,["roomSize"])),this.name="JCReverb",this._allpassFilters=[],this._feedbackCombFilters=[];const v=Di(Ya.getDefaults(),arguments,["roomSize"]);this.roomSize=new Do({context:this.context,value:v.roomSize,units:"normalRange"}),this._scaleRoomSize=new gr({context:this.context,min:-.733,max:.197}),this._allpassFilters=Jc.map((v=>{const M=this.context.createBiquadFilter();return M.type="allpass",M.frequency.value=v,M})),this._feedbackCombFilters=Hc.map(((v,M)=>{const I=new sa({context:this.context,delayTime:v});return this._scaleRoomSize.connect(I.resonance),I.resonance.value=$c[M],M<Hc.length/2?this.connectEffectLeft(...this._allpassFilters,I):this.connectEffectRight(...this._allpassFilters,I),I})),this.roomSize.connect(this._scaleRoomSize),Ui(this,["roomSize"])}static getDefaults(){return Object.assign(Ia.getDefaults(),{roomSize:.5})}dispose(){return super.dispose(),this._allpassFilters.forEach((v=>v.disconnect())),this._feedbackCombFilters.forEach((v=>v.dispose())),this.roomSize.dispose(),this._scaleRoomSize.dispose(),this}}class Ha extends Va{constructor(v){super(v),this._feedbackL.disconnect(),this._feedbackL.connect(this._feedbackMerge,0,1),this._feedbackR.disconnect(),this._feedbackR.connect(this._feedbackMerge,0,0),Ui(this,["feedback"])}}class $a extends Ha{constructor(){super(Di($a.getDefaults(),arguments,["delayTime","feedback"])),this.name="PingPongDelay";const v=Di($a.getDefaults(),arguments,["delayTime","feedback"]);this._leftDelay=new Fo({context:this.context,maxDelay:v.maxDelay}),this._rightDelay=new Fo({context:this.context,maxDelay:v.maxDelay}),this._rightPreDelay=new Fo({context:this.context,maxDelay:v.maxDelay}),this.delayTime=new Do({context:this.context,units:"time",value:v.delayTime}),this.connectEffectLeft(this._leftDelay),this.connectEffectRight(this._rightPreDelay,this._rightDelay),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackL.disconnect(),this._feedbackL.connect(this._rightDelay),Ui(this,["delayTime"])}static getDefaults(){return Object.assign(Ha.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._leftDelay.dispose(),this._rightDelay.dispose(),this._rightPreDelay.dispose(),this.delayTime.dispose(),this}}class Ja extends ja{constructor(){super(Di(Ja.getDefaults(),arguments,["pitch"])),this.name="PitchShift";const v=Di(Ja.getDefaults(),arguments,["pitch"]);this._frequency=new Do({context:this.context}),this._delayA=new Fo({maxDelay:1,context:this.context}),this._lfoA=new yr({context:this.context,min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new Fo({maxDelay:1,context:this.context}),this._lfoB=new yr({context:this.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new ba({context:this.context}),this._crossFadeLFO=new yr({context:this.context,min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new Fo({delayTime:v.delayTime,context:this.context}),this.delayTime=this._feedbackDelay.delayTime,Ui(this,"delayTime"),this._pitch=v.pitch,this._windowSize=v.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);const M=this.now();this._lfoA.start(M),this._lfoB.start(M),this._crossFadeLFO.start(M),this.windowSize=this._windowSize}static getDefaults(){return Object.assign(ja.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}get pitch(){return this._pitch}set pitch(v){this._pitch=v;let M=0;v<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,M=no(v-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,M=no(v)-1),this._frequency.value=M*(1.2/this._windowSize)}get windowSize(){return this._windowSize}set windowSize(v){this._windowSize=this.toSeconds(v),this.pitch=this._pitch}dispose(){return super.dispose(),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}}class Ka extends Ia{constructor(){super(Di(Ka.getDefaults(),arguments,["frequency","octaves","baseFrequency"])),this.name="Phaser";const v=Di(Ka.getDefaults(),arguments,["frequency","octaves","baseFrequency"]);this._lfoL=new yr({context:this.context,frequency:v.frequency,min:0,max:1}),this._lfoR=new yr({context:this.context,frequency:v.frequency,min:0,max:1,phase:180}),this._baseFrequency=this.toFrequency(v.baseFrequency),this._octaves=v.octaves,this.Q=new Do({context:this.context,value:v.Q,units:"positive"}),this._filtersL=this._makeFilters(v.stages,this._lfoL),this._filtersR=this._makeFilters(v.stages,this._lfoR),this.frequency=this._lfoL.frequency,this.frequency.value=v.frequency,this.connectEffectLeft(...this._filtersL),this.connectEffectRight(...this._filtersR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=v.baseFrequency,this.octaves=v.octaves,this._lfoL.start(),this._lfoR.start(),Ui(this,["frequency","Q"])}static getDefaults(){return Object.assign(Ia.getDefaults(),{frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350})}_makeFilters(v,M){const I=[];for(let V=0;V<v;V++){const v=this.context.createBiquadFilter();v.type="allpass",this.Q.connect(v.Q),M.connect(v.frequency),I.push(v)}return I}get octaves(){return this._octaves}set octaves(v){this._octaves=v;const M=this._baseFrequency*Math.pow(2,v);this._lfoL.max=M,this._lfoR.max=M}get baseFrequency(){return this._baseFrequency}set baseFrequency(v){this._baseFrequency=this.toFrequency(v),this._lfoL.min=this._baseFrequency,this._lfoR.min=this._baseFrequency,this.octaves=this._octaves}dispose(){return super.dispose(),this.Q.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._filtersL.forEach((v=>v.disconnect())),this._filtersR.forEach((v=>v.disconnect())),this.frequency.dispose(),this}}class tc extends Ta{constructor(){super(Di(tc.getDefaults(),arguments,["decay"])),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const v=Di(tc.getDefaults(),arguments,["decay"]);this._decay=v.decay,this._preDelay=v.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(Ta.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(v){ei(v=this.toSeconds(v),.001),this._decay=v,this.generate()}get preDelay(){return this._preDelay}set preDelay(v){ei(v=this.toSeconds(v),0),this._preDelay=v,this.generate()}generate(){return yi(this,void 0,void 0,(function*(){const v=this.ready,M=new Yi(2,this._decay+this._preDelay,this.context.sampleRate),I=new Jo({context:M}),V=new Jo({context:M}),N=new Fa({context:M});I.connect(N,0,0),V.connect(N,0,1);const j=new ko({context:M}).toDestination();N.connect(j),I.start(0),V.start(0),j.gain.setValueAtTime(0,0),j.gain.setValueAtTime(1,this._preDelay),j.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const dt=M.render();return this.ready=dt.then(Zi),yield v,this._convolver.buffer=(yield dt).get(),this}))}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class ec extends wo{constructor(){super(Di(ec.getDefaults(),arguments)),this.name="MidSideSplit",this._split=this.input=new qa({channels:2,context:this.context}),this._midAdd=new mr({context:this.context}),this.mid=new cr({context:this.context,value:Math.SQRT1_2}),this._sideSubtract=new Dr({context:this.context}),this.side=new cr({context:this.context,value:Math.SQRT1_2}),this._split.connect(this._midAdd,0),this._split.connect(this._midAdd.addend,1),this._split.connect(this._sideSubtract,0),this._split.connect(this._sideSubtract.subtrahend,1),this._midAdd.connect(this.mid),this._sideSubtract.connect(this.side)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midAdd.dispose(),this._sideSubtract.dispose(),this._split.dispose(),this}}class sc extends wo{constructor(){super(Di(sc.getDefaults(),arguments)),this.name="MidSideMerge",this.mid=new ko({context:this.context}),this.side=new ko({context:this.context}),this._left=new mr({context:this.context}),this._leftMult=new cr({context:this.context,value:Math.SQRT1_2}),this._right=new Dr({context:this.context}),this._rightMult=new cr({context:this.context,value:Math.SQRT1_2}),this._merge=this.output=new Fa({context:this.context}),this.mid.fan(this._left),this.side.connect(this._left.addend),this.mid.connect(this._right),this.side.connect(this._right.subtrahend),this._left.connect(this._leftMult),this._right.connect(this._rightMult),this._leftMult.connect(this._merge,0,0),this._rightMult.connect(this._merge,0,1)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._leftMult.dispose(),this._rightMult.dispose(),this._left.dispose(),this._right.dispose(),this}}class nc extends Ta{constructor(v){super(v),this.name="MidSideEffect",this._midSideMerge=new sc({context:this.context}),this._midSideSplit=new ec({context:this.context}),this._midSend=this._midSideSplit.mid,this._sideSend=this._midSideSplit.side,this._midReturn=this._midSideMerge.mid,this._sideReturn=this._midSideMerge.side,this.effectSend.connect(this._midSideSplit),this._midSideMerge.connect(this.effectReturn)}connectEffectMid(...v){this._midSend.chain(...v,this._midReturn)}connectEffectSide(...v){this._sideSend.chain(...v,this._sideReturn)}dispose(){return super.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this._midSend.dispose(),this._sideSend.dispose(),this._midReturn.dispose(),this._sideReturn.dispose(),this}}class ic extends nc{constructor(){super(Di(ic.getDefaults(),arguments,["width"])),this.name="StereoWidener";const v=Di(ic.getDefaults(),arguments,["width"]);this.width=new Do({context:this.context,value:v.width,units:"normalRange"}),Ui(this,["width"]),this._twoTimesWidthMid=new cr({context:this.context,value:2}),this._twoTimesWidthSide=new cr({context:this.context,value:2}),this._midMult=new cr({context:this.context}),this._twoTimesWidthMid.connect(this._midMult.factor),this.connectEffectMid(this._midMult),this._oneMinusWidth=new Dr({context:this.context}),this._oneMinusWidth.connect(this._twoTimesWidthMid),To(this.context.getConstant(1),this._oneMinusWidth),this.width.connect(this._oneMinusWidth.subtrahend),this._sideMult=new cr({context:this.context}),this.width.connect(this._twoTimesWidthSide),this._twoTimesWidthSide.connect(this._sideMult.factor),this.connectEffectSide(this._sideMult)}static getDefaults(){return Object.assign(nc.getDefaults(),{width:.5})}dispose(){return super.dispose(),this.width.dispose(),this._midMult.dispose(),this._sideMult.dispose(),this._twoTimesWidthMid.dispose(),this._twoTimesWidthSide.dispose(),this._oneMinusWidth.dispose(),this}}class oc extends Ia{constructor(){super(Di(oc.getDefaults(),arguments,["frequency","depth"])),this.name="Tremolo";const v=Di(oc.getDefaults(),arguments,["frequency","depth"]);this._lfoL=new yr({context:this.context,type:v.type,min:1,max:0}),this._lfoR=new yr({context:this.context,type:v.type,min:1,max:0}),this._amplitudeL=new ko({context:this.context}),this._amplitudeR=new ko({context:this.context}),this.frequency=new Do({context:this.context,value:v.frequency,units:"frequency"}),this.depth=new Do({context:this.context,value:v.depth,units:"normalRange"}),Ui(this,["frequency","depth"]),this.connectEffectLeft(this._amplitudeL),this.connectEffectRight(this._amplitudeR),this._lfoL.connect(this._amplitudeL.gain),this._lfoR.connect(this._amplitudeR.gain),this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency),this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude),this.spread=v.spread}static getDefaults(){return Object.assign(Ia.getDefaults(),{frequency:10,type:"sine",depth:.5,spread:180})}start(v){return this._lfoL.start(v),this._lfoR.start(v),this}stop(v){return this._lfoL.stop(v),this._lfoR.stop(v),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this.context.transport.syncSignal(this.frequency),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this.context.transport.unsyncSignal(this.frequency),this}get type(){return this._lfoL.type}set type(v){this._lfoL.type=v,this._lfoR.type=v}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(v){this._lfoL.phase=90-v/2,this._lfoR.phase=v/2+90}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._amplitudeL.dispose(),this._amplitudeR.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class rc extends Ta{constructor(){super(Di(rc.getDefaults(),arguments,["frequency","depth"])),this.name="Vibrato";const v=Di(rc.getDefaults(),arguments,["frequency","depth"]);this._delayNode=new Fo({context:this.context,delayTime:0,maxDelay:v.maxDelay}),this._lfo=new yr({context:this.context,type:v.type,min:0,max:v.maxDelay,frequency:v.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=v.depth,Ui(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(Ta.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(v){this._lfo.type=v}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class ac extends wo{constructor(){super(Di(ac.getDefaults(),arguments,["type","size"])),this.name="Analyser",this._analysers=[],this._buffers=[];const v=Di(ac.getDefaults(),arguments,["type","size"]);this.input=this.output=this._gain=new ko({context:this.context}),this._split=new qa({context:this.context,channels:v.channels}),this.input.connect(this._split),ei(v.channels,1);for(let M=0;M<v.channels;M++)this._analysers[M]=this.context.createAnalyser(),this._split.connect(this._analysers[M],M,0);this.size=v.size,this.type=v.type}static getDefaults(){return Object.assign(wo.getDefaults(),{size:1024,smoothing:.8,type:"fft",channels:1})}getValue(){return this._analysers.forEach(((v,M)=>{const I=this._buffers[M];"fft"===this._type?v.getFloatFrequencyData(I):"waveform"===this._type&&v.getFloatTimeDomainData(I)})),1===this.channels?this._buffers[0]:this._buffers}get size(){return this._analysers[0].frequencyBinCount}set size(v){this._analysers.forEach(((M,I)=>{M.fftSize=2*v,this._buffers[I]=new Float32Array(v)}))}get channels(){return this._analysers.length}get type(){return this._type}set type(v){ti("waveform"===v||"fft"===v,"Analyser: invalid type: "+v),this._type=v}get smoothing(){return this._analysers[0].smoothingTimeConstant}set smoothing(v){this._analysers.forEach((M=>M.smoothingTimeConstant=v))}dispose(){return super.dispose(),this._analysers.forEach((v=>v.disconnect())),this._split.dispose(),this._gain.dispose(),this}}class cc extends wo{constructor(){super(Di(cc.getDefaults(),arguments)),this.name="MeterBase",this.input=this.output=this._analyser=new ac({context:this.context,size:256,type:"waveform"})}dispose(){return super.dispose(),this._analyser.dispose(),this}}class hc extends cc{constructor(){super(Di(hc.getDefaults(),arguments,["smoothing"])),this.name="Meter",this._rms=0;const v=Di(hc.getDefaults(),arguments,["smoothing"]);this.input=this.output=this._analyser=new ac({context:this.context,size:256,type:"waveform",channels:v.channels}),this.smoothing=v.smoothing,this.normalRange=v.normalRange}static getDefaults(){return Object.assign(cc.getDefaults(),{smoothing:.8,normalRange:!1,channels:1})}getLevel(){return ri("'getLevel' has been changed to 'getValue'"),this.getValue()}getValue(){const v=this._analyser.getValue(),M=(1===this.channels?[v]:v).map((v=>{const M=v.reduce(((v,M)=>v+M*M),0),I=Math.sqrt(M/v.length);return this._rms=Math.max(I,this._rms*this.smoothing),this.normalRange?this._rms:so(this._rms)}));return 1===this.channels?M[0]:M}get channels(){return this._analyser.channels}dispose(){return super.dispose(),this._analyser.dispose(),this}}class uc extends cc{constructor(){super(Di(uc.getDefaults(),arguments,["size"])),this.name="FFT";const v=Di(uc.getDefaults(),arguments,["size"]);this.normalRange=v.normalRange,this._analyser.type="fft",this.size=v.size}static getDefaults(){return Object.assign(wo.getDefaults(),{normalRange:!1,size:1024,smoothing:.8})}getValue(){return this._analyser.getValue().map((v=>this.normalRange?eo(v):v))}get size(){return this._analyser.size}set size(v){this._analyser.size=v}get smoothing(){return this._analyser.smoothing}set smoothing(v){this._analyser.smoothing=v}getFrequencyOfIndex(v){return ti(0<=v&&v<this.size,"index must be greater than or equal to 0 and less than "+this.size),v*this.context.sampleRate/(2*this.size)}}class lc extends cc{constructor(){super(Di(lc.getDefaults(),arguments)),this.name="DCMeter",this._analyser.type="waveform",this._analyser.size=256}getValue(){return this._analyser.getValue()[0]}}class pc extends cc{constructor(){super(Di(pc.getDefaults(),arguments,["size"])),this.name="Waveform";const v=Di(pc.getDefaults(),arguments,["size"]);this._analyser.type="waveform",this.size=v.size}static getDefaults(){return Object.assign(cc.getDefaults(),{size:1024})}getValue(){return this._analyser.getValue()}get size(){return this._analyser.size}set size(v){this._analyser.size=v}}class dc extends wo{constructor(){super(Di(dc.getDefaults(),arguments,["solo"])),this.name="Solo";const v=Di(dc.getDefaults(),arguments,["solo"]);this.input=this.output=new ko({context:this.context}),dc._allSolos.has(this.context)||dc._allSolos.set(this.context,new Set),dc._allSolos.get(this.context).add(this),this.solo=v.solo}static getDefaults(){return Object.assign(wo.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(v){v?this._addSolo():this._removeSolo(),dc._allSolos.get(this.context).forEach((v=>v._updateSolo()))}get muted(){return 0===this.input.gain.value}_addSolo(){dc._soloed.has(this.context)||dc._soloed.set(this.context,new Set),dc._soloed.get(this.context).add(this)}_removeSolo(){dc._soloed.has(this.context)&&dc._soloed.get(this.context).delete(this)}_isSoloed(){return dc._soloed.has(this.context)&&dc._soloed.get(this.context).has(this)}_noSolos(){return!dc._soloed.has(this.context)||dc._soloed.has(this.context)&&0===dc._soloed.get(this.context).size}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),dc._allSolos.get(this.context).delete(this),this._removeSolo(),this}}dc._allSolos=new Map,dc._soloed=new Map;class fc extends wo{constructor(){super(Di(fc.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const v=Di(fc.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new Ca({context:this.context,pan:v.pan,channelCount:v.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Go({context:this.context,volume:v.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=v.mute,Ui(this,["pan","volume"])}static getDefaults(){return Object.assign(wo.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(v){this._volume.mute=v}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class _c extends wo{constructor(){super(Di(_c.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const v=Di(_c.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new dc({solo:v.solo,context:this.context}),this._panVol=this.output=new fc({context:this.context,pan:v.pan,volume:v.volume,mute:v.mute,channelCount:v.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),Ui(this,["pan","volume"])}static getDefaults(){return Object.assign(wo.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(v){this._solo.solo=v}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(v){this._panVol.mute=v}_getBus(v){return _c.buses.has(v)||_c.buses.set(v,new ko({context:this.context})),_c.buses.get(v)}send(v,M=0){const I=this._getBus(v),V=new ko({context:this.context,units:"decibels",gain:M});return this.connect(V),V.connect(I),V}receive(v){return this._getBus(v).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}_c.buses=new Map;class mc extends wo{constructor(){super(Di(mc.getDefaults(),arguments)),this.name="Mono",this.input=new ko({context:this.context}),this._merge=this.output=new Fa({channels:2,context:this.context}),this.input.connect(this._merge,0,0),this.input.connect(this._merge,0,1)}dispose(){return super.dispose(),this._merge.dispose(),this.input.dispose(),this}}class gc extends wo{constructor(){super(Di(gc.getDefaults(),arguments,["lowFrequency","highFrequency"])),this.name="MultibandSplit",this.input=new ko({context:this.context}),this.output=void 0,this.low=new Wr({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new Wr({context:this.context,frequency:0,type:"highpass"}),this.mid=new Wr({context:this.context,frequency:0,type:"lowpass"}),this.high=new Wr({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high];const v=Di(gc.getDefaults(),arguments,["lowFrequency","highFrequency"]);this.lowFrequency=new Do({context:this.context,units:"frequency",value:v.lowFrequency}),this.highFrequency=new Do({context:this.context,units:"frequency",value:v.highFrequency}),this.Q=new Do({context:this.context,units:"positive",value:v.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),Ui(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(wo.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),Qi(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}class vc extends wo{constructor(){super(...arguments),this.name="Listener",this.positionX=new xo({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new xo({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new xo({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new xo({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new xo({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new xo({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new xo({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new xo({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new xo({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(wo.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}ji((v=>{v.listener=new vc({context:v})})),zi((v=>{v.listener.dispose()}));class yc extends wo{constructor(){super(Di(yc.getDefaults(),arguments,["positionX","positionY","positionZ"])),this.name="Panner3D";const v=Di(yc.getDefaults(),arguments,["positionX","positionY","positionZ"]);this._panner=this.input=this.output=this.context.createPanner(),this.panningModel=v.panningModel,this.maxDistance=v.maxDistance,this.distanceModel=v.distanceModel,this.coneOuterGain=v.coneOuterGain,this.coneOuterAngle=v.coneOuterAngle,this.coneInnerAngle=v.coneInnerAngle,this.refDistance=v.refDistance,this.rolloffFactor=v.rolloffFactor,this.positionX=new xo({context:this.context,param:this._panner.positionX,value:v.positionX}),this.positionY=new xo({context:this.context,param:this._panner.positionY,value:v.positionY}),this.positionZ=new xo({context:this.context,param:this._panner.positionZ,value:v.positionZ}),this.orientationX=new xo({context:this.context,param:this._panner.orientationX,value:v.orientationX}),this.orientationY=new xo({context:this.context,param:this._panner.orientationY,value:v.orientationY}),this.orientationZ=new xo({context:this.context,param:this._panner.orientationZ,value:v.orientationZ})}static getDefaults(){return Object.assign(wo.getDefaults(),{coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1})}setPosition(v,M,I){return this.positionX.value=v,this.positionY.value=M,this.positionZ.value=I,this}setOrientation(v,M,I){return this.orientationX.value=v,this.orientationY.value=M,this.orientationZ.value=I,this}get panningModel(){return this._panner.panningModel}set panningModel(v){this._panner.panningModel=v}get refDistance(){return this._panner.refDistance}set refDistance(v){this._panner.refDistance=v}get rolloffFactor(){return this._panner.rolloffFactor}set rolloffFactor(v){this._panner.rolloffFactor=v}get distanceModel(){return this._panner.distanceModel}set distanceModel(v){this._panner.distanceModel=v}get coneInnerAngle(){return this._panner.coneInnerAngle}set coneInnerAngle(v){this._panner.coneInnerAngle=v}get coneOuterAngle(){return this._panner.coneOuterAngle}set coneOuterAngle(v){this._panner.coneOuterAngle=v}get coneOuterGain(){return this._panner.coneOuterGain}set coneOuterGain(v){this._panner.coneOuterGain=v}get maxDistance(){return this._panner.maxDistance}set maxDistance(v){this._panner.maxDistance=v}dispose(){return super.dispose(),this._panner.disconnect(),this.orientationX.dispose(),this.orientationY.dispose(),this.orientationZ.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this}}class xc extends wo{constructor(){super(Di(xc.getDefaults(),arguments)),this.name="Recorder";const v=Di(xc.getDefaults(),arguments);this.input=new ko({context:this.context}),ti(xc.supported,"Media Recorder API is not available"),this._stream=this.context.createMediaStreamDestination(),this.input.connect(this._stream),this._recorder=new MediaRecorder(this._stream.stream,{mimeType:v.mimeType})}static getDefaults(){return wo.getDefaults()}get mimeType(){return this._recorder.mimeType}static get supported(){return null!==Qa&&Reflect.has(Qa,"MediaRecorder")}get state(){return"inactive"===this._recorder.state?"stopped":"paused"===this._recorder.state?"paused":"started"}start(){return yi(this,void 0,void 0,(function*(){ti("started"!==this.state,"Recorder is already started");const v=new Promise((v=>{const e=()=>{this._recorder.removeEventListener("start",e,!1),v()};this._recorder.addEventListener("start",e,!1)}));return this._recorder.start(),yield v}))}stop(){return yi(this,void 0,void 0,(function*(){ti("stopped"!==this.state,"Recorder is not started");const v=new Promise((v=>{const e=M=>{this._recorder.removeEventListener("dataavailable",e,!1),v(M.data)};this._recorder.addEventListener("dataavailable",e,!1)}));return this._recorder.stop(),yield v}))}pause(){return ti("started"===this.state,"Recorder must be started"),this._recorder.pause(),this}dispose(){return super.dispose(),this.input.dispose(),this._stream.disconnect(),this}}class wc extends wo{constructor(){super(Di(wc.getDefaults(),arguments,["threshold","ratio"])),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor;const v=Di(wc.getDefaults(),arguments,["threshold","ratio"]);this.threshold=new xo({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:v.threshold}),this.attack=new xo({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:v.attack}),this.release=new xo({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:v.release}),this.knee=new xo({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:v.knee}),this.ratio=new xo({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:v.ratio}),Ui(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(wo.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class bc extends wo{constructor(){super(Object.assign(Di(bc.getDefaults(),arguments,["threshold","smoothing"]))),this.name="Gate";const v=Di(bc.getDefaults(),arguments,["threshold","smoothing"]);this._follower=new Da({context:this.context,smoothing:v.smoothing}),this._gt=new Mr({context:this.context,value:eo(v.threshold)}),this.input=new ko({context:this.context}),this._gate=this.output=new ko({context:this.context}),this.input.connect(this._gate),this.input.chain(this._follower,this._gt,this._gate.gain)}static getDefaults(){return Object.assign(wo.getDefaults(),{smoothing:.1,threshold:-40})}get threshold(){return so(this._gt.value)}set threshold(v){this._gt.value=eo(v)}get smoothing(){return this._follower.smoothing}set smoothing(v){this._follower.smoothing=v}dispose(){return super.dispose(),this.input.dispose(),this._follower.dispose(),this._gt.dispose(),this._gate.dispose(),this}}class Tc extends wo{constructor(){super(Object.assign(Di(Tc.getDefaults(),arguments,["threshold"]))),this.name="Limiter";const v=Di(Tc.getDefaults(),arguments,["threshold"]);this._compressor=this.input=this.output=new wc({context:this.context,ratio:20,attack:.003,release:.01,threshold:v.threshold}),this.threshold=this._compressor.threshold,Ui(this,"threshold")}static getDefaults(){return Object.assign(wo.getDefaults(),{threshold:-12})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.dispose(),this.threshold.dispose(),this}}class Sc extends wo{constructor(){super(Object.assign(Di(Sc.getDefaults(),arguments))),this.name="MidSideCompressor";const v=Di(Sc.getDefaults(),arguments);this._midSideSplit=this.input=new ec({context:this.context}),this._midSideMerge=this.output=new sc({context:this.context}),this.mid=new wc(Object.assign(v.mid,{context:this.context})),this.side=new wc(Object.assign(v.side,{context:this.context})),this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid),this._midSideSplit.side.chain(this.side,this._midSideMerge.side),Ui(this,["mid","side"])}static getDefaults(){return Object.assign(wo.getDefaults(),{mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}})}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this}}class kc extends wo{constructor(){super(Object.assign(Di(kc.getDefaults(),arguments))),this.name="MultibandCompressor";const v=Di(kc.getDefaults(),arguments);this._splitter=this.input=new gc({context:this.context,lowFrequency:v.lowFrequency,highFrequency:v.highFrequency}),this.lowFrequency=this._splitter.lowFrequency,this.highFrequency=this._splitter.highFrequency,this.output=new ko({context:this.context}),this.low=new wc(Object.assign(v.low,{context:this.context})),this.mid=new wc(Object.assign(v.mid,{context:this.context})),this.high=new wc(Object.assign(v.high,{context:this.context})),this._splitter.low.chain(this.low,this.output),this._splitter.mid.chain(this.mid,this.output),this._splitter.high.chain(this.high,this.output),Ui(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(wo.getDefaults(),{lowFrequency:250,highFrequency:2e3,low:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10},mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},high:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16}})}dispose(){return super.dispose(),this._splitter.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.output.dispose(),this}}class Cc extends wo{constructor(){super(Di(Cc.getDefaults(),arguments,["low","mid","high"])),this.name="EQ3",this.output=new ko({context:this.context}),this._internalChannels=[];const v=Di(Cc.getDefaults(),arguments,["low","mid","high"]);this.input=this._multibandSplit=new gc({context:this.context,highFrequency:v.highFrequency,lowFrequency:v.lowFrequency}),this._lowGain=new ko({context:this.context,gain:v.low,units:"decibels"}),this._midGain=new ko({context:this.context,gain:v.mid,units:"decibels"}),this._highGain=new ko({context:this.context,gain:v.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),Ui(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(wo.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),Qi(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}class Ac extends wo{constructor(){super(Di(Ac.getDefaults(),arguments,["url","onload"])),this.name="Convolver",this._convolver=this.context.createConvolver();const v=Di(Ac.getDefaults(),arguments,["url","onload"]);this._buffer=new Xi(v.url,(M=>{this.buffer=M,v.onload()})),this.input=new ko({context:this.context}),this.output=new ko({context:this.context}),this._buffer.loaded&&(this.buffer=this._buffer),this.normalize=v.normalize,this.input.chain(this._convolver,this.output)}static getDefaults(){return Object.assign(wo.getDefaults(),{normalize:!0,onload:Zi})}load(v){return yi(this,void 0,void 0,(function*(){this.buffer=yield this._buffer.load(v)}))}get buffer(){return this._buffer.length?this._buffer:null}set buffer(v){v&&this._buffer.set(v),this._convolver.buffer&&(this.input.disconnect(),this._convolver.disconnect(),this._convolver=this.context.createConvolver(),this.input.chain(this._convolver,this.output));const M=this._buffer.get();this._convolver.buffer=M||null}get normalize(){return this._convolver.normalize}set normalize(v){this._convolver.normalize=v}dispose(){return super.dispose(),this._buffer.dispose(),this._convolver.disconnect(),this}}function Dc(){return Ji().now()}function Oc(){return Ji().immediate()}const Kc=Ji().transport;function Ec(){return Ji().transport}const th=Ji().destination,eh=Ji().destination;function Fc(){return Ji().destination}const sh=Ji().listener;function Vc(){return Ji().listener}const nh=Ji().draw;function Pc(){return Ji().draw}const ih=Ji();function Lc(){return Xi.loaded()}const oh=Xi,rh=Vo,ah=$o}])}));var I=M;const V=M.Tone;export default I;export{V as Tone};

